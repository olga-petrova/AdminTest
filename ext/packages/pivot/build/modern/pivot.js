Ext.define("Ext.overrides.drag.Info",{override:"Ext.drag.Info",getCursorElement:function(a,b,c){var e=this.cursor.current,d=Ext.drag.Manager.elementFromPoint(e.x,e.y);return Ext.fly(d).up(a,b,c)}});Ext.define("Ext.overrides.grid.column.Column",{override:"Ext.grid.column.Column",updateSortIndicator:function(d){var c=this,a=c._sortDirection,b=c.getSortedCls();if(a){c.element.removeCls(b+"-"+a.toLowerCase())}if(d){c.element.addCls(b+"-"+d.toLowerCase())}c._sortDirection=d}});Ext.define("Ext.pivot.Aggregators",{alternateClassName:["Mz.aggregate.Aggregators"],singleton:true,customText:"Custom",sumText:"Sum",avgText:"Avg",minText:"Min",maxText:"Max",countText:"Count",groupSumPercentageText:"Group sum percentage",groupCountPercentageText:"Group count percentage",varianceText:"Var",variancePText:"Varp",stdDevText:"StdDev",stdDevPText:"StdDevp",sum:function(b,d,a,g,h){var f=b.length,e=0,c;for(c=0;c<f;c++){e+=Ext.Number.from(b[c].get(d),0)}return e},avg:function(b,d,a,g,h){var f=b.length,e=0,c;for(c=0;c<f;c++){e+=Ext.Number.from(b[c].get(d),0)}return f>0?(e/f):0},min:function(d,a,g,j,b){var e=[],c=d.length,f,h;for(f=0;f<c;f++){e.push(d[f].get(a))}h=Ext.Array.min(e);return h},max:function(b,d,a,f,h){var g=[],e=b.length,c;for(c=0;c<e;c++){g.push(b[c].get(d))}v=Ext.Array.max(g);return v},count:function(b,c,a,d,e){return b.length},groupSumPercentage:function(e,b,g,i,c){var a=Ext.pivot.Aggregators.sum,d=e.length,l,k,f=0,h=0,j=i.split(g.keysSeparator);if(d==0){return 0}j.pop();j=j.join(g.keysSeparator);if(Ext.isEmpty(j)){j=g.grandTotalKey}l=g.results.get(i,c);if(l){f=l.getValue("groupSum");if(!Ext.isDefined(f)){f=l.calculateByFn("groupSum",b,a)}}k=g.results.get(j,c);if(k){h=k.getValue("groupSum");if(!Ext.isDefined(h)){h=k.calculateByFn("groupSum",b,a)}}return(h>0&&f>0)?f/h*100:0},groupCountPercentage:function(d,a,f,h,b){var k=Ext.pivot.Aggregators.count,c=d.length,l,j,e=0,g=0,i=h.split(f.keysSeparator);if(c==0){return 0}i.pop();i=i.join(f.keysSeparator);if(Ext.isEmpty(i)){i=f.grandTotalKey}l=f.results.get(h,b);if(l){e=l.getValue("groupCount");if(!Ext.isDefined(e)){e=l.calculateByFn("groupCount",a,k)}}j=f.results.get(i,b);if(j){g=j.getValue("groupCount");if(!Ext.isDefined(g)){g=j.calculateByFn("groupCount",a,k)}}return(g>0&&e>0)?e/g*100:0},variance:function(d,a,j,k,b){var g=Ext.pivot.Aggregators,c=d.length,f=g.avg.apply(g,arguments),h=0,e;if(f>0){for(e=0;e<c;e++){h+=Math.pow(Ext.Number.from(d[e].get(a),0)-f,2)}}return(h>0&&c>1)?(h/(c-1)):0},varianceP:function(d,a,j,k,b){var g=Ext.pivot.Aggregators,c=d.length,f=g.avg.apply(g,arguments),h=0,e;if(f>0){for(e=0;e<c;e++){h+=Math.pow(Ext.Number.from(d[e].get(a),0)-f,2)}}return(h>0&&c>0)?(h/c):0},stdDev:function(c,d,b,f,g){var e=Ext.pivot.Aggregators,a=e.variance.apply(e,arguments);return a>0?Math.sqrt(a):0},stdDevP:function(c,d,b,f,g){var e=Ext.pivot.Aggregators,a=e.varianceP.apply(e,arguments);return a>0?Math.sqrt(a):0}});Ext.define("Ext.pivot.MixedCollection",{extend:"Ext.util.MixedCollection",alternateClassName:["Mz.aggregate.MixedCollection"],removeAt:function(a){Ext.destroy(this.callParent(arguments))},clear:function(){Ext.destroy(this.items);this.callParent(arguments)},removeAll:function(){Ext.destroy(this.items);this.callParent(arguments)},destroy:function(){this.clear()}});Ext.define("Ext.pivot.filter.Base",{alternateClassName:["Mz.aggregate.filter.Abstract"],alias:"pivotfilter.base",mixins:["Ext.mixin.Factoryable"],operator:null,value:null,caseSensitive:true,parent:null,isFilter:true,constructor:function(b){var c=this,a=Ext.util.Format;c.thousandRe=new RegExp("["+a.thousandSeparator+"]","g");c.decimalRe=new RegExp("["+a.decimalSeparator+"]");Ext.apply(this,b);return this.callParent([b])},destroy:function(){var a=this;a.parent=a.thousandRe=a.decimalRe=null;a.callParent()},serialize:function(){var a=this;return Ext.apply({type:a.type,operator:a.operator,value:a.value,caseSensitive:a.caseSensitive},a.getSerialArgs()||{})},getSerialArgs:Ext.emptyFn,isMatch:function(f){var e=this,b=e.value,c,a,d,h,g;b=(Ext.isArray(b)?b[0]:b)||"";c=e.compare(f,b);if(e.operator=="="){return(c===0)}if(e.operator=="!="){return(c!==0)}if(e.operator==">"){return(c>0)}if(e.operator==">="){return(c>=0)}if(e.operator=="<"){return(c<0)}if(e.operator=="<="){return(c<=0)}b=e.value;h=(Ext.isArray(b)?b[0]:b)||"";g=(Ext.isArray(b)?b[1]:b)||"";a=e.compare(f,h);d=e.compare(f,g);if(e.operator=="between"){return(a>=0&&d<=0)}if(e.operator=="not between"){return !(a>=0&&d<=0)}return true},parseNumber:function(b){var a;if(typeof b==="number"){return b}if(Ext.isEmpty(b)){b=""}a=String(b).replace(this.thousandRe,"");a=a.replace(this.decimalRe,".");if(Ext.isNumeric(a)){return parseFloat(a)}return null},compare:function(d,c){var g=Ext.pivot.matrix.Base.prototype.naturalSort,f=this.parseNumber(d),e=this.parseNumber(c);if(Ext.isNumber(f)&&Ext.isNumber(e)){return g(f,e)}if(Ext.isDate(d)){if(Ext.isDate(c)){return g(d,c)}else{return g(d,Ext.Date.parse(c,Ext.Date.defaultFormat))}}return(this.caseSensitive?g(d||"",c||""):g(String(d||"").toLowerCase(),String(c||"").toLowerCase()))}});Ext.define("Ext.pivot.filter.Label",{alternateClassName:["Mz.aggregate.filter.Label"],extend:"Ext.pivot.filter.Base",alias:"pivotfilter.label",isMatch:function(c){var b=this,a;if(b.operator=="begins"){return Ext.String.startsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not begins"){return !Ext.String.startsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="ends"){return Ext.String.endsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not ends"){return !Ext.String.endsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="contains"){return b.stringContains(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not contains"){return !b.stringContains(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="in"){return b.foundInArray(b.value)}if(b.operator=="not in"){return !b.foundInArray(b.value)}return b.callParent(arguments)},foundInArray:function(d){var b=Ext.Array.from(this.value),a=b.length,e=false,c;if(this.caseSensitive){return Ext.Array.indexOf(b,d)>=0}else{for(c=0;c<a;c++){e=e||(String(d).toLowerCase()==String(b[c]).toLowerCase());if(e){break}}return e}},stringContains:function(c,d,b){var a=(d.length<=c.length);if(a){if(b){c=c.toLowerCase();d=d.toLowerCase()}a=(c.lastIndexOf(d)>=0)}return a}});Ext.define("Ext.pivot.filter.Value",{alternateClassName:["Mz.aggregate.filter.Value"],extend:"Ext.pivot.filter.Base",alias:"pivotfilter.value",dimensionId:"",topType:"items",topOrder:"top",topSort:true,isTopFilter:false,constructor:function(b){var a=this.callParent([b]);this.isTopFilter=(this.operator==="top10");return a},destroy:function(){this.dimension=null;this.callParent()},getDimension:function(){return this.parent.matrix.aggregate.getByKey(this.dimensionId)},getSerialArgs:function(){return{dimensionId:this.dimensionId,topType:this.topType,topOrder:this.topOrder}},applyFilter:function(c,e){var d=this,a=d.topSort?e:Ext.Array.clone(e),b=[];if(e.length==0){return b}d.sortItemsByGrandTotal(c,a);switch(d.topType){case"items":b=d.extractTop10Items(a);break;case"sum":b=d.extractTop10Sum(a);break;case"percent":b=d.extractTop10Percent(c,a);break}if(!d.topSort){a.length=0}return b},extractTop10Items:function(a){var c=this,d=[],b;for(b=0;b<a.length;b++){if(d.indexOf(a[b]["tempVar"])<0){d.push(a[b]["tempVar"]);if(d.length>c.value||(c.value<b+1&&b>0)){break}}}return Ext.Array.slice(a,b)},extractTop10Sum:function(a){var d=this,c=0,b;for(b=0;b<a.length;b++){c+=a[b]["tempVar"];if(c>=d.value){break}}return Ext.Array.slice(a,b+1)},extractTop10Percent:function(b,g){var h=this,e=0,k=g[0].key.split(b.matrix.keysSeparator),c,d,f,j,l,a;k.length--;j=(k.length>0?k.join(b.matrix.keysSeparator):b.matrix.grandTotalKey);d=(b.isLeftAxis?j:b.matrix.grandTotalKey);f=(b.isLeftAxis?b.matrix.grandTotalKey:j);l=b.matrix.results.get(d,f);a=(l?l.getValue(h.dimensionId):0);for(c=0;c<g.length;c++){e+=g[c]["tempVar"];if((e*100/a)>=h.value){break}}return Ext.Array.slice(g,c+1)},sortItemsByGrandTotal:function(d,b){var e=this,g,f,a,c;for(c=0;c<b.length;c++){g=(d.isLeftAxis?b[c].key:d.matrix.grandTotalKey);f=(d.isLeftAxis?d.matrix.grandTotalKey:b[c].key);a=d.matrix.results.get(g,f);b[c]["tempVar"]=(a?a.getValue(e.dimensionId):0)}Ext.Array.sort(b,function(j,i){var h=d.matrix.naturalSort(j.tempVar,i.tempVar);if(h<0&&e.topOrder==="top"){return 1}if(h>0&&e.topOrder==="top"){return -1}return h})}});Ext.define("Ext.pivot.dimension.Item",{alternateClassName:["Mz.aggregate.dimension.Item"],requires:["Ext.pivot.MixedCollection","Ext.pivot.filter.Label","Ext.pivot.filter.Value"],$configPrefixed:false,$configStrict:false,config:{id:"",header:"",dataIndex:"",sortIndex:"",width:100,flex:0,align:"left",sortable:true,direction:"ASC",sorterFn:null,caseSensitiveSort:true,filter:null,labelRenderer:null,renderer:null,formatter:null,exportStyle:null,scope:null,grouperFn:null,blankText:"(blank)",showZeroAsBlank:false,aggregator:"sum",values:null},isAggregate:false,matrix:null,constructor:function(b){var c=this,a=Ext.apply({id:Ext.id()},b||{});this.initConfig(a);if(Ext.isEmpty(c.getId())){c.setId(Ext.id())}if(Ext.isEmpty(c.getGrouperFn())){c.setGrouperFn("")}if(c.getSortable()&&!c.getSorterFn()){c.setSorterFn(c.defaultSorterFn)}if(Ext.isEmpty(c.getSortIndex())){c.setSortIndex(c.getDataIndex())}if(c.isAggregate&&!c.getFormatter()&&!c.getRenderer()){c.setRenderer(c.getDefaultFormatRenderer("0,000.00"))}return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroyMembers(a,"values","filter");a.matrix=a.values=a.filter=null},serialize:function(){var b=this,a=b.getConfig();delete (a.values);return Ext.apply(a,{filter:b.filter?b.filter.serialize():null,aggregator:Ext.isString(a.aggregator)?a.aggregator:"sum"})},applyAggregator:function(a,b){var c=Ext.pivot.Aggregators;if(a==null){delete (this.aggregatorFn);return a}if(Ext.isEmpty(a)){a="sum"}if(Ext.isString(a)&&Ext.isFunction(c[a])){this.aggregatorFn=Ext.bind(c[a],c)}else{this.aggregatorFn=a}return a},updateExportStyle:function(a){if(a&&!a.id){a.id=this.getId()}},updateGrouperFn:function(a){if(Ext.isEmpty(a)){this.groupFn=Ext.bind(this.defaultGrouperFn,this)}else{this.groupFn=a}},applyFilter:function(b,a){if(b==null){return b}if(b&&b.isFilter){b.parent=this;return b}if(Ext.isObject(b)){Ext.applyIf(b,{type:"label",parent:this});b=Ext.Factory.pivotfilter(b)}else{b=false}return b},addValue:function(b,c){var a=this.getValues();if(!a.getByKey(b)){a.add({value:b,display:c})}},getValues:function(){var a=this.values;if(!a){a=Ext.create("Ext.pivot.MixedCollection");a.getKey=function(b){return b.value};this.setValues(a)}return a},defaultSorterFn:function(f,e){var d=this,c=f.sortValue,b=e.sortValue,a;if(c instanceof Date){c=c.getTime()}if(b instanceof Date){b=b.getTime()}if(!d.caseSensitiveSort){c=String(c).toUpperCase();b=String(b).toUpperCase()}a=Ext.pivot.matrix.Base.prototype.naturalSort(c,b);if(a<0&&d.direction==="DESC"){return 1}if(a>0&&d.direction==="DESC"){return -1}return a},getDefaultFormatRenderer:function(b){var a=this;return function(d){var c;if(Ext.isEmpty(b)){return d}if(Ext.isFunction(b)){return b.apply(a,arguments)}if(!Ext.isNumber(d)){return d}if(a.isAggregate&&d===0&&a.showZeroAsBlank){return""}c=(d>=0);d=Math.abs(d);d=Ext.util.Format.number(d,b);return c?d:"-"+d}},defaultGrouperFn:function(a){return a.get(this.dataIndex)},getFormatterFn:function(){var a=this,b=a.getFormatter(),c;if(b){c=b.indexOf("this.")===0;if(c){b=b.substring(5)}b=Ext.app.bind.Template.prototype.parseFormat(b);if(c){b.scope=null}return function(d){return b.format(d,b.scope||a.getScope()||a.matrix.cmp.resolveListenerScope("self.controller")||this)}}},aggregatorFn:Ext.emptyFn,groupFn:Ext.emptyFn});Ext.define("Ext.pivot.axis.Item",{alternateClassName:["Mz.aggregate.axis.Item"],level:0,key:"",value:"",sortValue:"",name:"",dimensionId:"",dimension:null,children:null,record:null,records:null,axis:null,data:null,expanded:false,constructor:function(a){var b=this;Ext.apply(b,a||{});if(Ext.isEmpty(b.sortValue)){b.sortValue=b.value}b.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.children);a.axis=a.data=a.dimension=a.record=a.children=a.records=null;a.callParent(arguments)},getTextTotal:function(){var b=this,a=Ext.XTemplate.getTpl(b.axis.matrix,"textTotalTpl");return a.apply({groupField:b.dimension.dataIndex,columnName:b.dimension.dataIndex,name:b.name,rows:b.children||[]})},expand:function(a){var b=this;b.expanded=true;if(a===true){b.expandCollapseChildrenTree(true)}b.axis.matrix.fireEvent("groupexpand",b.axis.matrix,(b.axis.isLeftAxis?"row":"col"),b)},collapse:function(a){var b=this;b.expanded=false;if(a===true){b.expandCollapseChildrenTree(false)}b.axis.matrix.fireEvent("groupcollapse",b.axis.matrix,(b.axis.isLeftAxis?"row":"col"),b)},expandCollapseChildrenTree:function(c){var b=this,a;b.expanded=c;if(Ext.isArray(b.children)){for(a=0;a<b.children.length;a++){b.children[a].expandCollapseChildrenTree(c)}}}});Ext.define("Ext.pivot.axis.Base",{alternateClassName:["Mz.aggregate.axis.Abstract"],alias:"pivotaxis.base",mixins:["Ext.mixin.Factoryable"],requires:["Ext.pivot.MixedCollection","Ext.pivot.dimension.Item","Ext.pivot.axis.Item"],dimensions:null,matrix:null,items:null,tree:null,levels:0,isLeftAxis:false,constructor:function(a){var c=this,b,d;if(!a||!a.matrix){return}c.isLeftAxis=a.isLeftAxis||c.isLeftAxis;c.matrix=a.matrix;c.tree=[];c.dimensions=Ext.create("Ext.pivot.MixedCollection");c.dimensions.getKey=function(e){return e.getId()};c.items=Ext.create("Ext.pivot.MixedCollection");c.items.getKey=function(e){return e.key};Ext.Array.each(Ext.Array.from(a.dimensions||[]),c.addDimension,c)},destroy:function(){var a=this;Ext.destroyMembers(a,"dimensions","items","tree");a.matrix=a.dimensions=a.items=a.tree=null},addDimension:function(b){var a;if(!b){return}if(b instanceof Ext.pivot.dimension.Item){a=b;a.matrix=this.matrix}else{a=Ext.create("Ext.pivot.dimension.Item",Ext.apply({matrix:this.matrix},b))}this.dimensions.add(a)},addItem:function(b){var a=this;if(!Ext.isObject(b)||Ext.isEmpty(b.key)||Ext.isEmpty(b.value)||Ext.isEmpty(b.dimensionId)){return false}b.key=String(b.key);b.dimension=a.dimensions.getByKey(b.dimensionId);b.name=b.name||Ext.callback(b.dimension.getLabelRenderer(),b.dimension.getScope()||"self.controller",[b.value],0,a.matrix.cmp)||b.value;b.dimension.addValue(b.value,b.name);b.axis=a;if(!a.items.getByKey(b.key)&&b.dimension){a.items.add(Ext.create("Ext.pivot.axis.Item",b));return true}return false},clear:function(){this.items.clear();this.tree=null},getTree:function(){if(!this.tree){this.buildTree()}return this.tree},expandAll:function(){Ext.Array.each(this.getTree(),function(a){a.expandCollapseChildrenTree(true)});this.matrix.fireEvent("groupexpand",this.matrix,(this.isLeftAxis?"row":"col"),null)},collapseAll:function(){Ext.Array.each(this.getTree(),function(a){a.expandCollapseChildrenTree(false)});this.matrix.fireEvent("groupcollapse",this.matrix,(this.isLeftAxis?"row":"col"),null)},findTreeElement:function(c,d){var a=arguments[2]||this.tree||[],f=arguments[3]||1,e=null;var b=Ext.Array.filter(a,function(i,g,h){return Ext.isDate(d)?Ext.Date.isEqual(i[c],d):i[c]===d},this);if(b.length>0){return{level:f,node:b[0]}}Ext.Array.each(a,function(i,g,h){if(i.children){e=this.findTreeElement(c,d,i.children,f+1);if(e){return false}}},this);return e},buildTree:function(){var a=this;a.tree=[];a.items.each(a.addItemToTree,a);a.sortTree()},addItemToTree:function(e){var d=this,c=String(e.key).split(d.matrix.keysSeparator),a="",b;c=Ext.Array.slice(c,0,c.length-1);a=c.join(d.matrix.keysSeparator);b=d.findTreeElement("key",a);if(b){e.level=b.level;e.data=Ext.clone(b.node.data||{});b.node.children=b.node.children||[];b.node.children.push(e)}else{e.level=0;e.data={};d.tree.push(e)}e.data[e.dimension.getId()]=e.name;d.levels=Math.max(d.levels,e.level)},sortTree:function(){var a=arguments[0]||this.tree,b;if(a.length>0){b=a[0].dimension}if(b&&b.sortable===true){Ext.Array.sort(a,function(d,c){return b.sorterFn(d,c)})}Ext.Array.each(a,function(c){if(c.children){this.sortTree(c.children)}},this)},sortTreeByField:function(e,d){var b=this,a=false,c;if(e==b.matrix.compactViewKey){a=b.sortTreeByDimension(b.tree,b.dimensions.getRange(),d);b.dimensions.each(function(f){f.direction=d})}else{d=d||"ASC";c=b.dimensions.getByKey(e);if(c){a=b.sortTreeByDimension(b.tree,c,d);c.direction=d}else{a=b.sortTreeByRecords(b.tree,e,d)}}return a},sortTreeByDimension:function(j,c,g){var f=false,a=Ext.Array.from(c),b,e,d,h;j=j||[];e=j.length;if(e>0){b=j[0].dimension}if(Ext.Array.indexOf(a,b)>=0){if(b.sortable){h=b.direction;b.direction=g;Ext.Array.sort(j,Ext.bind(b.sorterFn,b));b.direction=h}f=b.sortable}for(d=0;d<e;d++){f=this.sortTreeByDimension(j[d].children,c,g)||f}return f},sortTreeByRecords:function(b,e,d){var c,a;b=b||[];a=b.length;if(a<=0){return false}if(b[0].record){this.sortTreeRecords(b,e,d)}else{this.sortTreeLeaves(b,e,d)}for(c=0;c<a;c++){this.sortTreeByRecords(b[c].children,e,d)}return true},sortTreeRecords:function(a,d,c){var b=this.matrix.naturalSort;c=c||"ASC";Ext.Array.sort(a||[],function(g,f){var e,i=g.record,h=f.record;if(!(i&&i.isModel&&h&&h.isModel)){return 0}e=b(i.get(d)||"",h.get(d)||"");if(e<0&&c==="DESC"){return 1}if(e>0&&c==="DESC"){return -1}return e})},sortTreeLeaves:function(i,d,e){var g=this.matrix.naturalSort,b=this.matrix.results,h=this.matrix.model,f=Ext.Array.indexOf(Ext.Array.pluck(h,"name"),d),a,c;if(f<0){return false}a=h[f]["col"];c=h[f]["agg"];e=e||"ASC";Ext.Array.sort(i||[],function(l,k){var j,n,m;n=b.get(l.key,a);if(n){n=n.getValue(c)}else{n=0}m=b.get(k.key,a);if(m){m=m.getValue(c)}else{m=0}j=g(n,m);if(j<0&&e==="DESC"){return 1}if(j>0&&e==="DESC"){return -1}return j})}});Ext.define("Ext.pivot.axis.Local",{alternateClassName:["Mz.aggregate.axis.Local"],extend:"Ext.pivot.axis.Base",alias:"pivotaxis.local",processRecord:function(d){var f=this,e=[],g="",j=true,h=f.dimensions.getCount(),a,k,b,c;for(c=0;c<h;c++){b=f.dimensions.getAt(c);a=Ext.callback(b.groupFn,b.getScope()||"self.controller",[d],0,f.matrix.cmp);k=g?g+f.matrix.keysSeparator:"";a=Ext.isEmpty(a)?b.blankText:a;k+=f.matrix.getKey(a);if(b.filter instanceof Ext.pivot.filter.Label){j=b.filter.isMatch(a)}if(!j){break}e.push({value:a,sortValue:d.get(b.sortIndex),key:k,dimensionId:b.getId()});g=k}if(j){return e}else{return null}},buildTree:function(){this.callParent(arguments);this.filterTree()},filterTree:function(){var d=this,c=d.dimensions.getCount(),a=false,b;for(b=0;b<c;b++){a=a||(d.dimensions.getAt(b).filter instanceof Ext.pivot.filter.Value)}if(!a){return}d.matrix.filterApplied=true;d.filterTreeItems(d.tree)},filterTreeItems:function(a){var d=this,c,b,e;if(!a||!Ext.isArray(a)||a.length<=0){return}c=a[0].dimension.filter;if(c&&(c instanceof Ext.pivot.filter.Value)){if(c.isTopFilter){e=c.applyFilter(d,a)||[]}else{e=Ext.Array.filter(a,d.canRemoveItem,d)}d.removeRecordsFromResults(e);d.removeItemsFromArray(a,e);for(b=0;b<e.length;b++){d.removeTreeChildren(e[b])}}for(b=0;b<a.length;b++){if(a[b].children){d.filterTreeItems(a[b].children);if(a[b].children.length===0){d.items.remove(a[b]);Ext.Array.erase(a,b,1);b--}}}},removeTreeChildren:function(c){var b,a;if(c.children){a=c.children.length;for(b=0;b<a;b++){this.removeTreeChildren(c.children[b])}}this.items.remove(c)},canRemoveItem:function(d){var c=this,f=(c.isLeftAxis?d.key:c.matrix.grandTotalKey),e=(c.isLeftAxis?c.matrix.grandTotalKey:d.key),a=c.matrix.results.get(f,e),b=d.dimension.filter;return(a?!b.isMatch(a.getValue(b.dimensionId)):false)},removeItemsFromArray:function(c,a){for(var b=0;b<c.length;b++){if(Ext.Array.indexOf(a,c[b])>=0){Ext.Array.erase(c,b,1);b--}}},removeRecordsFromResults:function(a){for(var b=0;b<a.length;b++){this.removeRecordsByItem(a[b])}},removeRecordsByItem:function(g){var f=this,e,c,b,a,d;if(g.children){f.removeRecordsFromResults(g.children)}if(f.isLeftAxis){d=f.matrix.results.get(g.key,f.matrix.grandTotalKey);b=f.matrix.results.getByLeftKey(f.matrix.grandTotalKey)}else{d=f.matrix.results.get(f.matrix.grandTotalKey,g.key);b=f.matrix.results.getByTopKey(f.matrix.grandTotalKey)}if(!d){return}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e=g.key.split(f.matrix.keysSeparator);e.length=e.length-1;while(e.length>0){if(f.isLeftAxis){b=f.matrix.results.getByLeftKey(e.join(f.matrix.keysSeparator))}else{b=f.matrix.results.getByTopKey(e.join(f.matrix.keysSeparator))}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e.length=e.length-1}}});Ext.define("Ext.pivot.feature.PivotStore",{config:{store:null,grid:null,matrix:null,clsGrandTotal:"",clsGroupTotal:"",summaryDataCls:"",rowCls:""},constructor:function(a){this.initConfig(a);return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.storeListeners,a.matrixListeners);a.setConfig({store:null,matrix:null,grid:null});a.storeInfo=a.storeListeners=null;a.callParent(arguments)},updateStore:function(a){var b=this;Ext.destroy(b.storeListeners);if(a){b.storeListeners=a.on({pivotstoreremodel:b.processStore,scope:b,destroyable:true})}},updateMatrix:function(a){var b=this;Ext.destroy(b.matrixListeners);if(a){b.matrixListeners=a.on({groupexpand:b.onGroupExpand,groupcollapse:b.onGroupCollapse,scope:b,destroyable:true})}},processStore:function(){var g=this,j=g.getStore(),h=g.getMatrix(),c=[],a=Ext.toolkit=="classic",f,b,d,k,e;if(!h||!j){return}e=h.getColumns();j.model.replaceFields(e,true);j.removeAll(true);g.storeInfo={};if(h.rowGrandTotalsPosition=="first"){c.push.apply(c,g.processGrandTotal()||[])}f=h.leftAxis.getTree();b=f.length;for(d=0;d<b;d++){k=f[d];c.push.apply(c,g.processGroup({group:k,previousExpanded:(d>0?f[d-1].expanded:false)})||[])}if(h.rowGrandTotalsPosition=="last"){c.push.apply(c,g.processGrandTotal()||[])}j.loadData(c);if(!a){j.fireEvent("load",j)}},processGroup:function(a){var c=this,b=c["processGroup"+Ext.String.capitalize(c.getMatrix().viewLayoutType)];if(!Ext.isFunction(b)){b=c.processGroupOutline}return b.call(c,a)},processGrandTotal:function(){var c=this,d=false,b=c.getMatrix(),e={key:b.grandTotalKey},a=[];Ext.Array.forEach(b.totals||[],function(h){var f=h.record,g=b.leftAxis.dimensions.getCount();if(!(f instanceof Ext.data.Model)){return}c.storeInfo[f.internalId]={leftKey:e.key,rowStyle:"",rowClasses:[c.getClsGrandTotal(),c.getSummaryDataCls()],rendererParams:{}};b.leftAxis.dimensions.each(function(k,i){var j;if(b.viewLayoutType=="compact"||i===0){if(b.viewLayoutType=="compact"){j=b.compactViewKey;g=1}else{j=k.getId()}f.set(j,h.title);f.commit(false,[j]);c.storeInfo[f.internalId].rendererParams[j]={fn:"groupOutlineRenderer",group:e,colspan:g,hidden:false,subtotalRow:true};d=true}else{c.storeInfo[f.internalId].rendererParams[k.getId()]={fn:"groupOutlineRenderer",group:e,colspan:0,hidden:d,subtotalRow:true};g--}});c.storeInfo[f.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};a.push(f)});return a},processGroupOutline:function(a){var c=this,d=a.group,b=[];if(d.record){c.processRecordOutline({results:b,group:d})}else{c.processGroupOutlineWithChildren({results:b,group:d,previousExpanded:a.previousExpanded})}return b},processGroupOutlineWithChildren:function(d){var g=this,c=g.getMatrix(),h=d.group,b=d.previousExpanded,f,a,e;f=(!h.expanded||(h.expanded&&c.rowSubTotalsPosition=="first"));a=h.expanded?h.records.expanded:h.records.collapsed;g.processGroupHeaderRecordOutline({results:d.results,group:h,record:a,previousExpanded:b,hasSummaryData:f});if(h.expanded){if(h.children){for(e=0;e<h.children.length;e++){if(h.children[e]["children"]){g.processGroupOutlineWithChildren({results:d.results,group:h.children[e]})}else{g.processRecordOutline({results:d.results,group:h.children[e]})}}}if(c.rowSubTotalsPosition=="last"){a=h.records.footer;g.processGroupHeaderRecordOutline({results:d.results,group:h,record:a,previousExpanded:b,subtotalRow:true,hasSummaryData:true})}}},processGroupHeaderRecordOutline:function(a){var f=this,g=f.getMatrix(),h=a.group,d=a.record,b=a.previousExpanded,j=a.subtotalRow,e=a.hasSummaryData,c=g.leftAxis.dimensions.getCount(),k=false;f.storeInfo[d.internalId]={leftKey:h.key,rowStyle:"",rowClasses:[f.getClsGroupTotal(),e?f.getSummaryDataCls():""],rendererParams:{}};g.leftAxis.dimensions.each(function(l,i){if(l.getId()==h.dimension.getId()){f.storeInfo[d.internalId].rendererParams[l.getId()]={fn:"groupOutlineRenderer",group:h,colspan:c,hidden:false,previousExpanded:b,subtotalRow:j};k=true}else{f.storeInfo[d.internalId].rendererParams[l.getId()]={fn:"groupOutlineRenderer",group:h,colspan:0,hidden:k,previousExpanded:b,subtotalRow:j};c--}});f.storeInfo[d.internalId].rendererParams.topaxis={fn:(e?"topAxisRenderer":"topAxisNoRenderer")};a.results.push(d)},processRecordOutline:function(b){var c=this,e=b.group,d=false,a=e.record;c.storeInfo[a.internalId]={leftKey:e.key,rowStyle:"",rowClasses:[c.getSummaryDataCls()],rendererParams:{}};c.getMatrix().leftAxis.dimensions.each(function(g,f){if(g.getId()==e.dimension.getId()){d=true}c.storeInfo[a.internalId].rendererParams[g.getId()]={fn:"recordOutlineRenderer",group:e,hidden:!d}});c.storeInfo[a.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};b.results.push(a)},processGroupCompact:function(b){var d=this,e=b.group,a=b.previousExpanded,c=[];if(e.record){d.processRecordCompact({results:c,group:e})}else{d.processGroupCompactWithChildren({results:c,group:e,previousExpanded:a})}return c},processGroupCompactWithChildren:function(c){var f=this,b=f.getMatrix(),g=c.group,a=c.previousExpanded,e,d;e=(!g.expanded||(g.expanded&&b.rowSubTotalsPosition=="first"));f.processGroupHeaderRecordCompact({results:c.results,group:g,record:g.expanded?g.records.expanded:g.records.collapsed,previousExpanded:a,hasSummaryData:e});if(g.expanded){if(g.children){for(d=0;d<g.children.length;d++){if(g.children[d]["children"]){f.processGroupCompactWithChildren({results:c.results,group:g.children[d]})}else{f.processRecordCompact({results:c.results,group:g.children[d]})}}}if(b.rowSubTotalsPosition=="last"){f.processGroupHeaderRecordCompact({results:c.results,group:g,record:g.records.footer,previousExpanded:a,subtotalRow:true,hasSummaryData:true})}}},processGroupHeaderRecordCompact:function(d){var g=this,c=g.getMatrix(),h=d.group,a=d.record,b=d.previousExpanded,f=d.subtotalRow,e=d.hasSummaryData;g.storeInfo[a.internalId]={leftKey:h.key,rowStyle:"",rowClasses:[g.getClsGroupTotal(),e?g.getSummaryDataCls():""],rendererParams:{}};g.storeInfo[a.internalId].rendererParams[c.compactViewKey]={fn:"groupCompactRenderer",group:h,colspan:0,previousExpanded:b,subtotalRow:f};g.storeInfo[a.internalId].rendererParams.topaxis={fn:(e?"topAxisRenderer":"topAxisNoRenderer")};d.results.push(a)},processRecordCompact:function(b){var c=this,d=b.group,a=d.record;c.storeInfo[a.internalId]={leftKey:d.key,rowStyle:"",rowClasses:[c.getSummaryDataCls()],rendererParams:{}};c.storeInfo[a.internalId].rendererParams[c.getMatrix().compactViewKey]={fn:"recordCompactRenderer",group:d};c.storeInfo[a.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};b.results.push(a)},doExpandCollapse:function(c,a){var d=this,b=d.getGrid(),e;e=d.getMatrix().leftAxis.findTreeElement("key",c);if(!e){return}d.doExpandCollapseInternal(e.node,a);b.fireEvent((e.node.expanded?"pivotgroupexpand":"pivotgroupcollapse"),b,"row",e.node)},doExpandCollapseInternal:function(i,b){var e=this,g=e.getStore(),a=Ext.toolkit=="classic",d,h,f,c;i.expanded=!i.expanded;h=e.processGroup({group:i,previousExpanded:false});i.expanded=!i.expanded;d=e.processGroup({group:i,previousExpanded:false});if(d.length&&(f=g.indexOf(b))!==-1){if(a){g.suspendEvents()}if(i.expanded){g.remove(g.getAt(f));g.insert(f,d);h=[b]}else{c=h.length;h=g.getRange(f,f+c-1);g.remove(h);g.insert(f,d)}e.removeStoreInfoData(h);if(a){g.resumeEvents();g.fireEvent("replace",g,f,h,d)}}},removeStoreInfoData:function(a){Ext.Array.each(a,function(b){if(this.storeInfo[b.internalId]){delete this.storeInfo[b.internalId]}},this)},onGroupExpand:function(a,b,c){if(b=="row"){if(c){this.doExpandCollapseInternal(c,c.records.collapsed)}else{this.processStore()}}},onGroupCollapse:function(a,b,c){if(b=="row"){if(c){this.doExpandCollapseInternal(c,c.records.expanded)}else{this.processStore()}}}});Ext.define("Ext.pivot.result.Base",{alias:"pivotresult.base",mixins:["Ext.mixin.Factoryable"],leftKey:"",topKey:"",dirty:false,values:null,matrix:null,constructor:function(a){var b=this;Ext.apply(b,a||{});b.values={};return b.callParent(arguments)},destroy:function(){var a=this;a.matrix=a.values=null;a.leftAxisItem=a.topAxisItem=null;return a.callParent(arguments)},calculate:Ext.emptyFn,calculateByFn:Ext.emptyFn,addValue:function(b,a){this.values[b]=a},getValue:function(a){return this.values[a]},getLeftAxisItem:function(){return this.matrix.leftAxis.items.getByKey(this.leftKey)},getTopAxisItem:function(){return this.matrix.topAxis.items.getByKey(this.topKey)}});Ext.define("Ext.pivot.result.Collection",{alternateClassName:["Mz.aggregate.matrix.Results"],requires:["Ext.pivot.MixedCollection","Ext.pivot.result.Base"],resultType:"base",items:null,matrix:null,constructor:function(a){var b=this;Ext.apply(b,a||{});b.items=Ext.create("Ext.pivot.MixedCollection");b.items.getKey=function(c){return c.leftKey+"/"+c.topKey};return b.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.items);a.matrix=a.items=null;a.callParent(arguments)},clear:function(){this.items.clear()},add:function(c,a){var b=this.get(c,a);if(!b){b=this.items.add(Ext.Factory.pivotresult({type:this.resultType,leftKey:c,topKey:a,matrix:this.matrix}))}return b},get:function(b,a){return this.items.getByKey(b+"/"+a)},getByLeftKey:function(b){var a=this.items.filterBy(function(e,c){var d=String(c).split("/");return(b==d[0])});return a.getRange()},getByTopKey:function(b){var a=this.items.filterBy(function(e,c){var d=String(c).split("/");return(d.length>1&&b==d[1])});return a.getRange()},calculate:function(){this.items.each(function(a){a.calculate()})}});Ext.define("Ext.pivot.matrix.Base",{alternateClassName:["Mz.aggregate.matrix.Abstract"],extend:"Ext.util.Observable",alias:"pivotmatrix.base",mixins:["Ext.mixin.Factoryable"],requires:["Ext.util.DelayedTask","Ext.data.ArrayStore","Ext.XTemplate","Ext.pivot.Aggregators","Ext.pivot.MixedCollection","Ext.pivot.axis.Base","Ext.pivot.dimension.Item","Ext.pivot.result.Collection"],resultType:"base",leftAxisType:"base",topAxisType:"base",textRowLabels:"Row labels",textTotalTpl:"Total ({name})",textGrandTotalTpl:"Grand total",keysSeparator:"#_#",grandTotalKey:"grandtotal",compactViewKey:"_compactview_",compactViewColumnWidth:200,viewLayoutType:"outline",rowSubTotalsPosition:"first",rowGrandTotalsPosition:"last",colSubTotalsPosition:"first",colGrandTotalsPosition:"last",showZeroAsBlank:false,leftAxis:null,topAxis:null,aggregate:null,results:null,pivotStore:null,isDestroyed:false,cmp:null,isPivotMatrix:true,constructor:function(b){var a=this.callParent(arguments);this.initialize(true,b);return a},destroy:function(){var a=this;a.delayedTask.cancel();a.delayedTask=null;if(Ext.isFunction(a.onDestroy)){a.onDestroy()}Ext.destroy(a.results,a.leftAxis,a.topAxis,a.aggregate,a.pivotStore);a.results=a.leftAxis=a.topAxis=a.aggregate=a.pivotStore=null;if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}if(Ext.isArray(a.totals)){a.totals.length=0}a.columns=a.model=a.totals=a.keysMap=a.cmp=a.modelInfo=null;a.isDestroyed=true;a.callParent(arguments)},getKey:function(b){var a=this;a.keysMap=a.keysMap||{};if(!Ext.isDefined(a.keysMap[b])){a.keysMap[b]=Ext.id()}return a.keysMap[b]},naturalSort:(function(){var d=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,f=/^\s+|\s+$/g,c=/\s+/g,b=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,e=/^0x[0-9a-f]+$/i,a=/^0/,g=function(i,h){i=i||"";return(!i.match(a)||h==1)&&parseFloat(i)||i.replace(c," ").replace(f,"")||0};return function(q,o){var r=String(q instanceof Date?q.getTime():(q||"")).replace(f,""),n=String(o instanceof Date?o.getTime():(o||"")).replace(f,""),t=r.replace(d,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),l=n.replace(d,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),j=parseInt(r.match(e),16)||(t.length!==1&&Date.parse(r)),u=parseInt(n.match(e),16)||j&&n.match(b)&&Date.parse(n)||null,s,m;if(u){if(j<u){return -1}else{if(j>u){return 1}}}for(var p=0,i=t.length,k=l.length,h=Math.max(i,k);p<h;p++){s=g(t[p],i);m=g(l[p],k);if(isNaN(s)!==isNaN(m)){return(isNaN(s))?1:-1}else{if(typeof s!==typeof m){s+="";m+=""}}if(s<m){return -1}if(s>m){return 1}}return 0}}()),initialize:function(e,a){var d=this,c=["viewLayoutType","rowSubTotalsPosition","rowGrandTotalsPosition","colSubTotalsPosition","colGrandTotalsPosition","showZeroAsBlank"],b;d.initResults();d.initAggregates(a.aggregate||[]);d.initAxis(a.leftAxis||[],a.topAxis||[]);for(b=0;b<c.length;b++){if(a.hasOwnProperty(c[b])){d[c[b]]=a[c[b]]}}d.totals=[];d.modelInfo={};d.keysMap=null;if(e){d.pivotStore=Ext.create("Ext.data.ArrayStore",{autoDestroy:false,fields:[]});d.delayedTask=new Ext.util.DelayedTask(d.startProcess,d);if(Ext.isFunction(d.onInitialize)){d.onInitialize()}}},onInitialize:Ext.emptyFn,onDestroy:Ext.emptyFn,reconfigure:function(a){var b=this,a=Ext.clone(a||{});if(b.fireEvent("beforereconfigure",b,a)!==false){if(Ext.isFunction(b.onReconfigure)){b.onReconfigure(a)}b.fireEvent("reconfigure",b,a);b.initialize(false,a);b.clearData();b.delayedTask.delay(5)}else{b.delayedTask.cancel()}},onReconfigure:Ext.emptyFn,initResults:function(){Ext.destroy(this.results);this.results=Ext.create("Ext.pivot.result.Collection",{resultType:this.resultType,matrix:this})},initAggregates:function(d){var c=this,a,b;Ext.destroy(c.aggregate);c.aggregate=Ext.create("Ext.pivot.MixedCollection");c.aggregate.getKey=function(e){return e.getId()};if(Ext.isEmpty(d)){return}d=Ext.Array.from(d);for(a=0;a<d.length;a++){b=d[a];if(!(b instanceof Ext.pivot.dimension.Item)){Ext.applyIf(b,{isAggregate:true,align:"right",showZeroAsBlank:c.showZeroAsBlank});b.matrix=this;b=Ext.create("Ext.pivot.dimension.Item",b)}c.aggregate.add(b)}},initAxis:function(c,a){var b=this;c=Ext.Array.from(c||[]);a=Ext.Array.from(a||[]);Ext.destroy(b.leftAxis);b.leftAxis=Ext.Factory.pivotaxis({type:b.leftAxisType,matrix:b,dimensions:c,isLeftAxis:true});Ext.destroy(b.topAxis);b.topAxis=Ext.Factory.pivotaxis({type:b.topAxisType,matrix:b,dimensions:a,isLeftAxis:false})},clearData:function(){var a=this;a.fireEvent("cleardata",a);a.leftAxis.clear();a.topAxis.clear();a.results.clear();if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}a.totals=[];a.modelInfo={};a.keysMap=null;if(a.pivotStore){a.pivotStore.removeAll(true)}},startProcess:Ext.emptyFn,endProcess:function(){var a=this;a.leftAxis.getTree();a.topAxis.getTree();a.buildModelAndColumns();a.buildPivotStore();if(Ext.isFunction(a.onBuildStore)){a.onBuildStore(a.pivotStore)}a.fireEvent("storebuilt",a,a.pivotStore);a.fireEvent("done",a)},onBuildModel:Ext.emptyFn,onBuildColumns:Ext.emptyFn,onBuildRecord:Ext.emptyFn,onBuildTotals:Ext.emptyFn,onBuildStore:Ext.emptyFn,buildModelAndColumns:function(){var a=this;a.model=[{name:"id",type:"string"},{name:"isRowGroupHeader",type:"boolean",defaultValue:false},{name:"isRowGroupTotal",type:"boolean",defaultValue:false},{name:"isRowGrandTotal",type:"boolean",defaultValue:false},{name:"leftAxisKey",type:"boolean",defaultValue:null}];a.internalCounter=0;a.columns=[];if(a.viewLayoutType=="compact"){a.generateCompactLeftAxis()}else{a.leftAxis.dimensions.each(function(b){this.parseLeftAxisDimension(b)},a)}if(a.colGrandTotalsPosition=="first"){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:true}))}Ext.Array.each(a.topAxis.getTree(),function(b){this.parseTopAxisItem(b)},a);if(a.colGrandTotalsPosition=="last"){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:true}))}if(Ext.isFunction(a.onBuildModel)){a.onBuildModel(a.model)}a.fireEvent("modelbuilt",a,a.model);if(Ext.isFunction(a.onBuildColumns)){a.onBuildColumns(a.columns)}a.fireEvent("columnsbuilt",a,a.columns)},getDefaultFieldInfo:function(a){return Ext.apply({isColGroupTotal:false,isColGrandTotal:false,leftAxisColumn:false,topAxisColumn:false,topAxisKey:null},a)},parseLeftAxisDimension:function(b){var a=this,c=b.getId();a.model.push({name:c,type:"string"});a.columns.push({dataIndex:c,text:b.header,dimension:b,leftAxis:true});a.modelInfo[c]=a.getDefaultFieldInfo({leftAxisColumn:true})},generateCompactLeftAxis:function(){var a=this;a.model.push({name:a.compactViewKey,type:"string"});a.columns.push({dataIndex:a.compactViewKey,text:a.textRowLabels,leftAxis:true,width:a.compactViewColumnWidth});a.modelInfo[a.compactViewKey]=a.getDefaultFieldInfo({leftAxisColumn:true})},parseTopAxisItem:function(e){var d=this,b=[],a=[],g,c,f=false;if(!e.children){b=d.parseAggregateForColumn(e,null);if(e.level===0){d.columns.push(b)}else{return b}}else{if(d.colSubTotalsPosition=="first"){c=d.addColSummary(e);if(c){a.push(c)}}Ext.Array.each(e.children,function(i){var h=d.parseTopAxisItem(i);if(Ext.isArray(h)){b=Ext.Array.merge(b,h)}else{b.push(h)}});g={text:e.name,group:e,columns:b,key:e.key,xexpandable:true,xgrouped:true};if(e.level===0){d.columns.push(g)}a.push(g);if(d.colSubTotalsPosition=="last"){c=d.addColSummary(e);if(c){a.push(c)}}if(d.colSubTotalsPosition=="none"){c=d.addColSummary(e);if(c){a.push(c)}}return a}},addColSummary:function(c){var b=this,a,d=false;a=b.parseAggregateForColumn(c,{text:c.expanded?c.getTextTotal():c.name,group:c,subTotal:true});if(c.level===0){b.columns.push(a)}Ext.apply(a,{key:c.key,xexpandable:true,xgrouped:true});return a},parseAggregateForColumn:function(j,c){var g=this,e=[],d={},a=g.aggregate.getRange(),b=a.length,f,h;for(f=0;f<b;f++){h=a[f];g.internalCounter++;g.model.push({name:"c"+g.internalCounter,type:"auto",defaultValue:undefined,useNull:true,col:j?j.key:g.grandTotalKey,agg:h.getId()});e.push({dataIndex:"c"+g.internalCounter,text:h.header,topAxis:true,subTotal:(c?c.subTotal===true:false),grandTotal:(c?c.grandTotal===true:false),dimension:h});g.modelInfo["c"+g.internalCounter]=g.getDefaultFieldInfo({isColGroupTotal:(c?c.subTotal===true:false),isColGrandTotal:(c?c.grandTotal===true:false),topAxisColumn:true,topAxisKey:j?j.key:g.grandTotalKey})}if(e.length==0&&g.aggregate.getCount()==0){g.internalCounter++;d=Ext.apply({text:j?j.name:"",dataIndex:"c"+g.internalCounter},c||{})}else{if(e.length==1){d=Ext.applyIf({text:j?j.name:""},e[0]);Ext.apply(d,c||{});if(c&&c.grandTotal&&g.aggregate.getCount()==1){d.text=g.aggregate.getAt(0).header||c.text}}else{d=Ext.apply({text:j?j.name:"",columns:e},c||{})}}return d},buildPivotStore:function(){var a=this;if(Ext.isFunction(a.pivotStore.model.setFields)){a.pivotStore.model.setFields(a.model)}else{a.pivotStore.model.replaceFields(a.model,true)}a.pivotStore.removeAll(true);Ext.Array.each(a.leftAxis.getTree(),a.addRecordToPivotStore,a);a.addGrandTotalsToPivotStore()},addGrandTotalsToPivotStore:function(){var b=this,a=[];a.push({title:b.textGrandTotalTpl,values:b.preparePivotStoreRecordData({key:b.grandTotalKey},{isRowGrandTotal:true})});if(Ext.isFunction(b.onBuildTotals)){b.onBuildTotals(a)}b.fireEvent("buildtotals",b,a);Ext.Array.forEach(a,function(c){if(Ext.isObject(c)&&Ext.isObject(c.values)){Ext.applyIf(c.values,{isRowGrandTotal:true});b.totals.push({title:c.title||"",record:b.pivotStore.add(c.values)[0]})}})},addRecordToPivotStore:function(d){var c=this,a,b;if(!d.children){a=c.pivotStore.add(c.preparePivotStoreRecordData(d))[0];d.record=a;if(Ext.isFunction(c.onBuildRecord)){c.onBuildRecord(a)}c.fireEvent("recordbuilt",c,a)}else{d.records={};b=(c.viewLayoutType=="outline"?d.dimensionId:c.compactViewKey);d.records.collapsed=c.pivotStore.add(c.preparePivotStoreRecordData(d,{isRowGroupHeader:true,isRowGroupTotal:true}))[0];if(c.rowSubTotalsPosition=="first"){d.records.expanded=c.pivotStore.add(c.preparePivotStoreRecordData(d,{isRowGroupHeader:true}))[0]}else{a={};a[b]=d.name;a.isRowGroupHeader=true;d.records.expanded=c.pivotStore.add(a)[0];if(c.rowSubTotalsPosition=="last"){a=c.preparePivotStoreRecordData(d,{isRowGroupTotal:true});a[b]=d.getTextTotal();d.records.footer=c.pivotStore.add(a)[0]}}Ext.Array.each(d.children,function(e){c.addRecordToPivotStore(e)})}},preparePivotStoreRecordData:function(d,a){var b=this,c={};if(d){if(d.dimensionId){c[d.dimensionId]=d.name}c.leftAxisKey=d.key;Ext.Array.each(b.model,function(f){var e;if(f.col&&f.agg){e=b.results.get(d.key,f.col);if(e){c[f.name]=e.getValue(f.agg)}}});if(b.viewLayoutType=="compact"){c[b.compactViewKey]=d.name}}return Ext.applyIf(c,a)},getColumns:function(){return this.model},getColumnHeaders:function(){var a=this;if(!a.model){a.buildModelAndColumns()}return a.columns},isGroupRow:function(a){var b=this.leftAxis.findTreeElement("key",a);if(!b){return false}return(b.node.children&&b.node.children.length==0)?0:b.level},isGroupCol:function(a){var b=this.topAxis.findTreeElement("key",a);if(!b){return false}return(b.node.children&&b.node.children.length==0)?0:b.level},deprecated:{"6.0":{properties:{mztype:"type",mztypeLeftAxis:"leftAxisType",mztypeTopAxis:"topAxisType"}}}});Ext.define("Ext.pivot.result.Local",{extend:"Ext.pivot.result.Base",alias:"pivotresult.local",alternateClassName:["Mz.aggregate.matrix.Result"],records:null,constructor:function(a){this.records=[];return this.callParent(arguments)},destroy:function(){this.records.length=0;this.records=null;return this.callParent(arguments)},calculate:function(){var c=this,a,d,b=c.matrix.aggregate.getCount();for(a=0;a<b;a++){d=c.matrix.aggregate.getAt(a);c.addValue(d.getId(),Ext.callback(d.aggregatorFn,d.getScope()||"self.controller",[c.records,d.dataIndex,c.matrix,c.leftKey,c.topKey],0,c.matrix.cmp))}},calculateByFn:function(d,c,a){var e=this,b;if(Ext.isString(a)){a=Ext.pivot.Aggregators[a]}b=a(e.records,c,e.matrix,e.leftKey,e.topKey);e.addValue(d,b);return b},addRecord:function(a){this.records.push(a)}});Ext.define("Ext.pivot.matrix.Local",{alternateClassName:["Mz.aggregate.matrix.Local"],extend:"Ext.pivot.matrix.Base",alias:"pivotmatrix.local",requires:["Ext.pivot.matrix.Base","Ext.pivot.axis.Local","Ext.pivot.result.Local"],resultType:"local",leftAxisType:"local",topAxisType:"local",store:null,recordsPerJob:1000,timeBetweenJobs:2,onInitialize:function(){var a=this;a.localDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.newRecordsDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreAddDelayed,a);a.updateRecordsDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreUpdateDelayed,a);a.initializeStore({store:a.store});a.callParent(arguments)},initializeStore:function(c){var d=this,a,b;if(c.store){b=c.store}else{if(d.store){if(d.store.isStore&&!d.storeListeners){a=d.store}else{b=d.store}}}if(b){a=Ext.getStore(b||"");if(Ext.isEmpty(a)&&Ext.isString(b)){a=Ext.create(b)}}if(a&&a.isStore){Ext.destroy(d.storeListeners);if(d.store&&d.store.autoDestroy&&a!=d.store){Ext.destroy(d.store)}d.store=a;d.storeListeners=d.store.on({refresh:d.startProcess,beforeload:d.onOriginalStoreBeforeLoad,add:d.onOriginalStoreAdd,update:d.onOriginalStoreUpdate,remove:d.onOriginalStoreRemove,clear:d.startProcess,scope:d,destroyable:true});if(a.isLoaded()){d.startProcess()}}},onReconfigure:function(a){this.initializeStore(a);this.callParent(arguments)},onDestroy:function(){var a=this;a.localDelayedTask.cancel();a.localDelayedTask=null;a.newRecordsDelayedTask.cancel();a.newRecordsDelayedTask=null;a.updateRecordsDelayedTask.cancel();a.updateRecordsDelayedTask=null;if(Ext.isArray(a.records)){a.records.length=0}a.records=null;Ext.destroy(a.storeListeners);if(a.store&&a.store.isStore&&a.store.autoDestroy){Ext.destroy(a.store)}a.store=a.storeListeners=null;a.callParent(arguments)},onOriginalStoreBeforeLoad:function(a){this.fireEvent("start",this)},onOriginalStoreAdd:function(b,a){var c=this;c.newRecords=c.newRecords||[];c.newRecords=Ext.Array.merge(c.newRecords,Ext.Array.from(a));c.newRecordsDelayedTask.delay(100)},onOriginalStoreAddDelayed:function(){var c=this,b,a;a=Ext.Array.from(c.newRecords||[]);for(b=0;b<a.length;b++){c.processRecord(a[b],b,a.length)}c.newRecords=[];c.leftAxis.tree=null;c.leftAxis.buildTree();c.topAxis.tree=null;c.topAxis.buildTree();c.recalculateResults(c.store,a)},onOriginalStoreUpdate:function(b,a){var c=this;c.updateRecords=c.updateRecords||[];c.updateRecords=Ext.Array.merge(c.updateRecords,Ext.Array.from(a));c.updateRecordsDelayedTask.delay(100)},onOriginalStoreUpdateDelayed:function(){var a=this;a.recalculateResults(a.store,a.updateRecords);a.updateRecords.length=0},onOriginalStoreRemove:function(c,a,d,b){if(b){return}this.startProcess()},isReallyDirty:function(b,a){var c=true;a=Ext.Array.from(a);this.leftAxis.dimensions.each(function(d){Ext.Array.forEach(a,function(e){c=(e&&e.isModel&&d.getValues().containsKey(e.get(d.dataIndex)));return c});return c});return !c},recalculateResults:function(b,a){var c=this;if(c.isReallyDirty(b,a)){c.startProcess();return}c.fireEvent("beforeupdate",c);c.results.calculate();Ext.Array.each(c.leftAxis.getTree(),c.updateRecordToPivotStore,c);c.updateGrandTotalsToPivotStore();c.fireEvent("afterupdate",c)},updateGrandTotalsToPivotStore:function(){var c=this,b=[],a;if(c.totals.length<=0){return}b.push({title:c.textGrandTotalTpl,values:c.preparePivotStoreRecordData({key:c.grandTotalKey})});if(Ext.isFunction(c.onBuildTotals)){c.onBuildTotals(b)}c.fireEvent("buildtotals",c,b);if(c.totals.length===b.length){for(a=0;a<c.totals.length;a++){if(Ext.isObject(b[a])&&Ext.isObject(b[a].values)&&(c.totals[a].record instanceof Ext.data.Model)){delete (b[a].values.id);c.totals[a].record.set(b[a].values)}}}},updateRecordToPivotStore:function(c){var b=this,a,d;if(!c.children){if(c.record){d=b.preparePivotStoreRecordData(c);delete (d.id);c.record.set(d)}}else{if(c.records){a=(b.viewLayoutType=="outline"?c.dimensionId:b.compactViewKey);d=b.preparePivotStoreRecordData(c);delete (d.id);delete (d[a]);c.records.collapsed.set(d);if(b.rowSubTotalsPosition=="first"){c.records.expanded.set(d)}else{if(b.rowSubTotalsPosition=="last"){c.records.footer.set(d)}}}Ext.Array.each(c.children,b.updateRecordToPivotStore,b)}},startProcess:function(){var a=this;if(!a.store||(a.store&&!a.store.isStore)||a.isDestroyed||a.store.isLoading()){return}a.clearData();a.localDelayedTask.delay(50)},delayedProcess:function(){var a=this;a.fireEvent("start",a);a.records=a.store.getRange();if(a.records.length==0){a.endProcess();return}a.statusInProgress=false;a.processRecords(0)},processRecords:function(a){var c=this,b=a,d;if(c.isDestroyed){return}d=c.records.length;c.statusInProgress=true;while(b<d&&b<a+c.recordsPerJob&&c.statusInProgress){c.processRecord(c.records[b],b,d);b++}if(b>=d){c.statusInProgress=false;c.results.calculate();c.leftAxis.buildTree();c.topAxis.buildTree();if(c.filterApplied){c.results.calculate()}c.records=null;c.endProcess();return}if(c.statusInProgress&&d>0){Ext.defer(c.processRecords,c.timeBetweenJobs,c,[b])}},processRecord:function(e,f,a){var g=this,h=g.grandTotalKey,k,b,d,c;k=g.leftAxis.processRecord(e);b=g.topAxis.processRecord(e);if(k&&b){g.results.add(h,h).addRecord(e);for(d=0;d<b.length;d++){g.topAxis.addItem(b[d]);g.results.add(h,b[d].key).addRecord(e)}for(d=0;d<k.length;d++){g.leftAxis.addItem(k[d]);g.results.add(k[d].key,h).addRecord(e);for(c=0;c<b.length;c++){g.results.add(k[d].key,b[c].key).addRecord(e)}}}g.fireEvent("progress",g,f+1,a)},getRecordsByRowGroup:function(d){var c=this.results.getByLeftKey(d),e=c.length,a=[],b;for(b=0;b<e;b++){a=Ext.Array.merge(a,c[b].records||[])}return a},getRecordsByColGroup:function(d){var c=this.results.getByTopKey(d),e=c.length,a=[],b;for(b=0;b<e;b++){a=Ext.Array.merge(a,c[b].records||[])}return a},getRecordsByGroups:function(c,b){var a=this.results.get(c,b);return(a?a.records||[]:[])}});Ext.define("Ext.pivot.matrix.Remote",{alternateClassName:["Mz.aggregate.matrix.Remote"],extend:"Ext.pivot.matrix.Base",alias:"pivotmatrix.remote",url:"",timeout:3000,onBeforeRequest:Ext.emptyFn,onRequestException:Ext.emptyFn,onInitialize:function(){var a=this;a.remoteDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.callParent(arguments)},startProcess:function(){var a=this;if(Ext.isEmpty(a.url)){return}a.clearData();a.fireEvent("start",a);a.statusInProgress=false;a.remoteDelayedTask.delay(5)},delayedProcess:function(){var e=this,d=[],a=[],c=[],b,f;e.leftAxis.dimensions.each(function(g){d.push(g.serialize())});e.topAxis.dimensions.each(function(g){a.push(g.serialize())});e.aggregate.each(function(g){c.push(g.serialize())});f={keysSeparator:e.keysSeparator,grandTotalKey:e.grandTotalKey,leftAxis:d,topAxis:a,aggregate:c};b=e.fireEvent("beforerequest",e,f);if(b!==false){if(Ext.isFunction(e.onBeforeRequest)){b=e.onBeforeRequest(f)}}if(b===false){e.endProcess()}else{Ext.Ajax.request({url:e.url,timeout:e.timeout,jsonData:f,callback:e.processRemoteResults,scope:e})}},processRemoteResults:function(b,f,a){var d=this,c=!f,e=Ext.JSON.decode(a.responseText,true);if(f){c=(!e||!e.success)}if(c){d.fireEvent("requestexception",d,a);if(Ext.isFunction(d.onRequestException)){d.onRequestException(a)}d.endProcess();return}Ext.Array.each(Ext.Array.from(e.leftAxis||[]),function(g){if(Ext.isObject(g)){d.leftAxis.addItem(g)}});Ext.Array.each(Ext.Array.from(e.topAxis||[]),function(g){if(Ext.isObject(g)){d.topAxis.addItem(g)}});Ext.Array.each(Ext.Array.from(e.results||[]),function(h){if(Ext.isObject(h)){var g=d.results.add(h.leftKey||"",h.topKey||"");Ext.Object.each(h.values||{},g.addValue,g)}});d.endProcess()}});Ext.define("Ext.pivot.plugin.Exporter",{alternateClassName:["Mz.pivot.plugin.ExcelExport"],alias:["plugin.pivotexporter","plugin.mzexcelexport"],extend:"Ext.exporter.Plugin",lockableScope:"top",init:function(b){var a=this;return a.callParent([b])},prepareData:function(b){var h=this,o=new Ext.exporter.data.Table(),m,n,c,a,k,f,e,g,d,l,p;h.matrix=m=h.cmp.getMatrix();h.onlyExpandedNodes=(b&&b.onlyExpandedNodes);if(!h.onlyExpandedNodes){h.setColumnsExpanded(m.topAxis.getTree(),true)}c=Ext.clone(m.getColumnHeaders());a=h.getColumnHeaders(c,b);l=h.getDataIndexColumns(c);if(!h.onlyExpandedNodes){h.setColumnsExpanded(m.topAxis.getTree())}n=o.addGroup({text:""});h.extractGroups(n,m.leftAxis.getTree(),l);d=m.totals.length;g=l.length;for(f=0;f<d;f++){k=m.totals[f];p=n.addSummary();p.addCell({value:k.title});for(e=1;e<g;e++){p.addCell({value:h.getRecordValue(k.record,l[e])})}}h.matrix=h.onlyExpandedNodes=null;o.addGroup(n);o.setColumns(a);return o},setColumnsExpanded:function(b,a){for(var c=0;c<b.length;c++){if(Ext.isDefined(a)){b[c].backupExpanded=b[c].expanded;b[c].expanded=a}else{b[c].expanded=b[c].backupExpanded;b[c].backupExpanded=null}if(b[c].children){this.setColumnsExpanded(b[c].children,a)}}},getColumnHeaders:function(e,b){var h=[],f=e.length,d,g,a,c;for(d=0;d<f;d++){a=e[d];c=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):true;if(c){g={text:(a.subTotal&&a.group.expanded?a.group.getTextTotal():a.text)};if(a.columns){g.columns=this.getColumnHeaders(a.columns,b)}else{g.width=a.dimension?a.dimension.getWidth():a.width||100;g.style=a.dimension?this.getExportStyle(a.dimension.getExportStyle(),b):null}h.push(g)}}return h},getRecordValue:function(a,c){var b=a.data;return(Ext.isEmpty(b[c.dataIndex])||(this.matrix.showZeroAsBlank&&b[c.dataIndex]===0))?"":b[c.dataIndex]},getDataIndexColumns:function(d){var e=[],c,a,b;for(c=0;c<d.length;c++){a=d[c];b=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):true;if(b){if(a.dataIndex){e.push({dataIndex:a.dataIndex,agg:a.dimension?a.dimension.getId():null})}else{if(a.columns){e=Ext.Array.merge(e,this.getDataIndexColumns(a.columns))}}}}return e},extractGroups:function(l,h,b){var d,c,a,k,f,m,n,g,e;a=h.length;for(d=0;d<a;d++){m=h[d];if(m.record){n=l.addRow();for(c=0;c<b.length;c++){n.addCell({value:this.getRecordValue(m.record,b[c])})}}else{if(m.children){g=l.addGroup({text:m.name});f=this.onlyExpandedNodes?m.expanded:true;if(f){this.extractGroups(g,m.children,b)}n=g.addSummary();n.addCell({value:(f?m.getTextTotal():m.value)});e=(m.expanded?m.records.expanded:m.records.collapsed);k=b.length;for(c=1;c<k;c++){n.addCell({value:this.getRecordValue(e,b[c])})}l.addGroup(g)}}}return l}});Ext.define("Ext.pivot.plugin.configurator.FieldSettings",{$configStrict:false,config:{cls:"",style:null,fixed:[],allowed:["leftAxis","topAxis","aggregate"],aggregators:["sum","avg","min","max","count","groupSumPercentage","groupCountPercentage","variance","varianceP","stdDev","stdDevP"],renderers:{},formatters:{}},isFieldSettings:true,constructor:function(a){this.initConfig(a||{});return this.callParent(arguments)},getDefaultEmptyArray:function(b){var a=this["_"+b];if(!a){a=[];this["set"+Ext.String.capitalize(b)](a)}return a},applyArrayValues:function(c,b,a){if(b==null||(b&&Ext.isArray(b))){return b}if(b){if(!a){a=this["get"+Ext.String.capitalize(c)]()}Ext.Array.splice(a,0,a.length,b)}return a},getFixed:function(){return this.getDefaultEmptyArray("fixed")},applyFixed:function(b,a){return this.applyArrayValues("fixed",b,a)},getAllowed:function(){return this.getDefaultEmptyArray("allowed")},applyAllowed:function(b,a){return this.applyArrayValues("allowed",b,a)},getAggregators:function(){return this.getDefaultEmptyArray("aggregators")},applyAggregators:function(b,a){return this.applyArrayValues("aggregators",b,a)},isFixed:function(b){var a;if(!b){return false}a=b.getFieldType();return Ext.Array.indexOf(this.getFixed(),a)>=0},isAllowed:function(b){var c=this.getFixed(),a;if(!b){return false}a=b.getFieldType();if(c.length){return Ext.Array.indexOf(c,a)>=0}return(a==="all")||(Ext.Array.indexOf(this.getAllowed(),a)>=0)}});Ext.define("Ext.pivot.plugin.configurator.Field",{extend:"Ext.pivot.dimension.Item",requires:["Ext.pivot.plugin.configurator.FieldSettings"],config:{settings:{}},isField:true,clone:function(){return new Ext.pivot.plugin.configurator.Field(Ext.applyIf({id:Ext.id()},this.getInitialConfig()))},serialize:function(){var a=this.callParent(arguments);return Ext.apply(a,{settings:a.settings.getConfig()})},applyAggregator:function(a,c){var d=this.getSettings(),b=d.getAggregators();if(b.length==0){Ext.Array.remove(d.getDrop(),"aggregate")}else{if(Ext.Array.indexOf(b,a)<0){a=b[0]}}return this.callParent(arguments)},getSettings:function(){var a=this.settings;if(!a){a=new Ext.pivot.plugin.configurator.FieldSettings({});this.setSettings(a)}return a},applySettings:function(a,b){if(a==null||(a&&a.isFieldSettings)){return a}if(a){if(!b){b=this.getSettings()}b.setConfig(a)}if(b){this.setAggregator(this.getAggregator())}return b},getFieldText:function(){var a=this.getHeader();if(this.isAggregate){a+=" ("+this.getAggText()+")"}return a},getAggText:function(a){var c=Ext.pivot.Aggregators,b=a||this.getAggregator();if(Ext.isFunction(b)){return c.customText}return c[b+"Text"]||c.customText}});Ext.define("Ext.pivot.update.Base",{extend:"Ext.mixin.Observable",alias:"pivotupdate.base",mixins:["Ext.mixin.Factoryable"],config:{leftKey:null,topKey:null,matrix:null,dataIndex:null,value:null},destroy:function(){this.setMatrix(null);this.callParent()},getResult:function(){var a=this.getMatrix();return a?a.results.get(this.getLeftKey(),this.getTopKey()):null},update:function(){var a=this;return new Ext.Promise(function(d,c){var b=a.getResult();if(b){if(a.fireEvent("beforeupdate",a)!==false){Ext.asap(a.onUpdate,a,[b,d,c])}else{c("Operation canceled!")}}else{c("No Result found!")}})},onUpdate:function(a,c,b){this.fireEvent("update",this);c(this)}});Ext.define("Ext.pivot.update.Increment",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.increment",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=parseFloat(this.getValue()),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,c[d].get(e)+f)}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Overwrite",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.overwrite",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=this.getValue(),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,f)}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Percentage",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.percentage",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=parseFloat(this.getValue()),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,Math.floor(c[d].get(e)*f/100))}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Uniform",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.uniform",onUpdate:function(b,g,f){var e=this.getDataIndex(),c=b.records,a,d,h;if(c){a=c.length;if(a>0){h=(parseFloat(this.getValue())/a);for(d=0;d<a;d++){c[d].set(e,h)}}}this.callParent([b,g,f])}});Ext.define("Ext.pivot.cell.Cell",{extend:"Ext.grid.cell.Cell",xtype:"pivotgridcell",groupHeaderCollapsedCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsed",outlineCellHiddenCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-hidden",outlineCellGroupExpandedCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-previous-expanded",compactGroupHeaderCls:Ext.baseCSSPrefix+"pivot-grid-group-header-compact",compactLayoutPadding:25,groupCls:Ext.baseCSSPrefix+"pivot-grid-group",groupHeaderCls:Ext.baseCSSPrefix+"pivot-grid-group-header",groupHeaderCollapsibleCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsible",summaryDataCls:Ext.baseCSSPrefix+"pivot-summary-data",summaryRowCls:Ext.baseCSSPrefix+"pivot-grid-group-total",grandSummaryRowCls:Ext.baseCSSPrefix+"pivot-grid-grand-total",encodeHtml:false,constructor:function(){var e=this,c=e.callParent(arguments),b=e.getViewModel(),d=e.dataIndex,a=e.getRecord();if(b&&d){b.set("column",e.parent.getGrid().getMatrix().modelInfo[d]||{});b.set("value",e.getValue());b.set("record",a?a.data:{})}return c},handleEvent:function(g,o){var r=this,a=r.parent.getGrid(),i=r.parent,f=r.getRecord(),q={grid:a},p,h,b,c,s,l,k,m,n,d,j;if(!f){return}if(i.element.hasCls(r.grandSummaryRowCls)){h="pivottotal"}else{if(i.element.hasCls(r.summaryRowCls)){h="pivotgroup"}else{if(i.element.hasCls(r.summaryDataCls)){h="pivotitem"}}}p=i.getRecordInfo(f);n=a.getMatrix();k=p.leftKey;d=n.leftAxis.findTreeElement("key",k);d=d?d.node:null;Ext.apply(q,{cell:r,leftKey:k,leftItem:d});q.column=r.getColumn();if(!r.element.hasCls(r.groupHeaderCls)){h+="cell";m=a.getTopAxisKey(q.column);q.topKey=m;if(m){j=n.topAxis.findTreeElement("key",m);j=j?j.node:null;if(j){Ext.apply(q,{topItem:j,dimensionId:j.dimensionId})}}}s=a.fireEvent(h+g,q,o);if(s!==false&&g=="tap"&&r.element.hasCls(r.groupHeaderCollapsibleCls)){if(d.expanded){d.collapse()}else{d.expand()}}return false},updateRecord:function(b,a){var c=this.getViewModel();this.callParent([b,a]);if(c){c.set("value",this.getValue());c.set("record",b?b.data:{})}}});Ext.define("Ext.pivot.cell.Group",{extend:"Ext.pivot.cell.Cell",xtype:"pivotgridgroupcell",config:{innerGroupStyle:null,innerGroupCls:null,userGroupStyle:null,userGroupCls:null},element:{reference:"element",cls:Ext.baseCSSPrefix+"grid-cell",children:[{reference:"innerElement",cls:Ext.baseCSSPrefix+"grid-cell-inner ",children:[{reference:"groupElement",cls:Ext.baseCSSPrefix+"pivot-grid-group-title"}]}]},updateInnerGroupStyle:function(a){this.groupElement.applyStyles(a)},updateInnerGroupCls:function(a,b){this.groupElement.replaceCls(b,a)},updateUserGroupStyle:function(a){this.groupElement.applyStyles(a)},updateUserGroupCls:function(a,b){this.groupElement.replaceCls(b,a)},updateRawValue:function(a){var b=this.groupElement.dom;if(this.getEncodeHtml()){b.textContent=a}else{b.innerHTML=a}},updateRecord:function(b,a){var d=this,e=d.parent.getRecordInfo(),c=d.dataIndex;if(e&&c){e=e.rendererParams[c];if(e&&d[e.fn]){d[e.fn](e,d.parent.getGrid())}}d.callParent(arguments)},groupOutlineRenderer:function(a,b){var c=this,d="";if(b.getMatrix().viewLayoutType=="compact"){c.setInnerGroupStyle((b.isRTL()?"margin-right: ":"margin-left: ")+"0px;")}if(a.colspan>0){d+=c.groupHeaderCls;if(!a.subtotalRow){d+=" "+c.groupHeaderCollapsibleCls;if(!a.group.expanded){d+=" "+c.groupHeaderCollapsedCls}if(a.previousExpanded){d+=" "+c.outlineCellGroupExpandedCls}}c.setCellCls(d);c.setInnerGroupCls(c.groupCls);return}c.setCellCls(c.outlineCellHiddenCls)},recordOutlineRenderer:function(a,b){var c=this;if(a.hidden){c.setCellCls(c.outlineCellHiddenCls);return}c.setCellCls(c.groupHeaderCls)},groupCompactRenderer:function(a,b){var c=this,d="";c.setInnerGroupStyle((b.isRTL()?"margin-right: ":"margin-left: ")+(c.compactLayoutPadding*a.group.level)+"px;");d+=c.groupHeaderCls+" "+c.compactGroupHeaderCls;if(!a.subtotalRow){d+=" "+c.groupHeaderCollapsibleCls;if(!a.group.expanded){d+=" "+c.groupHeaderCollapsedCls}if(a.previousExpanded){d+=" "+c.outlineCellGroupExpandedCls}}c.setCellCls(d);c.setInnerGroupCls(c.groupCls)},recordCompactRenderer:function(a,b){var c=this,d=[];c.setInnerGroupStyle((b.isRTL()?"margin-right: ":"margin-left: ")+(c.compactLayoutPadding*a.group.level)+"px;");c.setCellCls(c.groupHeaderCls+" "+c.compactGroupHeaderCls)}});Ext.define("Ext.pivot.Row",{extend:"Ext.grid.Row",xtype:"pivotgridrow",requires:["Ext.pivot.cell.Group"],config:{recordInfo:null,rowCls:null},initialize:function(){var a=this.getViewModel();if(a){a.set("columns",this.getGrid().getMatrix().modelInfo)}return this.callParent(arguments)},destroy:function(){this.setRecordInfo(null);this.callParent()},updateRowCls:function(b,a){this.element.replaceCls(a,b)},updateRecord:function(b,a){var c=this,d=c.getGrid().getRecordInfo(b);c.setRecordInfo(d);if(d){c.setRowCls(d.rowClasses)}c.callParent([b,a])}});Ext.define("Ext.pivot.Grid",{extend:"Ext.grid.Grid",xtype:"pivotgrid",requires:["Ext.LoadMask","Ext.pivot.Row","Ext.pivot.feature.PivotStore","Ext.pivot.matrix.Local","Ext.pivot.matrix.Remote","Ext.data.ArrayStore"],isPivotGrid:true,matrixConfig:null,enableLoadMask:true,enableColumnSort:true,viewLayoutType:"outline",rowSubTotalsPosition:"first",rowGrandTotalsPosition:"last",colSubTotalsPosition:"last",colGrandTotalsPosition:"last",textTotalTpl:"Total ({name})",textGrandTotalTpl:"Grand total",leftAxis:null,topAxis:null,aggregate:null,startRowGroupsCollapsed:true,startColGroupsCollapsed:true,showZeroAsBlank:false,cellSelector:"."+Ext.baseCSSPrefix+"grid-cell",clsGroupTotal:Ext.baseCSSPrefix+"pivot-grid-group-total",clsGrandTotal:Ext.baseCSSPrefix+"pivot-grid-grand-total",groupHeaderCollapsedCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsed",groupHeaderCollapsibleCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsible",summaryDataCls:Ext.baseCSSPrefix+"pivot-summary-data",groupCls:Ext.baseCSSPrefix+"pivot-grid-group",relayedMatrixEvents:["beforereconfigure","reconfigure","start","progress","done","modelbuilt","columnsbuilt","recordbuilt","buildtotals","storebuilt","groupexpand","groupcollapse","beforerequest","requestexception"],config:{matrix:null,leftAxisCellConfig:{xtype:"pivotgridgroupcell"},topAxisCellConfig:{xtype:"pivotgridcell"}},defaultType:"pivotgridrow",initialize:function(){var c=this,a={},b;c.setColumns([]);c.setStore(Ext.create("Ext.data.ArrayStore",{fields:[]}));c.addCls(Ext.baseCSSPrefix+"pivot-grid");c.pivotDataSource=new Ext.pivot.feature.PivotStore({store:c.getStore(),grid:c,clsGrandTotal:c.clsGrandTotal,clsGroupTotal:c.clsGroupTotal,summaryDataCls:c.summaryDataCls});c.getHeaderContainer().on({columntap:"handleColumnTap",headergrouptap:"handleHeaderGroupTap",scope:c});b=c.callParent(arguments);Ext.apply(a,{leftAxis:c.leftAxis,topAxis:c.topAxis,aggregate:c.aggregate,showZeroAsBlank:c.showZeroAsBlank,textTotalTpl:c.textTotalTpl,textGrandTotalTpl:c.textGrandTotalTpl,viewLayoutType:c.viewLayoutType,rowSubTotalsPosition:c.rowSubTotalsPosition,rowGrandTotalsPosition:c.rowGrandTotalsPosition,colSubTotalsPosition:c.colSubTotalsPosition,colGrandTotalsPosition:c.colGrandTotalsPosition});Ext.applyIf(a,c.matrixConfig||{});c.setMatrix(a);return b},destroy:function(){var a=this;Ext.destroy(a.matrixRelayedListeners,a.matrixListeners,a.headerCtListeners,a.lockedHeaderCtListeners);Ext.destroy(a.pivotDataSource);a.matrixRelayedListeners=a.matrixListeners=a.headerCtListeners=a.lockedHeaderCtListeners=null;a.setMatrix(null);a.callParent();a.lastColumnSorted=a.store=Ext.destroy(a.store)},updateTopAxisCellConfig:function(c){var a=this.getMatrix(),b;b=a?a.showZeroAsBlank:this.showZeroAsBlank;if(Ext.isObject(c)){Ext.apply(c,{zeroValue:b?"":"0"})}},applyMatrix:function(b,a){Ext.destroy(a);if(b==null){return b}if(b&&b.isPivotMatrix){b.cmp=this;return b}Ext.applyIf(b,{type:"local"});b.cmp=this;return Ext.Factory.pivotmatrix(b)},updateMatrix:function(b,a){var c=this;Ext.destroy(a,c.matrixListeners,c.matrixRelayedListeners);if(b){c.matrixListeners=b.on({cleardata:c.onMatrixClearData,start:c.onMatrixProcessStart,progress:c.onMatrixProcessProgress,done:c.onMatrixDataReady,beforeupdate:c.onMatrixBeforeUpdate,afterupdate:c.onMatrixAfterUpdate,groupexpand:c.onMatrixGroupExpandCollapse,groupcollapse:c.onMatrixGroupExpandCollapse,scope:c,destroyable:true});c.matrixRelayedListeners=c.relayEvents(b,c.relayedMatrixEvents,"pivot");if(c.pivotDataSource){c.pivotDataSource.setMatrix(b)}}},refreshView:function(){var a=this;if(a.destroyed||a.destroying){return}a.getStore().fireEvent("pivotstoreremodel",a)},updateHeaderContainerColumns:function(h){var f=this,b=0,g,a,d,e,c;if(h){c=f.getColumnForGroup(f.getHeaderContainer().innerItems,h);if(c.found){d=c.item.getParent();a=c.index;while(b<d.items.length){e=d.items.getAt(b);if(e.group==h){Ext.destroy(e)}else{b++}}g=Ext.clone(f.pivotColumns);f.preparePivotColumns(g);g=f.getVisiblePivotColumns(f.prepareVisiblePivotColumns(g),h);d.insert(a,g)}}else{g=Ext.clone(f.pivotColumns);f.preparePivotColumns(g);f.setColumns(g)}},getColumnForGroup:function(a,f){var e=a.length,b={found:false,index:-1,item:null},c,d;for(c=0;c<e;c++){d=a[c];if(d.group==f){b.found=true;b.index=c;b.item=d}else{if(d.innerItems){b=this.getColumnForGroup(d.innerItems,f)}}if(b.found){break}}return b},onMatrixClearData:function(){var a=this;a.getStore().removeAll(true);if(!a.expandedItemsState){a.lastColumnsState=null}a.sortedColumn=null},onMatrixProcessStart:function(){if(this.enableLoadMask){this.setMasked({xtype:"loadmask",indicator:true})}},onMatrixProcessProgress:function(a,b,d){var c=((b||0.1)*100)/(d||0.1);if(this.enableLoadMask){this.getMasked().setMessage(Ext.util.Format.number(c,"0")+"%")}},onMatrixBeforeUpdate:function(){this.getStore().suspendEvents()},onMatrixAfterUpdate:function(){var a=this.getStore();a.resumeEvents();a.fireEvent("pivotstoreremodel")},onMatrixDataReady:function(){var c=this,b=c.getMatrix(),d=b.getColumnHeaders(),a=false;if(c.enableLoadMask){c.setMasked(false)}if(c.expandedItemsState){b.leftAxis.items.each(function(e){if(Ext.Array.indexOf(c.expandedItemsState.rows,e.key)>=0){e.expanded=true;a=true}});b.topAxis.items.each(function(e){if(Ext.Array.indexOf(c.expandedItemsState.cols,e.key)>=0){e.expanded=true;a=true}});if(a){d=b.getColumnHeaders();delete c.expandedItemsState}}else{c.doExpandCollapseTree(b.leftAxis.getTree(),!c.startRowGroupsCollapsed);c.doExpandCollapseTree(b.topAxis.getTree(),!c.startColGroupsCollapsed);d=b.getColumnHeaders()}c.pivotColumns=Ext.clone(d);d=Ext.clone(c.pivotColumns);c.preparePivotColumns(d);c.restorePivotColumnsState(d);d=c.prepareVisiblePivotColumns(d);c.setColumns(d);if(!Ext.isEmpty(c.sortedColumn)){b.leftAxis.sortTreeByField(c.sortedColumn.dataIndex,c.sortedColumn.direction)}c.getStore().fireEvent("pivotstoreremodel",c);if(!Ext.isEmpty(c.sortedColumn)){c.updateColumnSortState(c.sortedColumn.dataIndex,c.sortedColumn.direction)}c.lastColumnSorted=null},onMatrixGroupExpandCollapse:function(a,b,c){if(b=="col"){this.updateHeaderContainerColumns(c)}},getVisiblePivotColumns:function(d,f){var b=[],a=d.length,c,e;for(c=0;c<a;c++){e=d[c];if(e.group==f){b.push(e)}if(e.columns){b=Ext.Array.merge(b,this.getVisiblePivotColumns(e.columns,f))}}return b},prepareVisiblePivotColumns:function(d){var a=d.length,b=[],c,e,f;for(c=0;c<a;c++){e=d[c];if(!e.hidden){b.push(e)}if(e.columns){e.columns=this.prepareVisiblePivotColumns(e.columns)}}return b},preparePivotColumns:function(b){var f=this,e={menuDisabled:true,sortable:false,lockable:false},d=b.length,a,c;for(a=0;a<d;a++){c=b[a];c.cls=c.cls||"";Ext.apply(c,e);if(c.leftAxis){Ext.apply(c,{cell:Ext.clone(f.getLeftAxisCellConfig())})}else{if(c.topAxis){Ext.apply(c,{cell:Ext.clone(f.getTopAxisCellConfig())})}}if(c.subTotal){c.cls=c.userCls=f.clsGroupTotal}if(c.group&&c.xgrouped){if(c.group.expanded){if(!c.subTotal){c.cls+=(Ext.isEmpty(c.cls)?"":" ")+f.groupHeaderCollapsibleCls}}else{if(c.subTotal){c.cls+=(Ext.isEmpty(c.cls)?"":" ")+f.groupHeaderCollapsibleCls+" "+f.groupHeaderCollapsedCls}}if(c.subTotal){c.text=c.group.expanded?c.group.getTextTotal():Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',c.group.name)}else{if(c.group){c.text=Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',c.group.name)}}c.xexpandable=c.subTotal?!c.group.expanded:c.group.expanded;if((!c.group.expanded&&!c.subTotal)||(c.group.expanded&&c.subTotal&&this.getMatrix().colSubTotalsPosition=="none")){f.prepareHiddenColumns(c)}}if(c.grandTotal){c.cls=c.userCls=f.clsGrandTotal}if(Ext.isEmpty(c.columns)){if(c.dimension){Ext.apply(c,{renderer:c.dimension?c.dimension.getRenderer():false,formatter:c.dimension?c.dimension.getFormatter():false,scope:c.dimension?c.dimension.scope:null,align:c.dimension.align});if(c.dimension.flex>0){c.flex=c.flex||c.dimension.flex}else{c.width=c.width||c.dimension.width}c.cell=Ext.merge(c.cell,c.dimension.cellConfig)}if(c.cell&&c.cell.bind&&!c.cell.viewModel){c.cell.bind=f.processBindKey(c.cell.bind,c.dataIndex)}}else{c.xtype="gridheadergroup";f.preparePivotColumns(c.columns)}}},processBindKey:function(g,d){var f,c,e,b,a;if(Ext.isString(g)){a=g.replace("{column","{columns."+d);return a.replace("{value","{record."+d)}else{if(Ext.isObject(g)){f=Ext.Object.getAllKeys(g)}else{if(Ext.isArray(g)){f=g}}}if(f){e=f.length;for(b=0;b<e;b++){c=f[b];g[c]=this.processBindKey(g[c],d)}}return g},prepareHiddenColumns:function(c){var b,a;c.hidden=true;if(!c.columns){return}a=c.columns.length;for(b=0;b<a;b++){this.prepareHiddenColumns(c.columns[b])}},reconfigurePivot:function(a){var d=this,c=Ext.clone(d.getStateProperties()),b;c.push("startRowGroupsCollapsed","startColGroupsCollapsed","showZeroAsBlank");a=a||{};for(b=0;b<c.length;b++){if(!a.hasOwnProperty(c[b])){if(d[c[b]]){a[c[b]]=d[c[b]]}}else{d[c[b]]=a[c[b]]}}d.getMatrix().reconfigure(a)},doExpandCollapseTree:function(a,b){var c;for(c=0;c<a.length;c++){a[c].expanded=b;if(a[c].children){this.doExpandCollapseTree(a[c].children,b)}}},doExpandCollapse:function(d,c,f,a){var b=this.getMatrix(),e;if(!b){return}e=(d=="row"?b.leftAxis:b.topAxis)["findTreeElement"]("key",c);if(!e){return}e=e.node;f=Ext.isDefined(f)?f:!e.expanded;if(f){e.expand(a)}else{e.collapse(a)}},expandRow:function(b,a){this.doExpandCollapse("row",b,true,a)},collapseRow:function(b,a){this.doExpandCollapse("row",b,false,a)},expandCol:function(b,a){this.doExpandCollapse("col",b,true,a)},collapseCol:function(b,a){this.doExpandCollapse("col",b,false,a)},expandAll:function(){this.expandAllColumns();this.expandAllRows()},expandAllRows:function(){this.getMatrix().leftAxis.expandAll()},expandAllColumns:function(){this.getMatrix().topAxis.expandAll()},collapseAll:function(){this.collapseAllRows();this.collapseAllColumns()},collapseAllRows:function(){this.getMatrix().leftAxis.collapseAll()},collapseAllColumns:function(){this.getMatrix().topAxis.collapseAll()},getTopAxisKey:function(e){var f=this,a=f.getMatrix(),d=a.getColumns(),c=null,b;if(!e){return null}for(b=0;b<d.length;b++){if(d[b].name===e.getDataIndex()){c=d[b].col;break}}return c},getTopAxisItem:function(a){return this.getMatrix().topAxis.items.getByKey(this.getTopAxisKey(a))},getLeftAxisItem:function(a){var b;if(!a){return null}b=this.pivotDataSource.storeInfo[a.internalId];return b?this.getMatrix().leftAxis.items.getByKey(b.leftKey):null},getStateProperties:function(){return["viewLayoutType","rowSubTotalsPosition","rowGrandTotalsPosition","colSubTotalsPosition","colGrandTotalsPosition","aggregate","leftAxis","topAxis","enableColumnSort","sortedColumn"]},getPivotColumnsState:function(){var b=this,a,c;if(!b.lastColumnsState){c=b.getDataIndexColumns(b.getMatrix().getColumnHeaders());b.lastColumnsState={};for(a=0;a<c.length;a++){if(c[a].dataIndex){b.lastColumnsState[c[a].dataIndex]={width:c[a].width,flex:c[a].flex||0}}}}c=b.getColumns();for(a=0;a<c.length;a++){if(c[a].dataIndex){b.lastColumnsState[c[a].dataIndex]={width:c[a].rendered?c[a].getWidth():c[a].width,flex:c[a].flex||0}}}return b.lastColumnsState},getDataIndexColumns:function(b){var c=[],a;for(a=0;a<b.length;a++){if(b[a].dataIndex){c.push(b[a].dataIndex)}else{if(Ext.isArray(b[a].columns)){c=Ext.Array.merge(c,this.getDataIndexColumns(b[a].columns))}}}return c},restorePivotColumnsState:function(a){this.parsePivotColumnsState(this.getPivotColumnsState(),a)},parsePivotColumnsState:function(d,b){var c,a;if(!b){return}for(a=0;a<b.length;a++){c=d[b[a].dataIndex];if(c){if(c.flex){b[a].flex=c.flex}else{if(c.width){b[a].width=c.width}}}this.parsePivotColumnsState(d,b[a].columns)}},onItemTap:function(a){this.handleRowEvent("tap",a);this.callParent(arguments)},onItemTapHold:function(a){this.handleRowEvent("taphold",a);this.callParent(arguments)},onItemSingleTap:function(a){this.handleRowEvent("singletap",a);this.callParent(arguments)},onItemDoubleTap:function(a){this.handleRowEvent("doubletap",a);this.callParent(arguments)},handleRowEvent:function(b,c){var a=Ext.fly(c.getTarget(this.cellSelector));if(a){return a.component.handleEvent(b,c)}},handleColumnTap:function(e,b){var c=this,d,a;if(b.xexpandable){this.handleHeaderGroupTap(e,b);return}if(!c.enableColumnSort){return}d=b.getSortDirection()||"DESC";a=(d==="DESC")?"ASC":"DESC";if((b.leftAxis||b.topAxis)&&!Ext.isEmpty(b.getDataIndex())){if(c.getMatrix().leftAxis.sortTreeByField(b.getDataIndex(),a)){c.refreshView();c.updateSortIndicator(b,a)}}return false},updateSortIndicator:function(a,c){var b=this.lastColumnSorted;if(b){b.updateSortIndicator(null)}a.updateSortIndicator(c);this.lastColumnSorted=a},handleHeaderGroupTap:function(b,a){if(a.xexpandable){this.doExpandCollapse("col",a.key)}},isRTL:function(){if(Ext.isFunction(this.isLocalRtl)){return this.isLocalRtl()}return false},getRecordInfo:function(a){return a?this.pivotDataSource.storeInfo[a.internalId]:null}});Ext.define("Ext.pivot.plugin.configurator.Column",{extend:"Ext.dataview.component.ListItem",requires:["Ext.pivot.plugin.configurator.Field"],alias:"widget.pivotconfigfield",userCls:Ext.baseCSSPrefix+"pivot-grid-config-column",filteredCls:Ext.baseCSSPrefix+"pivot-grid-config-column-filter",ascSortIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-sort-asc",descSortIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-sort-desc",config:{deleteCmp:{xtype:"component",baseCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn",cls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-delete",docked:"right",hidden:true},moveCmp:{xtype:"component",baseCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn",cls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-move",docked:"left"},sortCmp:{xtype:"component",baseCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn",docked:"right",hidden:true}},applyDeleteCmp:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getDeleteCmp())}return a},updateDeleteCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},applyMoveCmp:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getMoveCmp())}return a},updateMoveCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},applySortCmp:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getSortCmp())}return a},updateSortCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},getField:function(){return this.getRecord().get("field")},updateRecord:function(c,b){var e=this,a=e.getBody(),d;this.callParent([c,b]);if(!c){return}if(b){d=b.get("field").getSettings();e.resetStyle(a,d.getStyle());e.removeCls(d.getCls())}d=c.get("field").getSettings();a.setStyle(d.getStyle());e.addCls(d.getCls());e.refreshData()},refreshData:function(){var d=this,h=d.getDeleteCmp(),b=d.getRecord(),f=b.get("field"),c=f.getSettings(),g=d.dataview||d.getDataview(),a=g.getFieldType(),e;if(a!=="all"){e=c.isFixed(g);h.setHidden(e)}b.set("text",f.getFieldText());d.updateSortCmpCls();d.updateFilterCls()},updateFilterCls:function(){var b=this,c=b.dataview||b.getDataview(),a=c.getFieldType();if(a!=="all"){if(b.getField().getFilter()){b.addCls(b.filteredCls)}else{b.removeCls(b.filteredCls)}}},updateSortCmpCls:function(){var b=this,e=b.dataview||b.getDataview(),a=e.getFieldType(),c=b.getField(),d=b.getSortCmp();if(a==="leftAxis"||a==="topAxis"){d.show();d.setUserCls("");if(c.getSortable()){if(c.getDirection()==="ASC"){d.setUserCls(b.ascSortIconCls)}else{d.setUserCls(b.descSortIconCls)}}}else{d.hide()}},resetStyle:function(f,b){var d={},e=Ext.Object.getAllKeys(b),a=e.length,c;for(c=0;c<a;c++){d[e[c]]=null}f.setStyle(d)},onApplyFilterSettings:function(b,a){this.getField().setFilter(a);this.updateFilterCls();this.applyChanges()},onRemoveFilter:function(){this.getField().setFilter(null);this.updateFilterCls();this.applyChanges()},applyChanges:function(){var a=this.dataview||this.getDataView();if(a){a.applyChanges()}}});Ext.define("Ext.pivot.plugin.configurator.DragZone",{extend:"Ext.drag.Source",requires:["Ext.drag.proxy.Placeholder"],groups:"pivotfields",proxy:{type:"placeholder",cursorOffset:[-20,30],placeholderCls:Ext.baseCSSPrefix+"pivot-drag-proxy-placeholder",validCls:Ext.baseCSSPrefix+"pivot-drag-proxy-placeholder-valid",invalidCls:Ext.baseCSSPrefix+"pivot-drag-proxy-placeholder-invalid"},handle:"."+Ext.baseCSSPrefix+"list-item",constructor:function(a){this.list=a;this.callParent([{element:a.getScrollable().getElement()}])},onDragStart:function(d){var c=Ext.fly(d.eventTarget).up(this.getHandle()),b='<span class="x-pivot-drag-placeholder-icon">&nbsp;</span><span>{0}</span>',a;if(!c||!c.component){return}a=c.component.getRecord();d.setData("record",a);d.setData("sourceList",this.list);this.getProxy().setHtml(Ext.String.format(b,a.get("text")))}});Ext.define("Ext.pivot.plugin.configurator.DropZone",{extend:"Ext.drag.Target",groups:"pivotfields",leftIndicatorCls:Ext.baseCSSPrefix+"pivot-grid-left-indicator",rightIndicatorCls:Ext.baseCSSPrefix+"pivot-grid-right-indicator",listItemSelector:"."+Ext.baseCSSPrefix+"list-item",listSelector:"."+Ext.baseCSSPrefix+"list",constructor:function(a){this.list=a;this.callParent([{element:a.getScrollable().getElement()}])},getLeftIndicator:function(){if(!this.leftIndicator){this.self.prototype.leftIndicator=Ext.getBody().createChild({cls:this.leftIndicatorCls,html:"&#160;"});this.self.prototype.indicatorWidth=this.leftIndicator.dom.offsetWidth;this.self.prototype.indicatorOffset=Math.round(this.indicatorWidth/2)}return this.leftIndicator},getRightIndicator:function(){if(!this.rightIndicator){this.self.prototype.rightIndicator=Ext.getBody().createChild({cls:this.rightIndicatorCls,html:"&#160;"})}return this.rightIndicator},accepts:function(b){var a=b.data.record;if(!a){return true}return a.get("field").getSettings().isAllowed(this.list)},onDragEnter:function(a){a.setData("targetList",this.list)},onDragMove:function(a){if(a.valid){this.positionIndicator(a)}else{this.hideIndicators()}},onDragLeave:function(a){a.setData("targetList",null);this.hideIndicators()},onDrop:function(c){var b=c.data,a=this.list.up("pivotconfigpanel");this.hideIndicators();if(!a){return}a.dragDropField(b.sourceList,b.targetList,b.record,b.position)},positionIndicator:function(f){var o=this,p=-1,c=o.getLeftIndicator(),g=o.getRightIndicator(),k=o.indicatorWidth,l=o.indicatorOffset,e,q,j,n,i,b,h,a,d,m;e=f.getCursorElement(o.listItemSelector);if(e){q=e.component;d="tl";m="tr";p=q.$dataIndex}else{d="bl";m="br";p=o.list.getViewItems().length;q=o.list.getItemAt(p-1);if(q){e=q.element}else{e=f.getCursorElement(o.listSelector)}}j=c.getAlignToXY(e,d);n=g.getAlignToXY(e,m);j[0]-=1;n[0]-=k;if(d==="tl"){j[1]-=k;n[1]-=k}i=h=-l;i+=e.getX();b=i+e.getWidth();h+=e.getY();a=h+e.getHeight();j[0]=Ext.Number.constrain(j[0],i,b);n[0]=Ext.Number.constrain(n[0],i,b);j[1]=Ext.Number.constrain(j[1],h,a);n[1]=Ext.Number.constrain(n[1],h,a);c.show();g.show();c.setXY(j);g.setXY(n);f.setData("position",p)},hideIndicators:function(){this.getLeftIndicator().hide();this.getRightIndicator().hide()}});Ext.define("Ext.pivot.plugin.configurator.Container",{extend:"Ext.dataview.List",alias:"widget.pivotconfigcontainer",requires:["Ext.pivot.plugin.configurator.Column","Ext.pivot.plugin.configurator.DragZone","Ext.pivot.plugin.configurator.DropZone"],handleSorting:false,handleFiltering:false,isConfiguratorContainer:true,useSimpleItems:false,disableSelection:true,defaultType:"pivotconfigfield",deferEmptyText:false,touchAction:{panX:false,pinchZoom:false,doubleTapZoom:false},store:{type:"array",fields:[{name:"text",type:"string"},{name:"field",type:"auto"}]},items:[{docked:"top",xtype:"titlebar",titleAlign:"left"}],config:{fieldType:"all",title:null},initialize:function(){var a=this;a.callParent();a.dragZone=new Ext.pivot.plugin.configurator.DragZone(a);a.dropZone=new Ext.pivot.plugin.configurator.DropZone(a);if(a.getFieldType()!=="all"){a.container.element.on({delegate:"."+Ext.baseCSSPrefix+"pivot-grid-config-column-btn",tap:"handleColumnBtnTap",scope:a});a.container.element.on({delegate:"."+Ext.baseCSSPrefix+"list-item-body",tap:"handleColumnTap",scope:a})}},destroy:function(){Ext.destroyMembers(this,"storeListeners","dragZone","dropZone");this.callParent()},updateTitle:function(b){var a=this.down("titlebar");if(a){a.setTitle(b)}},updateFieldType:function(a){if(a!=="all"){this.setUserCls(Ext.baseCSSPrefix+"pivot-grid-config-container")}},updateStore:function(a){var b=this;Ext.destroy(b.storeListeners);if(a){b.storeListeners=a.on({datachanged:b.applyChanges,scope:b})}},applyChanges:function(){if(this.getFieldType()!=="all"){this.fireEvent("configchange",this)}},addField:function(d,f){var e=this,c=e.getStore(),b=e.getFieldType(),a={};d.isAggregate=(b==="aggregate");Ext.apply(a,{field:d,text:d.getFieldText()});if(f>=0){c.insert(f,a)}else{c.add(a)}},removeField:function(a){this.getStore().remove(a);a.set("field",null)},moveField:function(a,d){var b=this.getStore(),c=b.indexOf(a);if(d===-1&&c===b.getCount()-1){return}b.remove(a);if(d>=0){b.insert(d,a)}else{b.add(a)}},handleColumnBtnTap:function(f){var c=this,d=Ext.fly(f.currentTarget),b=d.up("."+c.getBaseCls()+"-item").component,a=c.getStore().getAt(b.$dataIndex);if(!a){return}if(d.hasCls(Ext.baseCSSPrefix+"pivot-grid-config-column-btn-delete")){c.removeField(a);return}if(d.hasCls(Ext.baseCSSPrefix+"pivot-grid-config-column-btn-tools")){c.fireEvent("toolsbtnpressed",c,b);return}},handleColumnTap:function(f){var c=this,d=Ext.fly(f.currentTarget),b=d.up("."+c.getBaseCls()+"-item").component,a=c.getStore().getAt(b.$dataIndex);if(!a){return}c.fireEvent("toolsbtnpressed",c,b)}});Ext.define("Ext.pivot.plugin.configurator.PanelController",{extend:"Ext.app.ViewController",alias:"controller.pivotconfigpanel",destroy:function(){var a=this;a.pivotListeners=Ext.destroy(a.pivotListeners);a.callParent()},closeMe:function(){var a=this.getView();a.fireEvent("close",a)},cancelConfiguration:function(){this.refreshDimensions();this.closeMe()},applyConfiguration:function(){this.applyChanges().then(function(a){a.closeMe()})},backToMainView:function(){this.getView().setActiveItem("#main")},onPivotChanged:function(b,a){var c=this;Ext.destroy(c.pivotListeners);if(a){c.pivotListeners=a.on({pivotdone:c.onPivotDone,scope:c,destroyable:true})}},onFieldsChanged:function(b,a){if(!a){return}this.refreshDimensions()},onBeforeApplyConfigFieldSettings:function(c,b){var a=this.getView();return a.getPivot().fireEvent("beforeapplyconfigfieldsettings",a,{container:c,settings:b})},onApplyConfigFieldSettings:function(c,b){var a=this.getView();this.onConfigChanged();return a.getPivot().fireEvent("applyconfigfieldsettings",a,{container:c,settings:b})},onConfigChanged:function(){this.configurationChanged=true},showCard:function(c,g){var b=this.getView(),a=b.getPivot(),e=g.getField().getSettings(),f=b.down("#field"),d=[];if(a.fireEvent("beforeshowconfigfieldsettings",b,{container:f,settings:e})!==false){b.setActiveItem(f);f.setFieldItem(g);this.getAggregateContainer().getStore().each(function(h){var i=h.get("field");d.push([i.getHeader(),i.getId()])});f.getViewModel().getStore("sDimensions").loadData(d);a.fireEvent("showconfigfieldsettings",b,{container:f,settings:e})}},refreshDimensions:function(){var g=this,h=g.getView(),k=h.getPivot(),j=k?k.getMatrix():null,l,b,i,f,c,a,d,e;if(!j){return}g.internalReconfiguration=true;f=g.getAllFieldsContainer();l=g.getTopAxisContainer();b=g.getLeftAxisContainer();i=g.getAggregateContainer();f.getStore().removeAll();l.getStore().removeAll();b.getStore().removeAll();i.getStore().removeAll();e=h.getFields().clone();c=g.getConfigFields(j.topAxis.dimensions.getRange());a=g.getConfigFields(j.leftAxis.dimensions.getRange());d=g.getConfigFields(j.aggregate.getRange());g.addFieldsToConfigurator(e.getRange(),f);g.addFieldsToConfigurator(c,l);g.addFieldsToConfigurator(a,b);g.addFieldsToConfigurator(d,i);g.internalReconfiguration=false},onPivotDone:function(){if(this.internalReconfiguration){this.internalReconfiguration=false}else{this.refreshDimensions()}},reconfigurePivot:function(e,d){var c=this,b=c.getView(),a=b.getPivot(),f={topAxis:c.getFieldsFromContainer(c.getTopAxisContainer(),true),leftAxis:c.getFieldsFromContainer(c.getLeftAxisContainer(),true),aggregate:c.getFieldsFromContainer(c.getAggregateContainer(),true)};c.internalReconfiguration=true;if(a.fireEvent("beforeconfigchange",b,f)!==false){a.getMatrix().reconfigure(f);a.fireEvent("configchange",b,f)}e(c)},getAllFieldsContainer:function(){return this.lookupReference("fieldsCt")},getLeftAxisContainer:function(){return this.lookupReference("fieldsLeftCt")},getTopAxisContainer:function(){return this.lookupReference("fieldsTopCt")},getAggregateContainer:function(){return this.lookupReference("fieldsAggCt")},applyChanges:function(){var a=this;return new Ext.Promise(function(d,c){var b=a.getView();if(a.configurationChanged){a.configurationChanged=false;if(b.isHidden()||a.internalReconfiguration){c(a);return}Ext.asap(a.reconfigurePivot,a,[d,c])}else{d(a)}})},getFieldsFromContainer:function(f,d){var c=f.getStore(),b=c.getCount(),a=[],e,g;for(e=0;e<b;e++){g=c.getAt(e).get("field");a.push(d===true?g.serialize():g)}return a},addFieldsToConfigurator:function(b,d){var a=b.length,c;d.getStore().removeAll();for(c=0;c<a;c++){d.addField(b[c],-1)}d.refresh()},getConfigFields:function(c){var b=c.length,a=this.getView().getFields(),e=[],d,f;for(d=0;d<b;d++){f=a.byDataIndex.get(c[d].dataIndex);if(f){e.push(f)}}return e}});Ext.define("Ext.pivot.plugin.configurator.model.Select",{extend:"Ext.data.Model",fields:[{name:"text",type:"string"},{name:"value",type:"auto"},{name:"type",type:"integer"}]});Ext.define("Ext.pivot.plugin.configurator.store.Select",{extend:"Ext.data.ArrayStore",alias:"store.pivotselect",model:"Ext.pivot.plugin.configurator.model.Select"});Ext.define("Ext.pivot.plugin.configurator.FormController",{extend:"Ext.app.ViewController",alias:"controller.pivotconfigform",init:function(a){var b=this.getViewModel();b.getStore("sSorters").loadData([[a.sortClearText,"none"],[a.sortAscText,"ASC"],[a.sortDescText,"DESC"]]);b.getStore("sFilters").loadData([[a.clearFilterText,"none"],[a.labelFiltersText,"label"],[a.valueFiltersText,"value"],[a.top10FiltersText,"top10"]]);b.getStore("sTopOrder").loadData([[a.topOrderTopText,"top"],[a.topOrderBottomText,"bottom"]]);b.getStore("sTopType").loadData([[a.topTypeItemsText,"items"],[a.topTypePercentText,"percent"],[a.topTypeSumText,"sum"]]);b.getStore("sAlign").loadData([[a.alignLeftText,"left"],[a.alignCenterText,"center"],[a.alignRightText,"right"]])},applySettings:function(){var b=this.getViewModel(),e=this.getView(),g=e.getFieldItem(),f=g.getField(),d=Ext.clone(b.get("form")),i,h,c,a;if(d.align&&d.align.isModel){d.align=d.align.get("value")}if(f.isAggregate){if(d.formatter&&d.formatter.isModel){i=d.formatter}else{h=b.getStore("sFormatters");i=h.findRecord("value",d.formatter,0,false,true,true)}if(i){if(i.get("type")==1){d.formatter=i.get("value");d.renderer=null}else{d.renderer=i.get("value");d.formatter=null}}if(d.aggregator&&d.aggregator.isModel){d.aggregator=d.aggregator.get("value")}}else{c=d.direction;if(c&&c.isModel){c=c.get("value")}d.sortable=(c!=="none");d.direction=c||"ASC";a=d.filter;if(!a||!a.type||a.type.get("value")==="none"){a=null}else{a.type=a.type.get("value");if(a.operator&&a.operator.isModel){a.operator=a.operator.get("value")}if(a.dimensionId&&a.dimensionId.isModel){a.dimensionId=a.dimensionId.get("value")}if(a.topType&&a.topType.isModel){a.topType=a.topType.get("value")}if(a.topOrder&&a.topOrder.isModel){a.topOrder=a.topOrder.get("value")}if(a.type==="top10"){a.type="value";a.operator="top10"}if(a.operator==="between"||a.operator==="not between"){a.value=[a.from,a.to]}delete (a.from);delete (a.to);if(a.type==="label"){delete (a.dimensionId);delete (a.topSort);delete (a.topType);delete (a.topOrder)}}d.filter=a}if(e.fireEvent("beforeapplyconfigfieldsettings",e,d)!==false){f.setConfig(d);g.refreshData();e.fireEvent("applyconfigfieldsettings",e,d);this.cancelSettings()}},cancelSettings:function(){var a=this.getView();a.setFieldItem(null);a.fireEvent("close",a)},onFieldItemChanged:function(m,o){var p=this.getViewModel(),b={},l=[],j=[],n,e,f,d,q,c,h,k,g,a;if(!o){p.set("form",b);return}n=o.getField();g=n.getConfig();Ext.apply(b,{dataIndex:g.dataIndex,header:g.header});if(n.isAggregate){e=n.getSettings();f=e.getFormatters();d=e.getRenderers();q=e.getAggregators();c=q.length;for(h=0;h<c;h++){j.push([n.getAggText(q[h]),q[h]])}k=Ext.Object.getAllKeys(f||{});c=k.length;for(h=0;h<c;h++){l.push([k[h],f[k[h]],1])}k=Ext.Object.getAllKeys(d||{});c=k.length;for(h=0;h<c;h++){l.push([k[h],d[k[h]],2])}p.getStore("sFormatters").loadData(l);p.getStore("sAggregators").loadData(j);Ext.apply(b,{formatter:g.formatter||g.renderer,aggregator:g.aggregator,align:g.align})}else{a=g.filter;Ext.apply(b,{direction:(g.sortable?g.direction:"none"),filter:{type:(a?(a.type==="value"&&a.operator==="top10"?"top10":a.type):"none"),operator:(a?(a.type==="value"&&a.operator==="top10"?"top10":a.operator):null),value:(a?a.value:null),from:(a?(Ext.isArray(a.value)?a.value[0]:null):null),to:(a?(Ext.isArray(a.value)?a.value[1]:null):null),caseSensitive:(a?a.caseSensitive:false),topSort:(a?a.topSort:false),topOrder:(a?a.topOrder:false),topType:(a?a.topType:false),dimensionId:(a?a.dimensionId:null)}})}p.set("form",b)},prepareOperators:function(b){var c=this.getView(),a=this.getViewModel(),d;d=[[c.equalsLText,"="],[c.doesNotEqualLText,"!="],[c.greaterThanLText,">"],[c.greaterThanOrEqualToLText,">="],[c.lessThanLText,"<"],[c.lessThanOrEqualToLText,"<="],[c.betweenLText,"between"],[c.notBetweenLText,"not between"]];if(b==="label"){Ext.Array.insert(d,3,[[c.beginsWithLText,"begins"],[c.doesNotBeginWithLText,"not begins"],[c.endsWithLText,"ends"],[c.doesNotEndWithLText,"not ends"],[c.containsLText,"contains"],[c.doesNotContainLText,"not contains"]])}a.getStore("sOperators").loadData(d)},onChangeFilterType:function(f,b){var e=this,a=e.getView(),d=a.down("#commonFilters"),c=b&&b.isModel?b.get("value"):b;d.setHidden(c==="none"||c==="top10");d.setTitle(c==="label"?a.labelFilterText:a.valueFilterText);a.down("#top10Filters").setHidden(c!=="top10");a.down("[role=dimensions]").setHidden((c!=="value"));if(c==="label"||c==="value"){e.prepareOperators(c)}},onChangeFilterOperator:function(d,b){var e=b&&b.isModel?b.get("value"):b,a=this.getView(),c=(e==="between"||e==="not between");a.down("[role=operator]").setHidden(c);Ext.Array.each(a.query("[role=between]"),function(f){f.setHidden(!c)})}});Ext.define("Ext.pivot.plugin.configurator.Form",{extend:"Ext.form.Panel",requires:["Ext.pivot.plugin.configurator.store.Select","Ext.pivot.plugin.configurator.FormController","Ext.form.FieldSet","Ext.field.Toggle","Ext.field.Select","Ext.field.Radio","Ext.field.Text","Ext.field.Hidden","Ext.layout.VBox","Ext.layout.HBox","Ext.TitleBar"],xtype:"pivotconfigform",controller:"pivotconfigform",viewModel:{stores:{sFormatters:{type:"pivotselect"},sAggregators:{type:"pivotselect"},sSorters:{type:"pivotselect"},sFilters:{type:"pivotselect"},sOperators:{type:"pivotselect"},sTopOrder:{type:"pivotselect"},sTopType:{type:"pivotselect"},sDimensions:{type:"pivotselect"},sAlign:{type:"pivotselect"}}},eventedConfig:{fieldItem:null,title:null},listeners:{fielditemchange:"onFieldItemChanged"},defaults:{labelAlign:"top"},showAnimation:{type:"slideIn",duration:250,easing:"ease-out",direction:"left"},hideAnimation:{type:"slideOut",duration:250,easing:"ease-in",direction:"right"},okText:"Ok",cancelText:"Cancel",formatText:"Format as",summarizeByText:"Summarize by",customNameText:"Custom name",sourceNameText:'The source name for this field is "{form.dataIndex}"',sortText:"Sort",filterText:"Filter",sortResultsText:"Sort results",alignText:"Align",alignLeftText:"Left",alignCenterText:"Center",alignRightText:"Right",caseSensitiveText:"Case sensitive",valueText:"Value",fromText:"From",toText:"To",labelFilterText:"Show items for which the label",valueFilterText:"Show items for which",top10FilterText:"Show",sortAscText:"Sort A to Z",sortDescText:"Sort Z to A",sortClearText:"Disable sorting",clearFilterText:"Disable filtering",labelFiltersText:"Label filters",valueFiltersText:"Value filters",top10FiltersText:"Top 10 filters",equalsLText:"equals",doesNotEqualLText:"does not equal",beginsWithLText:"begins with",doesNotBeginWithLText:"does not begin with",endsWithLText:"ends with",doesNotEndWithLText:"does not end with",containsLText:"contains",doesNotContainLText:"does not contain",greaterThanLText:"is greater than",greaterThanOrEqualToLText:"is greater than or equal to",lessThanLText:"is less than",lessThanOrEqualToLText:"is less than or equal to",betweenLText:"is between",notBetweenLText:"is not between",topOrderTopText:"Top",topOrderBottomText:"Bottom",topTypeItemsText:"Items",topTypePercentText:"Percent",topTypeSumText:"Sum",updateFieldItem:function(c){var b=this,a,d;b.removeAll(true,true);if(!c){return}d=c.getField();a=[{xtype:"titlebar",docked:"top",bind:{title:"{form.header}"},items:[{text:b.cancelText,align:"left",ui:"back",handler:"cancelSettings"},{text:b.okText,align:"right",ui:"action",handler:"applySettings"}]},{xtype:"fieldset",margin:0,bind:{instructions:b.sourceNameText},items:[{label:b.customNameText,labelAlign:"top",xtype:"textfield",bind:"{form.header}"}]}];if(d.isAggregate){a.push({label:b.alignText,xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sAlign}",value:"{form.align}"}},{label:b.formatText,xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sFormatters}",value:"{form.formatter}"}},{label:b.summarizeByText,xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sAggregators}",value:"{form.aggregator}"}})}else{a.push({label:b.sortText,labelAlign:"top",xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sSorters}",value:"{form.direction}"}},{label:b.filterText,labelAlign:"top",xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sFilters}",value:"{form.filter.type}"},listeners:{change:"onChangeFilterType"}},{itemId:"commonFilters",xtype:"fieldset",margin:0,hidden:true,title:b.labelFilterText,defaults:{labelAlign:"top"},items:[{role:"dimensions",xtype:"selectfield",autoSelect:false,bind:{store:"{sDimensions}",value:"{form.filter.dimensionId}"}},{xtype:"selectfield",autoSelect:false,bind:{store:"{sOperators}",value:"{form.filter.operator}"},listeners:{change:"onChangeFilterOperator"}},{role:"operator",xtype:"textfield",placeHolder:b.valueText,bind:"{form.filter.value}"},{role:"between",xtype:"textfield",placeHolder:b.fromText,hidden:true,bind:"{form.filter.from}"},{role:"between",xtype:"textfield",placeHolder:b.toText,hidden:true,bind:"{form.filter.to}"},{xtype:"togglefield",label:b.caseSensitiveText,name:"fCaseSensitive",bind:"{form.filter.caseSensitive}"}]},{itemId:"top10Filters",xtype:"fieldset",margin:0,hidden:true,title:b.top10FilterText,defaults:{labelAlign:"top"},items:[{xtype:"selectfield",autoSelect:false,bind:{store:"{sTopOrder}",value:"{form.filter.topOrder}"}},{xtype:"textfield",placeHolder:b.valueText,bind:"{form.filter.value}"},{xtype:"selectfield",autoSelect:false,bind:{store:"{sTopType}",value:"{form.filter.topType}"}},{xtype:"selectfield",autoSelect:false,bind:{store:"{sDimensions}",value:"{form.filter.dimensionId}"}},{xtype:"togglefield",label:b.sortResultsText,bind:"{form.filter.topSort}"}]})}b.add(a)}});Ext.define("Ext.pivot.plugin.configurator.Panel",{extend:"Ext.Container",requires:["Ext.pivot.plugin.configurator.Container","Ext.pivot.plugin.configurator.DragZone","Ext.pivot.plugin.configurator.DropZone","Ext.pivot.plugin.configurator.PanelController","Ext.pivot.plugin.configurator.Form","Ext.layout.HBox","Ext.layout.VBox","Ext.layout.Card","Ext.TitleBar","Ext.Promise"],alias:"widget.pivotconfigpanel",controller:"pivotconfigpanel",cls:Ext.baseCSSPrefix+"pivot-grid-config-panel",translatable:{translationMethod:"csstransform"},panelTitle:"Configuration",panelAllFieldsText:"Drop Unused Fields Here",panelAllFieldsTitle:"All fields",panelTopFieldsText:"Drop Column Fields Here",panelTopFieldsTitle:"Column labels",panelLeftFieldsText:"Drop Row Fields Here",panelLeftFieldsTitle:"Row labels",panelAggFieldsText:"Drop Agg Fields Here",panelAggFieldsTitle:"Values",cancelText:"Cancel",okText:"Done",eventedConfig:{pivot:null,fields:null},listeners:{pivotchange:"onPivotChanged",fieldschange:"onFieldsChanged"},layout:"card",initialize:function(){this.setup();return this.callParent()},dragDropField:function(a,f,e,i){var h=this,k=h.getPivot(),j=e.get("field"),d=a.getFieldType(),m=f.getFieldType(),c=h.getController(),g=c.getTopAxisContainer(),b=c.getLeftAxisContainer(),l;if(k.fireEvent("beforemoveconfigfield",this,{fromContainer:a,toContainer:f,field:j})!==false){if(a!=f){if(d==="all"&&(m==="leftAxis"||m==="topAxis")){l=h.findFieldInContainer(j,f);if(l){return}if(m=="leftAxis"){l=h.findFieldInContainer(j,g);if(l){g.removeField(l);f.addField(j,i);return}}else{l=h.findFieldInContainer(j,b);if(l){b.removeField(l);f.addField(j,i);return}}f.addField(j.clone(),i,true)}else{if(d=="all"&&m=="aggregate"){f.addField(j.clone(),i,true)}else{if(d!="all"&&m!="all"){a.removeField(e);f.addField(j,i)}else{a.removeField(e)}}}}else{f.moveField(e,i)}}},findFieldInContainer:function(f,a){var b=a.getStore(),e=b.getCount(),c,d;for(c=0;c<e;c++){d=b.getAt(c);if(d.get("field").getDataIndex()==f.getDataIndex()){return d}}},setup:function(){var b=this,a={configchange:"onConfigChanged",toolsbtnpressed:"showCard"};b.add([{itemId:"main",xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{flex:1},items:[{xtype:"titlebar",docked:"top",title:b.panelTitle,items:[{text:b.cancelText,align:"left",ui:"back",handler:"cancelConfiguration"},{text:b.okText,align:"right",ui:"action",handler:"applyConfiguration"}]},{reference:"fieldsCt",xtype:"pivotconfigcontainer",title:b.panelAllFieldsTitle,emptyText:b.panelAllFieldsText,fieldType:"all",listeners:a},{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{xtype:"pivotconfigcontainer",flex:1},items:[{reference:"fieldsAggCt",title:b.panelAggFieldsTitle,emptyText:b.panelAggFieldsText,fieldType:"aggregate",listeners:a},{reference:"fieldsLeftCt",title:b.panelLeftFieldsTitle,emptyText:b.panelLeftFieldsText,fieldType:"leftAxis",listeners:a},{reference:"fieldsTopCt",title:b.panelTopFieldsTitle,emptyText:b.panelTopFieldsText,fieldType:"topAxis",listeners:a}]}]},{itemId:"field",xtype:"pivotconfigform",listeners:{close:"backToMainView",beforeapplyconfigfieldsettings:"onBeforeApplyConfigFieldSettings",applyconfigfieldsettings:"onApplyConfigFieldSettings"}}])}});Ext.define("Ext.pivot.plugin.Configurator",{extend:"Ext.AbstractPlugin",requires:["Ext.util.Collection","Ext.pivot.plugin.configurator.Panel"],alias:"plugin.pivotconfigurator",config:{fields:[],width:400,panel:{xtype:"pivotconfigpanel",docked:"right"},panelWrapper:{xtype:"sheet",right:0,stretchY:true,layout:"fit",hideOnMaskTap:true,enter:"right",exit:"right",style:{padding:0}},panelWrap:true,grid:null,view:null},platformConfig:{desktop:{panelWrap:false}},init:function(a){this.setGrid(a)},destroy:function(){this.setConfig({grid:null,view:null,panel:null});this.callParent()},enable:function(){this.disabled=false;this.showConfigurator()},disable:function(){this.disabled=true;this.hideConfigurator()},updateView:function(b,c){var d=this,a;Ext.destroy(c,d.panelListeners);if(b){a=b.isXType("pivotconfigpanel")?b:b.down("pivotconfigpanel");if(a){d.panelListeners=a.on({close:"hideConfigurator",scope:d});a.setConfig({pivot:d.getGrid(),fields:d.getFields()})}}},updateGrid:function(a,c){var b=this;Ext.destroy(b.gridListeners);if(c){c.showConfigurator=c.hideConfigurator=null}if(a){a.showConfigurator=Ext.bind(b.showConfigurator,b);a.hideConfigurator=Ext.bind(b.hideConfigurator,b);if(a.initialized){b.onGridInitialized()}else{a.on({initialize:"onGridInitialized",single:true,scope:b})}}},getWidth:function(){var b=this.getGrid(),a=Ext.Viewport,c=100;if(b&&b.element){c=b.element.getWidth()}if(a){c=Math.min(c,a.element.getHeight(),a.element.getWidth())}return Ext.Number.constrain(this._width,100,c)},onGridInitialized:function(){var h=this,a=h.getGrid(),f=h.getFields(),k=a.getMatrix(),l,g,j,b,c,d,e;g=Ext.Array.merge(k.leftAxis.dimensions.getRange(),k.topAxis.dimensions.getRange(),k.aggregate.getRange());c=g.length;for(d=0;d<c;d++){e=g[d].getInitialConfig();delete (e.matrix);j=f.byDataIndex.get(e.dataIndex);if(!j){f.add(e)}else{j.setConfig(e)}}if(f.length===0){l=h.getCmp().getStore();g=l?l.model.getFields():[];c=g.length;for(d=0;d<c;d++){b=g[d].getName();if(!f.byDataIndex.get(b)){f.add({header:Ext.String.capitalize(b),dataIndex:b})}}}h.isReady=true;h.doneSetup=false;h.gridListeners=a.getHeaderContainer().renderElement.on({longpress:"showConfigurator",scope:this})},hideConfigurator:function(){var b=this.getGrid(),a;this.setup();a=this.getView();a.translate(this.getWidth(),0,{duration:100});a.getTranslatable().on("animationend",function(){a.hide(null);b.fireEvent("hideconfigpanel",a)},this,{single:true})},showConfigurator:function(){var b=this,a;b.setup();a=b.getView();a.setWidth(b.getWidth());a.show();a.translate(0,0,{duration:100});this.getGrid().fireEvent("showconfigpanel",a)},getFields:function(){var a=this._fields;if(!a){a=new Ext.util.Collection({extraKeys:{byDataIndex:"dataIndex"},decoder:function(b){return(b&&b.isField)?b:new Ext.pivot.plugin.configurator.Field(b||{})}});this.setFields(a)}return a},applyFields:function(a,b){if(a==null||(a&&a.isCollection)){return a}if(a){if(!b){b=this.getFields()}b.splice(0,b.length,a)}return b},privates:{setup:function(){var c=this,b,a;if(c.doneSetup||!c.isReady){return}c.doneSetup=true;if(c.getPanelWrap()){b=c.getPanelWrapper();if(!b.items){a=c.getPanel();a.docked=null;b.items=[a]}}else{b=c.getPanel()}c.setView(c.getGrid().add(b))}}});Ext.define("Ext.pivot.plugin.DrillDown",{alias:["plugin.pivotdrilldown"],extend:"Ext.AbstractPlugin",requires:["Ext.pivot.Grid","Ext.Sheet","Ext.TitleBar","Ext.Button","Ext.data.proxy.Memory","Ext.data.Store","Ext.grid.plugin.PagingToolbar"],config:{columns:null,width:500,remoteStore:null,grid:null,view:null},titleText:"Drill down",doneText:"Done",init:function(a){this.setGrid(a);return this.callParent([a])},destroy:function(){this.setConfig({grid:null,view:null});this.callParent()},updateGrid:function(a,c){var b=this;Ext.destroy(b.gridListeners);if(a){b.gridListeners=a.on({pivotitemcelldoubletap:"showPanel",pivotgroupcelldoubletap:"showPanel",pivottotalcelldoubletap:"showPanel",scope:b,destroyable:true});b.doneSetup=false}},updateView:function(a,b){Ext.destroy(b)},getWidth:function(){var b=this.getGrid(),a=Ext.Viewport,c=100;if(b&&b.element){c=b.element.getWidth()}if(a){c=Math.min(c,a.element.getHeight(),a.element.getWidth())}return Ext.Number.constrain(this._width,100,c)},showPanel:function(d,g,h){var i=this,a=i.getGrid(),k=a.getMatrix(),c=Ext.Array.from(i.getColumns()||[]),m,f,l,b,j;if(i.disabled){return}m=k.results.get(d.leftKey,d.topKey);if(!m){return}switch(k.type){case"local":f=k.store.model.getFields();l=Ext.create("Ext.data.Store",{fields:Ext.clone(f),proxy:{type:"memory",reader:{type:"array"}}});if(c.length===0){Ext.Array.each(f,function(o,e,n){c.push({text:Ext.String.capitalize(o.name),dataIndex:o.name,xtype:"column"})})}l.loadData(m.records);break;case"remote":l=Ext.getStore(i.remoteStore);if(l){l.setRemoteFilter(true)}b=Ext.Array.merge(i.getFiltersFromParams(m.getLeftAxisItem()?m.getLeftAxisItem().data:{}),i.getFiltersFromParams(m.getTopAxisItem()?m.getTopAxisItem().data:{}));l.clearFilter(b.length>0);l.addFilter(b);break;default:return}j=a.add(Ext.create("Ext.Sheet",{width:i.getWidth(),hideOnMaskTap:false,enter:"right",exit:"right",modal:true,right:0,layout:"fit",stretchY:true,items:[{docked:"top",xtype:"titlebar",title:i.titleText,items:{xtype:"button",text:i.doneText,ui:"action",align:"right",listeners:{tap:"onDoneButton",scope:i}}},{xtype:"grid",store:l,columns:c,plugins:[{type:"gridpagingtoolbar"}]}]}));j.show();i.setView(j)},onDoneButton:function(){this.setView(null)},getFiltersFromParams:function(e){var d=[],b,a,c;if(Ext.isObject(e)){c=Ext.Object.getKeys(e);a=c.length;for(b=0;b<a;b++){d.push({property:c[b],exactMatch:true,value:e[c[b]]})}}return d}});Ext.define("Ext.pivot.plugin.rangeeditor.PanelController",{extend:"Ext.app.ViewController",alias:"controller.pivotrangeeditor",applySettings:function(){var b=this.getViewModel().get("form"),a=Ext.bind(this.cancelSettings,this),c;if(b&&b.type&&b.type.isModel){b.type=b.type.get("value")}c=Ext.Factory.pivotupdate(b);c.update().then(a,a)},cancelSettings:function(){var a=this.getView();a.fireEvent("close",a)}});Ext.define("Ext.pivot.plugin.rangeeditor.Panel",{extend:"Ext.form.Panel",requires:["Ext.pivot.plugin.rangeeditor.PanelController","Ext.form.FieldSet","Ext.field.Select","Ext.field.Number","Ext.layout.VBox","Ext.TitleBar","Ext.Button"],xtype:"pivotrangeeditor",controller:"pivotrangeeditor",viewModel:{stores:{sTypes:{type:"array",fields:["value","text"],autoDestroy:true}}},showAnimation:{type:"slideIn",duration:250,easing:"ease-out",direction:"left"},hideAnimation:{type:"slideOut",duration:250,easing:"ease-in",direction:"right"},titleText:"Range editor",valueText:"Value",fieldText:'Source field is "{form.dataIndex}"',typeText:"Type",okText:"Ok",cancelText:"Cancel",initialize:function(){var a=this;a.add([{xtype:"titlebar",docked:"top",title:a.titleText,items:[{text:a.cancelText,align:"left",ui:"back",handler:"cancelSettings"},{text:a.okText,align:"right",ui:"action",handler:"applySettings"}]},{xtype:"fieldset",margin:0,bind:{instructions:a.fieldText},defaults:{labelAlign:"top"},items:[{label:a.typeText,xtype:"selectfield",autoSelect:false,useClearIcon:true,bind:{store:"{sTypes}",value:"{form.type}"}},{label:a.valueText,xtype:"numberfield",bind:"{form.value}"}]}]);return a.callParent()}});Ext.define("Ext.pivot.plugin.RangeEditor",{alias:["plugin.pivotrangeeditor"],extend:"Ext.AbstractPlugin",requires:["Ext.pivot.plugin.rangeeditor.Panel","Ext.Sheet","Ext.layout.Fit","Ext.pivot.update.Increment","Ext.pivot.update.Overwrite","Ext.pivot.update.Percentage","Ext.pivot.update.Uniform"],config:{updaters:[["percentage","Percentage"],["increment","Increment"],["overwrite","Overwrite"],["uniform","Uniform"]],defaultUpdater:"uniform",width:400,panel:{xtype:"pivotrangeeditor"},panelWrapper:{xtype:"sheet",right:0,stretchY:true,layout:"fit",hideOnMaskTap:true,enter:"right",exit:"right",style:{padding:0}},panelWrap:true,grid:null,view:null},init:function(a){this.setGrid(a);return this.callParent([a])},destroy:function(){this.setConfig({grid:null,view:null,panel:null});this.callParent()},updateGrid:function(a,c){var b=this;Ext.destroy(b.gridListeners);if(a){b.gridListeners=a.on({pivotitemcelldoubletap:"showPanel",pivotgroupcelldoubletap:"showPanel",pivottotalcelldoubletap:"showPanel",scope:b,destroyable:true});b.doneSetup=false}},updateView:function(b,c){var d=this,a;Ext.destroy(c,d.viewListeners);if(b){a=b.isXType("pivotrangeeditor")?b:b.down("pivotrangeeditor");if(a){a.getViewModel().getStore("sTypes").loadData(this.getUpdaters());d.getGrid().relayEvents(a,["beforeupdate","update"],"pivot");d.viewListeners=a.on({close:"hidePanel",scope:d,destroyable:true})}}},getWidth:function(){var b=this.getGrid(),a=Ext.Viewport,c=100;if(b&&b.element){c=b.element.getWidth()}if(a){c=Math.min(c,a.element.getHeight(),a.element.getWidth())}return Ext.Number.constrain(this._width,100,c)},showPanel:function(d,f,g){var h=this,k=h.getGrid().getMatrix(),i,a,c,l,b,j;if(h.disabled){return}if(d.topKey){l=k.results.get(d.leftKey,d.topKey);h.setup();i=h.getView();i.setWidth(h.getWidth());a=i.down("pivotrangeeditor");if(a&&l){c=a.getViewModel();b=d.column;j=b.dimension.getDataIndex();c.set("form",{leftKey:d.leftKey,topKey:d.topKey,dataIndex:j,value:l.getValue(b.dimension.getId()),type:h.getDefaultUpdater(),matrix:k});i.show()}else{i.hide()}}},hidePanel:function(){this.getView().hide()},setup:function(){var b=this,a;if(b.doneSetup){return}if(b.getPanelWrap()){a=b.getPanelWrapper();if(!a.items){a.items=[b.getPanel()]}}else{a=b.getPanel()}b.setView(b.getGrid().add(a));b.doneSetup=true}});