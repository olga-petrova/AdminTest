Ext.define("Ext.pivot.Aggregators",{alternateClassName:["Mz.aggregate.Aggregators"],singleton:true,customText:"Custom",sumText:"Sum",avgText:"Avg",minText:"Min",maxText:"Max",countText:"Count",groupSumPercentageText:"Group sum percentage",groupCountPercentageText:"Group count percentage",varianceText:"Var",variancePText:"Varp",stdDevText:"StdDev",stdDevPText:"StdDevp",sum:function(b,d,a,g,h){var f=b.length,e=0,c;for(c=0;c<f;c++){e+=Ext.Number.from(b[c].get(d),0)}return e},avg:function(b,d,a,g,h){var f=b.length,e=0,c;for(c=0;c<f;c++){e+=Ext.Number.from(b[c].get(d),0)}return f>0?(e/f):0},min:function(d,a,g,j,b){var e=[],c=d.length,f,h;for(f=0;f<c;f++){e.push(d[f].get(a))}h=Ext.Array.min(e);return h},max:function(b,d,a,f,h){var g=[],e=b.length,c;for(c=0;c<e;c++){g.push(b[c].get(d))}v=Ext.Array.max(g);return v},count:function(b,c,a,d,e){return b.length},groupSumPercentage:function(e,b,g,i,c){var a=Ext.pivot.Aggregators.sum,d=e.length,l,k,f=0,h=0,j=i.split(g.keysSeparator);if(d==0){return 0}j.pop();j=j.join(g.keysSeparator);if(Ext.isEmpty(j)){j=g.grandTotalKey}l=g.results.get(i,c);if(l){f=l.getValue("groupSum");if(!Ext.isDefined(f)){f=l.calculateByFn("groupSum",b,a)}}k=g.results.get(j,c);if(k){h=k.getValue("groupSum");if(!Ext.isDefined(h)){h=k.calculateByFn("groupSum",b,a)}}return(h>0&&f>0)?f/h*100:0},groupCountPercentage:function(d,a,f,h,b){var k=Ext.pivot.Aggregators.count,c=d.length,l,j,e=0,g=0,i=h.split(f.keysSeparator);if(c==0){return 0}i.pop();i=i.join(f.keysSeparator);if(Ext.isEmpty(i)){i=f.grandTotalKey}l=f.results.get(h,b);if(l){e=l.getValue("groupCount");if(!Ext.isDefined(e)){e=l.calculateByFn("groupCount",a,k)}}j=f.results.get(i,b);if(j){g=j.getValue("groupCount");if(!Ext.isDefined(g)){g=j.calculateByFn("groupCount",a,k)}}return(g>0&&e>0)?e/g*100:0},variance:function(d,a,j,k,b){var g=Ext.pivot.Aggregators,c=d.length,f=g.avg.apply(g,arguments),h=0,e;if(f>0){for(e=0;e<c;e++){h+=Math.pow(Ext.Number.from(d[e].get(a),0)-f,2)}}return(h>0&&c>1)?(h/(c-1)):0},varianceP:function(d,a,j,k,b){var g=Ext.pivot.Aggregators,c=d.length,f=g.avg.apply(g,arguments),h=0,e;if(f>0){for(e=0;e<c;e++){h+=Math.pow(Ext.Number.from(d[e].get(a),0)-f,2)}}return(h>0&&c>0)?(h/c):0},stdDev:function(c,d,b,f,g){var e=Ext.pivot.Aggregators,a=e.variance.apply(e,arguments);return a>0?Math.sqrt(a):0},stdDevP:function(c,d,b,f,g){var e=Ext.pivot.Aggregators,a=e.varianceP.apply(e,arguments);return a>0?Math.sqrt(a):0}});Ext.define("Ext.pivot.MixedCollection",{extend:"Ext.util.MixedCollection",alternateClassName:["Mz.aggregate.MixedCollection"],removeAt:function(a){Ext.destroy(this.callParent(arguments))},clear:function(){Ext.destroy(this.items);this.callParent(arguments)},removeAll:function(){Ext.destroy(this.items);this.callParent(arguments)},destroy:function(){this.clear()}});Ext.define("Ext.pivot.filter.Base",{alternateClassName:["Mz.aggregate.filter.Abstract"],alias:"pivotfilter.base",mixins:["Ext.mixin.Factoryable"],operator:null,value:null,caseSensitive:true,parent:null,isFilter:true,constructor:function(b){var c=this,a=Ext.util.Format;c.thousandRe=new RegExp("["+a.thousandSeparator+"]","g");c.decimalRe=new RegExp("["+a.decimalSeparator+"]");Ext.apply(this,b);return this.callParent([b])},destroy:function(){var a=this;a.parent=a.thousandRe=a.decimalRe=null;a.callParent()},serialize:function(){var a=this;return Ext.apply({type:a.type,operator:a.operator,value:a.value,caseSensitive:a.caseSensitive},a.getSerialArgs()||{})},getSerialArgs:Ext.emptyFn,isMatch:function(f){var e=this,b=e.value,c,a,d,h,g;b=(Ext.isArray(b)?b[0]:b)||"";c=e.compare(f,b);if(e.operator=="="){return(c===0)}if(e.operator=="!="){return(c!==0)}if(e.operator==">"){return(c>0)}if(e.operator==">="){return(c>=0)}if(e.operator=="<"){return(c<0)}if(e.operator=="<="){return(c<=0)}b=e.value;h=(Ext.isArray(b)?b[0]:b)||"";g=(Ext.isArray(b)?b[1]:b)||"";a=e.compare(f,h);d=e.compare(f,g);if(e.operator=="between"){return(a>=0&&d<=0)}if(e.operator=="not between"){return !(a>=0&&d<=0)}return true},parseNumber:function(b){var a;if(typeof b==="number"){return b}if(Ext.isEmpty(b)){b=""}a=String(b).replace(this.thousandRe,"");a=a.replace(this.decimalRe,".");if(Ext.isNumeric(a)){return parseFloat(a)}return null},compare:function(d,c){var g=Ext.pivot.matrix.Base.prototype.naturalSort,f=this.parseNumber(d),e=this.parseNumber(c);if(Ext.isNumber(f)&&Ext.isNumber(e)){return g(f,e)}if(Ext.isDate(d)){if(Ext.isDate(c)){return g(d,c)}else{return g(d,Ext.Date.parse(c,Ext.Date.defaultFormat))}}return(this.caseSensitive?g(d||"",c||""):g(String(d||"").toLowerCase(),String(c||"").toLowerCase()))}});Ext.define("Ext.pivot.filter.Label",{alternateClassName:["Mz.aggregate.filter.Label"],extend:"Ext.pivot.filter.Base",alias:"pivotfilter.label",isMatch:function(c){var b=this,a;if(b.operator=="begins"){return Ext.String.startsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not begins"){return !Ext.String.startsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="ends"){return Ext.String.endsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not ends"){return !Ext.String.endsWith(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="contains"){return b.stringContains(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="not contains"){return !b.stringContains(String(c||""),String(b.value||""),!b.caseSensitive)}if(b.operator=="in"){return b.foundInArray(b.value)}if(b.operator=="not in"){return !b.foundInArray(b.value)}return b.callParent(arguments)},foundInArray:function(d){var b=Ext.Array.from(this.value),a=b.length,e=false,c;if(this.caseSensitive){return Ext.Array.indexOf(b,d)>=0}else{for(c=0;c<a;c++){e=e||(String(d).toLowerCase()==String(b[c]).toLowerCase());if(e){break}}return e}},stringContains:function(c,d,b){var a=(d.length<=c.length);if(a){if(b){c=c.toLowerCase();d=d.toLowerCase()}a=(c.lastIndexOf(d)>=0)}return a}});Ext.define("Ext.pivot.filter.Value",{alternateClassName:["Mz.aggregate.filter.Value"],extend:"Ext.pivot.filter.Base",alias:"pivotfilter.value",dimensionId:"",topType:"items",topOrder:"top",topSort:true,isTopFilter:false,constructor:function(b){var a=this.callParent([b]);this.isTopFilter=(this.operator==="top10");return a},destroy:function(){this.dimension=null;this.callParent()},getDimension:function(){return this.parent.matrix.aggregate.getByKey(this.dimensionId)},getSerialArgs:function(){return{dimensionId:this.dimensionId,topType:this.topType,topOrder:this.topOrder}},applyFilter:function(c,e){var d=this,a=d.topSort?e:Ext.Array.clone(e),b=[];if(e.length==0){return b}d.sortItemsByGrandTotal(c,a);switch(d.topType){case"items":b=d.extractTop10Items(a);break;case"sum":b=d.extractTop10Sum(a);break;case"percent":b=d.extractTop10Percent(c,a);break}if(!d.topSort){a.length=0}return b},extractTop10Items:function(a){var c=this,d=[],b;for(b=0;b<a.length;b++){if(d.indexOf(a[b]["tempVar"])<0){d.push(a[b]["tempVar"]);if(d.length>c.value||(c.value<b+1&&b>0)){break}}}return Ext.Array.slice(a,b)},extractTop10Sum:function(a){var d=this,c=0,b;for(b=0;b<a.length;b++){c+=a[b]["tempVar"];if(c>=d.value){break}}return Ext.Array.slice(a,b+1)},extractTop10Percent:function(b,g){var h=this,e=0,k=g[0].key.split(b.matrix.keysSeparator),c,d,f,j,l,a;k.length--;j=(k.length>0?k.join(b.matrix.keysSeparator):b.matrix.grandTotalKey);d=(b.isLeftAxis?j:b.matrix.grandTotalKey);f=(b.isLeftAxis?b.matrix.grandTotalKey:j);l=b.matrix.results.get(d,f);a=(l?l.getValue(h.dimensionId):0);for(c=0;c<g.length;c++){e+=g[c]["tempVar"];if((e*100/a)>=h.value){break}}return Ext.Array.slice(g,c+1)},sortItemsByGrandTotal:function(d,b){var e=this,g,f,a,c;for(c=0;c<b.length;c++){g=(d.isLeftAxis?b[c].key:d.matrix.grandTotalKey);f=(d.isLeftAxis?d.matrix.grandTotalKey:b[c].key);a=d.matrix.results.get(g,f);b[c]["tempVar"]=(a?a.getValue(e.dimensionId):0)}Ext.Array.sort(b,function(j,i){var h=d.matrix.naturalSort(j.tempVar,i.tempVar);if(h<0&&e.topOrder==="top"){return 1}if(h>0&&e.topOrder==="top"){return -1}return h})}});Ext.define("Ext.pivot.dimension.Item",{alternateClassName:["Mz.aggregate.dimension.Item"],requires:["Ext.pivot.MixedCollection","Ext.pivot.filter.Label","Ext.pivot.filter.Value"],$configPrefixed:false,$configStrict:false,config:{id:"",header:"",dataIndex:"",sortIndex:"",width:100,flex:0,align:"left",sortable:true,direction:"ASC",sorterFn:null,caseSensitiveSort:true,filter:null,labelRenderer:null,renderer:null,formatter:null,exportStyle:null,scope:null,grouperFn:null,blankText:"(blank)",showZeroAsBlank:false,aggregator:"sum",values:null},isAggregate:false,matrix:null,constructor:function(b){var c=this,a=Ext.apply({id:Ext.id()},b||{});this.initConfig(a);if(Ext.isEmpty(c.getId())){c.setId(Ext.id())}if(Ext.isEmpty(c.getGrouperFn())){c.setGrouperFn("")}if(c.getSortable()&&!c.getSorterFn()){c.setSorterFn(c.defaultSorterFn)}if(Ext.isEmpty(c.getSortIndex())){c.setSortIndex(c.getDataIndex())}if(c.isAggregate&&!c.getFormatter()&&!c.getRenderer()){c.setRenderer(c.getDefaultFormatRenderer("0,000.00"))}return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroyMembers(a,"values","filter");a.matrix=a.values=a.filter=null},serialize:function(){var b=this,a=b.getConfig();delete (a.values);return Ext.apply(a,{filter:b.filter?b.filter.serialize():null,aggregator:Ext.isString(a.aggregator)?a.aggregator:"sum"})},applyAggregator:function(a,b){var c=Ext.pivot.Aggregators;if(a==null){delete (this.aggregatorFn);return a}if(Ext.isEmpty(a)){a="sum"}if(Ext.isString(a)&&Ext.isFunction(c[a])){this.aggregatorFn=Ext.bind(c[a],c)}else{this.aggregatorFn=a}return a},updateExportStyle:function(a){if(a&&!a.id){a.id=this.getId()}},updateGrouperFn:function(a){if(Ext.isEmpty(a)){this.groupFn=Ext.bind(this.defaultGrouperFn,this)}else{this.groupFn=a}},applyFilter:function(b,a){if(b==null){return b}if(b&&b.isFilter){b.parent=this;return b}if(Ext.isObject(b)){Ext.applyIf(b,{type:"label",parent:this});b=Ext.Factory.pivotfilter(b)}else{b=false}return b},addValue:function(b,c){var a=this.getValues();if(!a.getByKey(b)){a.add({value:b,display:c})}},getValues:function(){var a=this.values;if(!a){a=Ext.create("Ext.pivot.MixedCollection");a.getKey=function(b){return b.value};this.setValues(a)}return a},defaultSorterFn:function(f,e){var d=this,c=f.sortValue,b=e.sortValue,a;if(c instanceof Date){c=c.getTime()}if(b instanceof Date){b=b.getTime()}if(!d.caseSensitiveSort){c=String(c).toUpperCase();b=String(b).toUpperCase()}a=Ext.pivot.matrix.Base.prototype.naturalSort(c,b);if(a<0&&d.direction==="DESC"){return 1}if(a>0&&d.direction==="DESC"){return -1}return a},getDefaultFormatRenderer:function(b){var a=this;return function(d){var c;if(Ext.isEmpty(b)){return d}if(Ext.isFunction(b)){return b.apply(a,arguments)}if(!Ext.isNumber(d)){return d}if(a.isAggregate&&d===0&&a.showZeroAsBlank){return""}c=(d>=0);d=Math.abs(d);d=Ext.util.Format.number(d,b);return c?d:"-"+d}},defaultGrouperFn:function(a){return a.get(this.dataIndex)},getFormatterFn:function(){var a=this,b=a.getFormatter(),c;if(b){c=b.indexOf("this.")===0;if(c){b=b.substring(5)}b=Ext.app.bind.Template.prototype.parseFormat(b);if(c){b.scope=null}return function(d){return b.format(d,b.scope||a.getScope()||a.matrix.cmp.resolveListenerScope("self.controller")||this)}}},aggregatorFn:Ext.emptyFn,groupFn:Ext.emptyFn});Ext.define("Ext.pivot.axis.Item",{alternateClassName:["Mz.aggregate.axis.Item"],level:0,key:"",value:"",sortValue:"",name:"",dimensionId:"",dimension:null,children:null,record:null,records:null,axis:null,data:null,expanded:false,constructor:function(a){var b=this;Ext.apply(b,a||{});if(Ext.isEmpty(b.sortValue)){b.sortValue=b.value}b.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.children);a.axis=a.data=a.dimension=a.record=a.children=a.records=null;a.callParent(arguments)},getTextTotal:function(){var b=this,a=Ext.XTemplate.getTpl(b.axis.matrix,"textTotalTpl");return a.apply({groupField:b.dimension.dataIndex,columnName:b.dimension.dataIndex,name:b.name,rows:b.children||[]})},expand:function(a){var b=this;b.expanded=true;if(a===true){b.expandCollapseChildrenTree(true)}b.axis.matrix.fireEvent("groupexpand",b.axis.matrix,(b.axis.isLeftAxis?"row":"col"),b)},collapse:function(a){var b=this;b.expanded=false;if(a===true){b.expandCollapseChildrenTree(false)}b.axis.matrix.fireEvent("groupcollapse",b.axis.matrix,(b.axis.isLeftAxis?"row":"col"),b)},expandCollapseChildrenTree:function(c){var b=this,a;b.expanded=c;if(Ext.isArray(b.children)){for(a=0;a<b.children.length;a++){b.children[a].expandCollapseChildrenTree(c)}}}});Ext.define("Ext.pivot.axis.Base",{alternateClassName:["Mz.aggregate.axis.Abstract"],alias:"pivotaxis.base",mixins:["Ext.mixin.Factoryable"],requires:["Ext.pivot.MixedCollection","Ext.pivot.dimension.Item","Ext.pivot.axis.Item"],dimensions:null,matrix:null,items:null,tree:null,levels:0,isLeftAxis:false,constructor:function(a){var c=this,b,d;if(!a||!a.matrix){return}c.isLeftAxis=a.isLeftAxis||c.isLeftAxis;c.matrix=a.matrix;c.tree=[];c.dimensions=Ext.create("Ext.pivot.MixedCollection");c.dimensions.getKey=function(e){return e.getId()};c.items=Ext.create("Ext.pivot.MixedCollection");c.items.getKey=function(e){return e.key};Ext.Array.each(Ext.Array.from(a.dimensions||[]),c.addDimension,c)},destroy:function(){var a=this;Ext.destroyMembers(a,"dimensions","items","tree");a.matrix=a.dimensions=a.items=a.tree=null},addDimension:function(b){var a;if(!b){return}if(b instanceof Ext.pivot.dimension.Item){a=b;a.matrix=this.matrix}else{a=Ext.create("Ext.pivot.dimension.Item",Ext.apply({matrix:this.matrix},b))}this.dimensions.add(a)},addItem:function(b){var a=this;if(!Ext.isObject(b)||Ext.isEmpty(b.key)||Ext.isEmpty(b.value)||Ext.isEmpty(b.dimensionId)){return false}b.key=String(b.key);b.dimension=a.dimensions.getByKey(b.dimensionId);b.name=b.name||Ext.callback(b.dimension.getLabelRenderer(),b.dimension.getScope()||"self.controller",[b.value],0,a.matrix.cmp)||b.value;b.dimension.addValue(b.value,b.name);b.axis=a;if(!a.items.getByKey(b.key)&&b.dimension){a.items.add(Ext.create("Ext.pivot.axis.Item",b));return true}return false},clear:function(){this.items.clear();this.tree=null},getTree:function(){if(!this.tree){this.buildTree()}return this.tree},expandAll:function(){Ext.Array.each(this.getTree(),function(a){a.expandCollapseChildrenTree(true)});this.matrix.fireEvent("groupexpand",this.matrix,(this.isLeftAxis?"row":"col"),null)},collapseAll:function(){Ext.Array.each(this.getTree(),function(a){a.expandCollapseChildrenTree(false)});this.matrix.fireEvent("groupcollapse",this.matrix,(this.isLeftAxis?"row":"col"),null)},findTreeElement:function(c,d){var a=arguments[2]||this.tree||[],f=arguments[3]||1,e=null;var b=Ext.Array.filter(a,function(i,g,h){return Ext.isDate(d)?Ext.Date.isEqual(i[c],d):i[c]===d},this);if(b.length>0){return{level:f,node:b[0]}}Ext.Array.each(a,function(i,g,h){if(i.children){e=this.findTreeElement(c,d,i.children,f+1);if(e){return false}}},this);return e},buildTree:function(){var a=this;a.tree=[];a.items.each(a.addItemToTree,a);a.sortTree()},addItemToTree:function(e){var d=this,c=String(e.key).split(d.matrix.keysSeparator),a="",b;c=Ext.Array.slice(c,0,c.length-1);a=c.join(d.matrix.keysSeparator);b=d.findTreeElement("key",a);if(b){e.level=b.level;e.data=Ext.clone(b.node.data||{});b.node.children=b.node.children||[];b.node.children.push(e)}else{e.level=0;e.data={};d.tree.push(e)}e.data[e.dimension.getId()]=e.name;d.levels=Math.max(d.levels,e.level)},sortTree:function(){var a=arguments[0]||this.tree,b;if(a.length>0){b=a[0].dimension}if(b&&b.sortable===true){Ext.Array.sort(a,function(d,c){return b.sorterFn(d,c)})}Ext.Array.each(a,function(c){if(c.children){this.sortTree(c.children)}},this)},sortTreeByField:function(e,d){var b=this,a=false,c;if(e==b.matrix.compactViewKey){a=b.sortTreeByDimension(b.tree,b.dimensions.getRange(),d);b.dimensions.each(function(f){f.direction=d})}else{d=d||"ASC";c=b.dimensions.getByKey(e);if(c){a=b.sortTreeByDimension(b.tree,c,d);c.direction=d}else{a=b.sortTreeByRecords(b.tree,e,d)}}return a},sortTreeByDimension:function(j,c,g){var f=false,a=Ext.Array.from(c),b,e,d,h;j=j||[];e=j.length;if(e>0){b=j[0].dimension}if(Ext.Array.indexOf(a,b)>=0){if(b.sortable){h=b.direction;b.direction=g;Ext.Array.sort(j,Ext.bind(b.sorterFn,b));b.direction=h}f=b.sortable}for(d=0;d<e;d++){f=this.sortTreeByDimension(j[d].children,c,g)||f}return f},sortTreeByRecords:function(b,e,d){var c,a;b=b||[];a=b.length;if(a<=0){return false}if(b[0].record){this.sortTreeRecords(b,e,d)}else{this.sortTreeLeaves(b,e,d)}for(c=0;c<a;c++){this.sortTreeByRecords(b[c].children,e,d)}return true},sortTreeRecords:function(a,d,c){var b=this.matrix.naturalSort;c=c||"ASC";Ext.Array.sort(a||[],function(g,f){var e,i=g.record,h=f.record;if(!(i&&i.isModel&&h&&h.isModel)){return 0}e=b(i.get(d)||"",h.get(d)||"");if(e<0&&c==="DESC"){return 1}if(e>0&&c==="DESC"){return -1}return e})},sortTreeLeaves:function(i,d,e){var g=this.matrix.naturalSort,b=this.matrix.results,h=this.matrix.model,f=Ext.Array.indexOf(Ext.Array.pluck(h,"name"),d),a,c;if(f<0){return false}a=h[f]["col"];c=h[f]["agg"];e=e||"ASC";Ext.Array.sort(i||[],function(l,k){var j,n,m;n=b.get(l.key,a);if(n){n=n.getValue(c)}else{n=0}m=b.get(k.key,a);if(m){m=m.getValue(c)}else{m=0}j=g(n,m);if(j<0&&e==="DESC"){return 1}if(j>0&&e==="DESC"){return -1}return j})}});Ext.define("Ext.pivot.axis.Local",{alternateClassName:["Mz.aggregate.axis.Local"],extend:"Ext.pivot.axis.Base",alias:"pivotaxis.local",processRecord:function(d){var f=this,e=[],g="",j=true,h=f.dimensions.getCount(),a,k,b,c;for(c=0;c<h;c++){b=f.dimensions.getAt(c);a=Ext.callback(b.groupFn,b.getScope()||"self.controller",[d],0,f.matrix.cmp);k=g?g+f.matrix.keysSeparator:"";a=Ext.isEmpty(a)?b.blankText:a;k+=f.matrix.getKey(a);if(b.filter instanceof Ext.pivot.filter.Label){j=b.filter.isMatch(a)}if(!j){break}e.push({value:a,sortValue:d.get(b.sortIndex),key:k,dimensionId:b.getId()});g=k}if(j){return e}else{return null}},buildTree:function(){this.callParent(arguments);this.filterTree()},filterTree:function(){var d=this,c=d.dimensions.getCount(),a=false,b;for(b=0;b<c;b++){a=a||(d.dimensions.getAt(b).filter instanceof Ext.pivot.filter.Value)}if(!a){return}d.matrix.filterApplied=true;d.filterTreeItems(d.tree)},filterTreeItems:function(a){var d=this,c,b,e;if(!a||!Ext.isArray(a)||a.length<=0){return}c=a[0].dimension.filter;if(c&&(c instanceof Ext.pivot.filter.Value)){if(c.isTopFilter){e=c.applyFilter(d,a)||[]}else{e=Ext.Array.filter(a,d.canRemoveItem,d)}d.removeRecordsFromResults(e);d.removeItemsFromArray(a,e);for(b=0;b<e.length;b++){d.removeTreeChildren(e[b])}}for(b=0;b<a.length;b++){if(a[b].children){d.filterTreeItems(a[b].children);if(a[b].children.length===0){d.items.remove(a[b]);Ext.Array.erase(a,b,1);b--}}}},removeTreeChildren:function(c){var b,a;if(c.children){a=c.children.length;for(b=0;b<a;b++){this.removeTreeChildren(c.children[b])}}this.items.remove(c)},canRemoveItem:function(d){var c=this,f=(c.isLeftAxis?d.key:c.matrix.grandTotalKey),e=(c.isLeftAxis?c.matrix.grandTotalKey:d.key),a=c.matrix.results.get(f,e),b=d.dimension.filter;return(a?!b.isMatch(a.getValue(b.dimensionId)):false)},removeItemsFromArray:function(c,a){for(var b=0;b<c.length;b++){if(Ext.Array.indexOf(a,c[b])>=0){Ext.Array.erase(c,b,1);b--}}},removeRecordsFromResults:function(a){for(var b=0;b<a.length;b++){this.removeRecordsByItem(a[b])}},removeRecordsByItem:function(g){var f=this,e,c,b,a,d;if(g.children){f.removeRecordsFromResults(g.children)}if(f.isLeftAxis){d=f.matrix.results.get(g.key,f.matrix.grandTotalKey);b=f.matrix.results.getByLeftKey(f.matrix.grandTotalKey)}else{d=f.matrix.results.get(f.matrix.grandTotalKey,g.key);b=f.matrix.results.getByTopKey(f.matrix.grandTotalKey)}if(!d){return}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e=g.key.split(f.matrix.keysSeparator);e.length=e.length-1;while(e.length>0){if(f.isLeftAxis){b=f.matrix.results.getByLeftKey(e.join(f.matrix.keysSeparator))}else{b=f.matrix.results.getByTopKey(e.join(f.matrix.keysSeparator))}for(c=0;c<b.length;c++){f.removeItemsFromArray(b[c].records,d.records)}e.length=e.length-1}}});Ext.define("Ext.pivot.feature.PivotStore",{config:{store:null,grid:null,matrix:null,clsGrandTotal:"",clsGroupTotal:"",summaryDataCls:"",rowCls:""},constructor:function(a){this.initConfig(a);return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.storeListeners,a.matrixListeners);a.setConfig({store:null,matrix:null,grid:null});a.storeInfo=a.storeListeners=null;a.callParent(arguments)},updateStore:function(a){var b=this;Ext.destroy(b.storeListeners);if(a){b.storeListeners=a.on({pivotstoreremodel:b.processStore,scope:b,destroyable:true})}},updateMatrix:function(a){var b=this;Ext.destroy(b.matrixListeners);if(a){b.matrixListeners=a.on({groupexpand:b.onGroupExpand,groupcollapse:b.onGroupCollapse,scope:b,destroyable:true})}},processStore:function(){var g=this,j=g.getStore(),h=g.getMatrix(),c=[],a=Ext.toolkit=="classic",f,b,d,k,e;if(!h||!j){return}e=h.getColumns();j.model.replaceFields(e,true);j.removeAll(true);g.storeInfo={};if(h.rowGrandTotalsPosition=="first"){c.push.apply(c,g.processGrandTotal()||[])}f=h.leftAxis.getTree();b=f.length;for(d=0;d<b;d++){k=f[d];c.push.apply(c,g.processGroup({group:k,previousExpanded:(d>0?f[d-1].expanded:false)})||[])}if(h.rowGrandTotalsPosition=="last"){c.push.apply(c,g.processGrandTotal()||[])}j.loadData(c);if(!a){j.fireEvent("load",j)}},processGroup:function(a){var c=this,b=c["processGroup"+Ext.String.capitalize(c.getMatrix().viewLayoutType)];if(!Ext.isFunction(b)){b=c.processGroupOutline}return b.call(c,a)},processGrandTotal:function(){var c=this,d=false,b=c.getMatrix(),e={key:b.grandTotalKey},a=[];Ext.Array.forEach(b.totals||[],function(h){var f=h.record,g=b.leftAxis.dimensions.getCount();if(!(f instanceof Ext.data.Model)){return}c.storeInfo[f.internalId]={leftKey:e.key,rowStyle:"",rowClasses:[c.getClsGrandTotal(),c.getSummaryDataCls()],rendererParams:{}};b.leftAxis.dimensions.each(function(k,i){var j;if(b.viewLayoutType=="compact"||i===0){if(b.viewLayoutType=="compact"){j=b.compactViewKey;g=1}else{j=k.getId()}f.set(j,h.title);f.commit(false,[j]);c.storeInfo[f.internalId].rendererParams[j]={fn:"groupOutlineRenderer",group:e,colspan:g,hidden:false,subtotalRow:true};d=true}else{c.storeInfo[f.internalId].rendererParams[k.getId()]={fn:"groupOutlineRenderer",group:e,colspan:0,hidden:d,subtotalRow:true};g--}});c.storeInfo[f.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};a.push(f)});return a},processGroupOutline:function(a){var c=this,d=a.group,b=[];if(d.record){c.processRecordOutline({results:b,group:d})}else{c.processGroupOutlineWithChildren({results:b,group:d,previousExpanded:a.previousExpanded})}return b},processGroupOutlineWithChildren:function(d){var g=this,c=g.getMatrix(),h=d.group,b=d.previousExpanded,f,a,e;f=(!h.expanded||(h.expanded&&c.rowSubTotalsPosition=="first"));a=h.expanded?h.records.expanded:h.records.collapsed;g.processGroupHeaderRecordOutline({results:d.results,group:h,record:a,previousExpanded:b,hasSummaryData:f});if(h.expanded){if(h.children){for(e=0;e<h.children.length;e++){if(h.children[e]["children"]){g.processGroupOutlineWithChildren({results:d.results,group:h.children[e]})}else{g.processRecordOutline({results:d.results,group:h.children[e]})}}}if(c.rowSubTotalsPosition=="last"){a=h.records.footer;g.processGroupHeaderRecordOutline({results:d.results,group:h,record:a,previousExpanded:b,subtotalRow:true,hasSummaryData:true})}}},processGroupHeaderRecordOutline:function(a){var f=this,g=f.getMatrix(),h=a.group,d=a.record,b=a.previousExpanded,j=a.subtotalRow,e=a.hasSummaryData,c=g.leftAxis.dimensions.getCount(),k=false;f.storeInfo[d.internalId]={leftKey:h.key,rowStyle:"",rowClasses:[f.getClsGroupTotal(),e?f.getSummaryDataCls():""],rendererParams:{}};g.leftAxis.dimensions.each(function(l,i){if(l.getId()==h.dimension.getId()){f.storeInfo[d.internalId].rendererParams[l.getId()]={fn:"groupOutlineRenderer",group:h,colspan:c,hidden:false,previousExpanded:b,subtotalRow:j};k=true}else{f.storeInfo[d.internalId].rendererParams[l.getId()]={fn:"groupOutlineRenderer",group:h,colspan:0,hidden:k,previousExpanded:b,subtotalRow:j};c--}});f.storeInfo[d.internalId].rendererParams.topaxis={fn:(e?"topAxisRenderer":"topAxisNoRenderer")};a.results.push(d)},processRecordOutline:function(b){var c=this,e=b.group,d=false,a=e.record;c.storeInfo[a.internalId]={leftKey:e.key,rowStyle:"",rowClasses:[c.getSummaryDataCls()],rendererParams:{}};c.getMatrix().leftAxis.dimensions.each(function(g,f){if(g.getId()==e.dimension.getId()){d=true}c.storeInfo[a.internalId].rendererParams[g.getId()]={fn:"recordOutlineRenderer",group:e,hidden:!d}});c.storeInfo[a.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};b.results.push(a)},processGroupCompact:function(b){var d=this,e=b.group,a=b.previousExpanded,c=[];if(e.record){d.processRecordCompact({results:c,group:e})}else{d.processGroupCompactWithChildren({results:c,group:e,previousExpanded:a})}return c},processGroupCompactWithChildren:function(c){var f=this,b=f.getMatrix(),g=c.group,a=c.previousExpanded,e,d;e=(!g.expanded||(g.expanded&&b.rowSubTotalsPosition=="first"));f.processGroupHeaderRecordCompact({results:c.results,group:g,record:g.expanded?g.records.expanded:g.records.collapsed,previousExpanded:a,hasSummaryData:e});if(g.expanded){if(g.children){for(d=0;d<g.children.length;d++){if(g.children[d]["children"]){f.processGroupCompactWithChildren({results:c.results,group:g.children[d]})}else{f.processRecordCompact({results:c.results,group:g.children[d]})}}}if(b.rowSubTotalsPosition=="last"){f.processGroupHeaderRecordCompact({results:c.results,group:g,record:g.records.footer,previousExpanded:a,subtotalRow:true,hasSummaryData:true})}}},processGroupHeaderRecordCompact:function(d){var g=this,c=g.getMatrix(),h=d.group,a=d.record,b=d.previousExpanded,f=d.subtotalRow,e=d.hasSummaryData;g.storeInfo[a.internalId]={leftKey:h.key,rowStyle:"",rowClasses:[g.getClsGroupTotal(),e?g.getSummaryDataCls():""],rendererParams:{}};g.storeInfo[a.internalId].rendererParams[c.compactViewKey]={fn:"groupCompactRenderer",group:h,colspan:0,previousExpanded:b,subtotalRow:f};g.storeInfo[a.internalId].rendererParams.topaxis={fn:(e?"topAxisRenderer":"topAxisNoRenderer")};d.results.push(a)},processRecordCompact:function(b){var c=this,d=b.group,a=d.record;c.storeInfo[a.internalId]={leftKey:d.key,rowStyle:"",rowClasses:[c.getSummaryDataCls()],rendererParams:{}};c.storeInfo[a.internalId].rendererParams[c.getMatrix().compactViewKey]={fn:"recordCompactRenderer",group:d};c.storeInfo[a.internalId].rendererParams.topaxis={fn:"topAxisRenderer"};b.results.push(a)},doExpandCollapse:function(c,a){var d=this,b=d.getGrid(),e;e=d.getMatrix().leftAxis.findTreeElement("key",c);if(!e){return}d.doExpandCollapseInternal(e.node,a);b.fireEvent((e.node.expanded?"pivotgroupexpand":"pivotgroupcollapse"),b,"row",e.node)},doExpandCollapseInternal:function(i,b){var e=this,g=e.getStore(),a=Ext.toolkit=="classic",d,h,f,c;i.expanded=!i.expanded;h=e.processGroup({group:i,previousExpanded:false});i.expanded=!i.expanded;d=e.processGroup({group:i,previousExpanded:false});if(d.length&&(f=g.indexOf(b))!==-1){if(a){g.suspendEvents()}if(i.expanded){g.remove(g.getAt(f));g.insert(f,d);h=[b]}else{c=h.length;h=g.getRange(f,f+c-1);g.remove(h);g.insert(f,d)}e.removeStoreInfoData(h);if(a){g.resumeEvents();g.fireEvent("replace",g,f,h,d)}}},removeStoreInfoData:function(a){Ext.Array.each(a,function(b){if(this.storeInfo[b.internalId]){delete this.storeInfo[b.internalId]}},this)},onGroupExpand:function(a,b,c){if(b=="row"){if(c){this.doExpandCollapseInternal(c,c.records.collapsed)}else{this.processStore()}}},onGroupCollapse:function(a,b,c){if(b=="row"){if(c){this.doExpandCollapseInternal(c,c.records.expanded)}else{this.processStore()}}}});Ext.define("Ext.pivot.result.Base",{alias:"pivotresult.base",mixins:["Ext.mixin.Factoryable"],leftKey:"",topKey:"",dirty:false,values:null,matrix:null,constructor:function(a){var b=this;Ext.apply(b,a||{});b.values={};return b.callParent(arguments)},destroy:function(){var a=this;a.matrix=a.values=null;a.leftAxisItem=a.topAxisItem=null;return a.callParent(arguments)},calculate:Ext.emptyFn,calculateByFn:Ext.emptyFn,addValue:function(b,a){this.values[b]=a},getValue:function(a){return this.values[a]},getLeftAxisItem:function(){return this.matrix.leftAxis.items.getByKey(this.leftKey)},getTopAxisItem:function(){return this.matrix.topAxis.items.getByKey(this.topKey)}});Ext.define("Ext.pivot.result.Collection",{alternateClassName:["Mz.aggregate.matrix.Results"],requires:["Ext.pivot.MixedCollection","Ext.pivot.result.Base"],resultType:"base",items:null,matrix:null,constructor:function(a){var b=this;Ext.apply(b,a||{});b.items=Ext.create("Ext.pivot.MixedCollection");b.items.getKey=function(c){return c.leftKey+"/"+c.topKey};return b.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.items);a.matrix=a.items=null;a.callParent(arguments)},clear:function(){this.items.clear()},add:function(c,a){var b=this.get(c,a);if(!b){b=this.items.add(Ext.Factory.pivotresult({type:this.resultType,leftKey:c,topKey:a,matrix:this.matrix}))}return b},get:function(b,a){return this.items.getByKey(b+"/"+a)},getByLeftKey:function(b){var a=this.items.filterBy(function(e,c){var d=String(c).split("/");return(b==d[0])});return a.getRange()},getByTopKey:function(b){var a=this.items.filterBy(function(e,c){var d=String(c).split("/");return(d.length>1&&b==d[1])});return a.getRange()},calculate:function(){this.items.each(function(a){a.calculate()})}});Ext.define("Ext.pivot.matrix.Base",{alternateClassName:["Mz.aggregate.matrix.Abstract"],extend:"Ext.util.Observable",alias:"pivotmatrix.base",mixins:["Ext.mixin.Factoryable"],requires:["Ext.util.DelayedTask","Ext.data.ArrayStore","Ext.XTemplate","Ext.pivot.Aggregators","Ext.pivot.MixedCollection","Ext.pivot.axis.Base","Ext.pivot.dimension.Item","Ext.pivot.result.Collection"],resultType:"base",leftAxisType:"base",topAxisType:"base",textRowLabels:"Row labels",textTotalTpl:"Total ({name})",textGrandTotalTpl:"Grand total",keysSeparator:"#_#",grandTotalKey:"grandtotal",compactViewKey:"_compactview_",compactViewColumnWidth:200,viewLayoutType:"outline",rowSubTotalsPosition:"first",rowGrandTotalsPosition:"last",colSubTotalsPosition:"first",colGrandTotalsPosition:"last",showZeroAsBlank:false,leftAxis:null,topAxis:null,aggregate:null,results:null,pivotStore:null,isDestroyed:false,cmp:null,isPivotMatrix:true,constructor:function(b){var a=this.callParent(arguments);this.initialize(true,b);return a},destroy:function(){var a=this;a.delayedTask.cancel();a.delayedTask=null;if(Ext.isFunction(a.onDestroy)){a.onDestroy()}Ext.destroy(a.results,a.leftAxis,a.topAxis,a.aggregate,a.pivotStore);a.results=a.leftAxis=a.topAxis=a.aggregate=a.pivotStore=null;if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}if(Ext.isArray(a.totals)){a.totals.length=0}a.columns=a.model=a.totals=a.keysMap=a.cmp=a.modelInfo=null;a.isDestroyed=true;a.callParent(arguments)},getKey:function(b){var a=this;a.keysMap=a.keysMap||{};if(!Ext.isDefined(a.keysMap[b])){a.keysMap[b]=Ext.id()}return a.keysMap[b]},naturalSort:(function(){var d=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,f=/^\s+|\s+$/g,c=/\s+/g,b=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,e=/^0x[0-9a-f]+$/i,a=/^0/,g=function(i,h){i=i||"";return(!i.match(a)||h==1)&&parseFloat(i)||i.replace(c," ").replace(f,"")||0};return function(q,o){var r=String(q instanceof Date?q.getTime():(q||"")).replace(f,""),n=String(o instanceof Date?o.getTime():(o||"")).replace(f,""),t=r.replace(d,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),l=n.replace(d,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),j=parseInt(r.match(e),16)||(t.length!==1&&Date.parse(r)),u=parseInt(n.match(e),16)||j&&n.match(b)&&Date.parse(n)||null,s,m;if(u){if(j<u){return -1}else{if(j>u){return 1}}}for(var p=0,i=t.length,k=l.length,h=Math.max(i,k);p<h;p++){s=g(t[p],i);m=g(l[p],k);if(isNaN(s)!==isNaN(m)){return(isNaN(s))?1:-1}else{if(typeof s!==typeof m){s+="";m+=""}}if(s<m){return -1}if(s>m){return 1}}return 0}}()),initialize:function(e,a){var d=this,c=["viewLayoutType","rowSubTotalsPosition","rowGrandTotalsPosition","colSubTotalsPosition","colGrandTotalsPosition","showZeroAsBlank"],b;d.initResults();d.initAggregates(a.aggregate||[]);d.initAxis(a.leftAxis||[],a.topAxis||[]);for(b=0;b<c.length;b++){if(a.hasOwnProperty(c[b])){d[c[b]]=a[c[b]]}}d.totals=[];d.modelInfo={};d.keysMap=null;if(e){d.pivotStore=Ext.create("Ext.data.ArrayStore",{autoDestroy:false,fields:[]});d.delayedTask=new Ext.util.DelayedTask(d.startProcess,d);if(Ext.isFunction(d.onInitialize)){d.onInitialize()}}},onInitialize:Ext.emptyFn,onDestroy:Ext.emptyFn,reconfigure:function(a){var b=this,a=Ext.clone(a||{});if(b.fireEvent("beforereconfigure",b,a)!==false){if(Ext.isFunction(b.onReconfigure)){b.onReconfigure(a)}b.fireEvent("reconfigure",b,a);b.initialize(false,a);b.clearData();b.delayedTask.delay(5)}else{b.delayedTask.cancel()}},onReconfigure:Ext.emptyFn,initResults:function(){Ext.destroy(this.results);this.results=Ext.create("Ext.pivot.result.Collection",{resultType:this.resultType,matrix:this})},initAggregates:function(d){var c=this,a,b;Ext.destroy(c.aggregate);c.aggregate=Ext.create("Ext.pivot.MixedCollection");c.aggregate.getKey=function(e){return e.getId()};if(Ext.isEmpty(d)){return}d=Ext.Array.from(d);for(a=0;a<d.length;a++){b=d[a];if(!(b instanceof Ext.pivot.dimension.Item)){Ext.applyIf(b,{isAggregate:true,align:"right",showZeroAsBlank:c.showZeroAsBlank});b.matrix=this;b=Ext.create("Ext.pivot.dimension.Item",b)}c.aggregate.add(b)}},initAxis:function(c,a){var b=this;c=Ext.Array.from(c||[]);a=Ext.Array.from(a||[]);Ext.destroy(b.leftAxis);b.leftAxis=Ext.Factory.pivotaxis({type:b.leftAxisType,matrix:b,dimensions:c,isLeftAxis:true});Ext.destroy(b.topAxis);b.topAxis=Ext.Factory.pivotaxis({type:b.topAxisType,matrix:b,dimensions:a,isLeftAxis:false})},clearData:function(){var a=this;a.fireEvent("cleardata",a);a.leftAxis.clear();a.topAxis.clear();a.results.clear();if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}a.totals=[];a.modelInfo={};a.keysMap=null;if(a.pivotStore){a.pivotStore.removeAll(true)}},startProcess:Ext.emptyFn,endProcess:function(){var a=this;a.leftAxis.getTree();a.topAxis.getTree();a.buildModelAndColumns();a.buildPivotStore();if(Ext.isFunction(a.onBuildStore)){a.onBuildStore(a.pivotStore)}a.fireEvent("storebuilt",a,a.pivotStore);a.fireEvent("done",a)},onBuildModel:Ext.emptyFn,onBuildColumns:Ext.emptyFn,onBuildRecord:Ext.emptyFn,onBuildTotals:Ext.emptyFn,onBuildStore:Ext.emptyFn,buildModelAndColumns:function(){var a=this;a.model=[{name:"id",type:"string"},{name:"isRowGroupHeader",type:"boolean",defaultValue:false},{name:"isRowGroupTotal",type:"boolean",defaultValue:false},{name:"isRowGrandTotal",type:"boolean",defaultValue:false},{name:"leftAxisKey",type:"boolean",defaultValue:null}];a.internalCounter=0;a.columns=[];if(a.viewLayoutType=="compact"){a.generateCompactLeftAxis()}else{a.leftAxis.dimensions.each(function(b){this.parseLeftAxisDimension(b)},a)}if(a.colGrandTotalsPosition=="first"){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:true}))}Ext.Array.each(a.topAxis.getTree(),function(b){this.parseTopAxisItem(b)},a);if(a.colGrandTotalsPosition=="last"){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:true}))}if(Ext.isFunction(a.onBuildModel)){a.onBuildModel(a.model)}a.fireEvent("modelbuilt",a,a.model);if(Ext.isFunction(a.onBuildColumns)){a.onBuildColumns(a.columns)}a.fireEvent("columnsbuilt",a,a.columns)},getDefaultFieldInfo:function(a){return Ext.apply({isColGroupTotal:false,isColGrandTotal:false,leftAxisColumn:false,topAxisColumn:false,topAxisKey:null},a)},parseLeftAxisDimension:function(b){var a=this,c=b.getId();a.model.push({name:c,type:"string"});a.columns.push({dataIndex:c,text:b.header,dimension:b,leftAxis:true});a.modelInfo[c]=a.getDefaultFieldInfo({leftAxisColumn:true})},generateCompactLeftAxis:function(){var a=this;a.model.push({name:a.compactViewKey,type:"string"});a.columns.push({dataIndex:a.compactViewKey,text:a.textRowLabels,leftAxis:true,width:a.compactViewColumnWidth});a.modelInfo[a.compactViewKey]=a.getDefaultFieldInfo({leftAxisColumn:true})},parseTopAxisItem:function(e){var d=this,b=[],a=[],g,c,f=false;if(!e.children){b=d.parseAggregateForColumn(e,null);if(e.level===0){d.columns.push(b)}else{return b}}else{if(d.colSubTotalsPosition=="first"){c=d.addColSummary(e);if(c){a.push(c)}}Ext.Array.each(e.children,function(i){var h=d.parseTopAxisItem(i);if(Ext.isArray(h)){b=Ext.Array.merge(b,h)}else{b.push(h)}});g={text:e.name,group:e,columns:b,key:e.key,xexpandable:true,xgrouped:true};if(e.level===0){d.columns.push(g)}a.push(g);if(d.colSubTotalsPosition=="last"){c=d.addColSummary(e);if(c){a.push(c)}}if(d.colSubTotalsPosition=="none"){c=d.addColSummary(e);if(c){a.push(c)}}return a}},addColSummary:function(c){var b=this,a,d=false;a=b.parseAggregateForColumn(c,{text:c.expanded?c.getTextTotal():c.name,group:c,subTotal:true});if(c.level===0){b.columns.push(a)}Ext.apply(a,{key:c.key,xexpandable:true,xgrouped:true});return a},parseAggregateForColumn:function(j,c){var g=this,e=[],d={},a=g.aggregate.getRange(),b=a.length,f,h;for(f=0;f<b;f++){h=a[f];g.internalCounter++;g.model.push({name:"c"+g.internalCounter,type:"auto",defaultValue:undefined,useNull:true,col:j?j.key:g.grandTotalKey,agg:h.getId()});e.push({dataIndex:"c"+g.internalCounter,text:h.header,topAxis:true,subTotal:(c?c.subTotal===true:false),grandTotal:(c?c.grandTotal===true:false),dimension:h});g.modelInfo["c"+g.internalCounter]=g.getDefaultFieldInfo({isColGroupTotal:(c?c.subTotal===true:false),isColGrandTotal:(c?c.grandTotal===true:false),topAxisColumn:true,topAxisKey:j?j.key:g.grandTotalKey})}if(e.length==0&&g.aggregate.getCount()==0){g.internalCounter++;d=Ext.apply({text:j?j.name:"",dataIndex:"c"+g.internalCounter},c||{})}else{if(e.length==1){d=Ext.applyIf({text:j?j.name:""},e[0]);Ext.apply(d,c||{});if(c&&c.grandTotal&&g.aggregate.getCount()==1){d.text=g.aggregate.getAt(0).header||c.text}}else{d=Ext.apply({text:j?j.name:"",columns:e},c||{})}}return d},buildPivotStore:function(){var a=this;if(Ext.isFunction(a.pivotStore.model.setFields)){a.pivotStore.model.setFields(a.model)}else{a.pivotStore.model.replaceFields(a.model,true)}a.pivotStore.removeAll(true);Ext.Array.each(a.leftAxis.getTree(),a.addRecordToPivotStore,a);a.addGrandTotalsToPivotStore()},addGrandTotalsToPivotStore:function(){var b=this,a=[];a.push({title:b.textGrandTotalTpl,values:b.preparePivotStoreRecordData({key:b.grandTotalKey},{isRowGrandTotal:true})});if(Ext.isFunction(b.onBuildTotals)){b.onBuildTotals(a)}b.fireEvent("buildtotals",b,a);Ext.Array.forEach(a,function(c){if(Ext.isObject(c)&&Ext.isObject(c.values)){Ext.applyIf(c.values,{isRowGrandTotal:true});b.totals.push({title:c.title||"",record:b.pivotStore.add(c.values)[0]})}})},addRecordToPivotStore:function(d){var c=this,a,b;if(!d.children){a=c.pivotStore.add(c.preparePivotStoreRecordData(d))[0];d.record=a;if(Ext.isFunction(c.onBuildRecord)){c.onBuildRecord(a)}c.fireEvent("recordbuilt",c,a)}else{d.records={};b=(c.viewLayoutType=="outline"?d.dimensionId:c.compactViewKey);d.records.collapsed=c.pivotStore.add(c.preparePivotStoreRecordData(d,{isRowGroupHeader:true,isRowGroupTotal:true}))[0];if(c.rowSubTotalsPosition=="first"){d.records.expanded=c.pivotStore.add(c.preparePivotStoreRecordData(d,{isRowGroupHeader:true}))[0]}else{a={};a[b]=d.name;a.isRowGroupHeader=true;d.records.expanded=c.pivotStore.add(a)[0];if(c.rowSubTotalsPosition=="last"){a=c.preparePivotStoreRecordData(d,{isRowGroupTotal:true});a[b]=d.getTextTotal();d.records.footer=c.pivotStore.add(a)[0]}}Ext.Array.each(d.children,function(e){c.addRecordToPivotStore(e)})}},preparePivotStoreRecordData:function(d,a){var b=this,c={};if(d){if(d.dimensionId){c[d.dimensionId]=d.name}c.leftAxisKey=d.key;Ext.Array.each(b.model,function(f){var e;if(f.col&&f.agg){e=b.results.get(d.key,f.col);if(e){c[f.name]=e.getValue(f.agg)}}});if(b.viewLayoutType=="compact"){c[b.compactViewKey]=d.name}}return Ext.applyIf(c,a)},getColumns:function(){return this.model},getColumnHeaders:function(){var a=this;if(!a.model){a.buildModelAndColumns()}return a.columns},isGroupRow:function(a){var b=this.leftAxis.findTreeElement("key",a);if(!b){return false}return(b.node.children&&b.node.children.length==0)?0:b.level},isGroupCol:function(a){var b=this.topAxis.findTreeElement("key",a);if(!b){return false}return(b.node.children&&b.node.children.length==0)?0:b.level},deprecated:{"6.0":{properties:{mztype:"type",mztypeLeftAxis:"leftAxisType",mztypeTopAxis:"topAxisType"}}}});Ext.define("Ext.pivot.result.Local",{extend:"Ext.pivot.result.Base",alias:"pivotresult.local",alternateClassName:["Mz.aggregate.matrix.Result"],records:null,constructor:function(a){this.records=[];return this.callParent(arguments)},destroy:function(){this.records.length=0;this.records=null;return this.callParent(arguments)},calculate:function(){var c=this,a,d,b=c.matrix.aggregate.getCount();for(a=0;a<b;a++){d=c.matrix.aggregate.getAt(a);c.addValue(d.getId(),Ext.callback(d.aggregatorFn,d.getScope()||"self.controller",[c.records,d.dataIndex,c.matrix,c.leftKey,c.topKey],0,c.matrix.cmp))}},calculateByFn:function(d,c,a){var e=this,b;if(Ext.isString(a)){a=Ext.pivot.Aggregators[a]}b=a(e.records,c,e.matrix,e.leftKey,e.topKey);e.addValue(d,b);return b},addRecord:function(a){this.records.push(a)}});Ext.define("Ext.pivot.matrix.Local",{alternateClassName:["Mz.aggregate.matrix.Local"],extend:"Ext.pivot.matrix.Base",alias:"pivotmatrix.local",requires:["Ext.pivot.matrix.Base","Ext.pivot.axis.Local","Ext.pivot.result.Local"],resultType:"local",leftAxisType:"local",topAxisType:"local",store:null,recordsPerJob:1000,timeBetweenJobs:2,onInitialize:function(){var a=this;a.localDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.newRecordsDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreAddDelayed,a);a.updateRecordsDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreUpdateDelayed,a);a.initializeStore({store:a.store});a.callParent(arguments)},initializeStore:function(c){var d=this,a,b;if(c.store){b=c.store}else{if(d.store){if(d.store.isStore&&!d.storeListeners){a=d.store}else{b=d.store}}}if(b){a=Ext.getStore(b||"");if(Ext.isEmpty(a)&&Ext.isString(b)){a=Ext.create(b)}}if(a&&a.isStore){Ext.destroy(d.storeListeners);if(d.store&&d.store.autoDestroy&&a!=d.store){Ext.destroy(d.store)}d.store=a;d.storeListeners=d.store.on({refresh:d.startProcess,beforeload:d.onOriginalStoreBeforeLoad,add:d.onOriginalStoreAdd,update:d.onOriginalStoreUpdate,remove:d.onOriginalStoreRemove,clear:d.startProcess,scope:d,destroyable:true});if(a.isLoaded()){d.startProcess()}}},onReconfigure:function(a){this.initializeStore(a);this.callParent(arguments)},onDestroy:function(){var a=this;a.localDelayedTask.cancel();a.localDelayedTask=null;a.newRecordsDelayedTask.cancel();a.newRecordsDelayedTask=null;a.updateRecordsDelayedTask.cancel();a.updateRecordsDelayedTask=null;if(Ext.isArray(a.records)){a.records.length=0}a.records=null;Ext.destroy(a.storeListeners);if(a.store&&a.store.isStore&&a.store.autoDestroy){Ext.destroy(a.store)}a.store=a.storeListeners=null;a.callParent(arguments)},onOriginalStoreBeforeLoad:function(a){this.fireEvent("start",this)},onOriginalStoreAdd:function(b,a){var c=this;c.newRecords=c.newRecords||[];c.newRecords=Ext.Array.merge(c.newRecords,Ext.Array.from(a));c.newRecordsDelayedTask.delay(100)},onOriginalStoreAddDelayed:function(){var c=this,b,a;a=Ext.Array.from(c.newRecords||[]);for(b=0;b<a.length;b++){c.processRecord(a[b],b,a.length)}c.newRecords=[];c.leftAxis.tree=null;c.leftAxis.buildTree();c.topAxis.tree=null;c.topAxis.buildTree();c.recalculateResults(c.store,a)},onOriginalStoreUpdate:function(b,a){var c=this;c.updateRecords=c.updateRecords||[];c.updateRecords=Ext.Array.merge(c.updateRecords,Ext.Array.from(a));c.updateRecordsDelayedTask.delay(100)},onOriginalStoreUpdateDelayed:function(){var a=this;a.recalculateResults(a.store,a.updateRecords);a.updateRecords.length=0},onOriginalStoreRemove:function(c,a,d,b){if(b){return}this.startProcess()},isReallyDirty:function(b,a){var c=true;a=Ext.Array.from(a);this.leftAxis.dimensions.each(function(d){Ext.Array.forEach(a,function(e){c=(e&&e.isModel&&d.getValues().containsKey(e.get(d.dataIndex)));return c});return c});return !c},recalculateResults:function(b,a){var c=this;if(c.isReallyDirty(b,a)){c.startProcess();return}c.fireEvent("beforeupdate",c);c.results.calculate();Ext.Array.each(c.leftAxis.getTree(),c.updateRecordToPivotStore,c);c.updateGrandTotalsToPivotStore();c.fireEvent("afterupdate",c)},updateGrandTotalsToPivotStore:function(){var c=this,b=[],a;if(c.totals.length<=0){return}b.push({title:c.textGrandTotalTpl,values:c.preparePivotStoreRecordData({key:c.grandTotalKey})});if(Ext.isFunction(c.onBuildTotals)){c.onBuildTotals(b)}c.fireEvent("buildtotals",c,b);if(c.totals.length===b.length){for(a=0;a<c.totals.length;a++){if(Ext.isObject(b[a])&&Ext.isObject(b[a].values)&&(c.totals[a].record instanceof Ext.data.Model)){delete (b[a].values.id);c.totals[a].record.set(b[a].values)}}}},updateRecordToPivotStore:function(c){var b=this,a,d;if(!c.children){if(c.record){d=b.preparePivotStoreRecordData(c);delete (d.id);c.record.set(d)}}else{if(c.records){a=(b.viewLayoutType=="outline"?c.dimensionId:b.compactViewKey);d=b.preparePivotStoreRecordData(c);delete (d.id);delete (d[a]);c.records.collapsed.set(d);if(b.rowSubTotalsPosition=="first"){c.records.expanded.set(d)}else{if(b.rowSubTotalsPosition=="last"){c.records.footer.set(d)}}}Ext.Array.each(c.children,b.updateRecordToPivotStore,b)}},startProcess:function(){var a=this;if(!a.store||(a.store&&!a.store.isStore)||a.isDestroyed||a.store.isLoading()){return}a.clearData();a.localDelayedTask.delay(50)},delayedProcess:function(){var a=this;a.fireEvent("start",a);a.records=a.store.getRange();if(a.records.length==0){a.endProcess();return}a.statusInProgress=false;a.processRecords(0)},processRecords:function(a){var c=this,b=a,d;if(c.isDestroyed){return}d=c.records.length;c.statusInProgress=true;while(b<d&&b<a+c.recordsPerJob&&c.statusInProgress){c.processRecord(c.records[b],b,d);b++}if(b>=d){c.statusInProgress=false;c.results.calculate();c.leftAxis.buildTree();c.topAxis.buildTree();if(c.filterApplied){c.results.calculate()}c.records=null;c.endProcess();return}if(c.statusInProgress&&d>0){Ext.defer(c.processRecords,c.timeBetweenJobs,c,[b])}},processRecord:function(e,f,a){var g=this,h=g.grandTotalKey,k,b,d,c;k=g.leftAxis.processRecord(e);b=g.topAxis.processRecord(e);if(k&&b){g.results.add(h,h).addRecord(e);for(d=0;d<b.length;d++){g.topAxis.addItem(b[d]);g.results.add(h,b[d].key).addRecord(e)}for(d=0;d<k.length;d++){g.leftAxis.addItem(k[d]);g.results.add(k[d].key,h).addRecord(e);for(c=0;c<b.length;c++){g.results.add(k[d].key,b[c].key).addRecord(e)}}}g.fireEvent("progress",g,f+1,a)},getRecordsByRowGroup:function(d){var c=this.results.getByLeftKey(d),e=c.length,a=[],b;for(b=0;b<e;b++){a=Ext.Array.merge(a,c[b].records||[])}return a},getRecordsByColGroup:function(d){var c=this.results.getByTopKey(d),e=c.length,a=[],b;for(b=0;b<e;b++){a=Ext.Array.merge(a,c[b].records||[])}return a},getRecordsByGroups:function(c,b){var a=this.results.get(c,b);return(a?a.records||[]:[])}});Ext.define("Ext.pivot.matrix.Remote",{alternateClassName:["Mz.aggregate.matrix.Remote"],extend:"Ext.pivot.matrix.Base",alias:"pivotmatrix.remote",url:"",timeout:3000,onBeforeRequest:Ext.emptyFn,onRequestException:Ext.emptyFn,onInitialize:function(){var a=this;a.remoteDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.callParent(arguments)},startProcess:function(){var a=this;if(Ext.isEmpty(a.url)){return}a.clearData();a.fireEvent("start",a);a.statusInProgress=false;a.remoteDelayedTask.delay(5)},delayedProcess:function(){var e=this,d=[],a=[],c=[],b,f;e.leftAxis.dimensions.each(function(g){d.push(g.serialize())});e.topAxis.dimensions.each(function(g){a.push(g.serialize())});e.aggregate.each(function(g){c.push(g.serialize())});f={keysSeparator:e.keysSeparator,grandTotalKey:e.grandTotalKey,leftAxis:d,topAxis:a,aggregate:c};b=e.fireEvent("beforerequest",e,f);if(b!==false){if(Ext.isFunction(e.onBeforeRequest)){b=e.onBeforeRequest(f)}}if(b===false){e.endProcess()}else{Ext.Ajax.request({url:e.url,timeout:e.timeout,jsonData:f,callback:e.processRemoteResults,scope:e})}},processRemoteResults:function(b,f,a){var d=this,c=!f,e=Ext.JSON.decode(a.responseText,true);if(f){c=(!e||!e.success)}if(c){d.fireEvent("requestexception",d,a);if(Ext.isFunction(d.onRequestException)){d.onRequestException(a)}d.endProcess();return}Ext.Array.each(Ext.Array.from(e.leftAxis||[]),function(g){if(Ext.isObject(g)){d.leftAxis.addItem(g)}});Ext.Array.each(Ext.Array.from(e.topAxis||[]),function(g){if(Ext.isObject(g)){d.topAxis.addItem(g)}});Ext.Array.each(Ext.Array.from(e.results||[]),function(h){if(Ext.isObject(h)){var g=d.results.add(h.leftKey||"",h.topKey||"");Ext.Object.each(h.values||{},g.addValue,g)}});d.endProcess()}});Ext.define("Ext.pivot.plugin.Exporter",{alternateClassName:["Mz.pivot.plugin.ExcelExport"],alias:["plugin.pivotexporter","plugin.mzexcelexport"],extend:"Ext.exporter.Plugin",lockableScope:"top",init:function(b){var a=this;return a.callParent([b])},prepareData:function(b){var h=this,o=new Ext.exporter.data.Table(),m,n,c,a,k,f,e,g,d,l,p;h.matrix=m=h.cmp.getMatrix();h.onlyExpandedNodes=(b&&b.onlyExpandedNodes);if(!h.onlyExpandedNodes){h.setColumnsExpanded(m.topAxis.getTree(),true)}c=Ext.clone(m.getColumnHeaders());a=h.getColumnHeaders(c,b);l=h.getDataIndexColumns(c);if(!h.onlyExpandedNodes){h.setColumnsExpanded(m.topAxis.getTree())}n=o.addGroup({text:""});h.extractGroups(n,m.leftAxis.getTree(),l);d=m.totals.length;g=l.length;for(f=0;f<d;f++){k=m.totals[f];p=n.addSummary();p.addCell({value:k.title});for(e=1;e<g;e++){p.addCell({value:h.getRecordValue(k.record,l[e])})}}h.matrix=h.onlyExpandedNodes=null;o.addGroup(n);o.setColumns(a);return o},setColumnsExpanded:function(b,a){for(var c=0;c<b.length;c++){if(Ext.isDefined(a)){b[c].backupExpanded=b[c].expanded;b[c].expanded=a}else{b[c].expanded=b[c].backupExpanded;b[c].backupExpanded=null}if(b[c].children){this.setColumnsExpanded(b[c].children,a)}}},getColumnHeaders:function(e,b){var h=[],f=e.length,d,g,a,c;for(d=0;d<f;d++){a=e[d];c=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):true;if(c){g={text:(a.subTotal&&a.group.expanded?a.group.getTextTotal():a.text)};if(a.columns){g.columns=this.getColumnHeaders(a.columns,b)}else{g.width=a.dimension?a.dimension.getWidth():a.width||100;g.style=a.dimension?this.getExportStyle(a.dimension.getExportStyle(),b):null}h.push(g)}}return h},getRecordValue:function(a,c){var b=a.data;return(Ext.isEmpty(b[c.dataIndex])||(this.matrix.showZeroAsBlank&&b[c.dataIndex]===0))?"":b[c.dataIndex]},getDataIndexColumns:function(d){var e=[],c,a,b;for(c=0;c<d.length;c++){a=d[c];b=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):true;if(b){if(a.dataIndex){e.push({dataIndex:a.dataIndex,agg:a.dimension?a.dimension.getId():null})}else{if(a.columns){e=Ext.Array.merge(e,this.getDataIndexColumns(a.columns))}}}}return e},extractGroups:function(l,h,b){var d,c,a,k,f,m,n,g,e;a=h.length;for(d=0;d<a;d++){m=h[d];if(m.record){n=l.addRow();for(c=0;c<b.length;c++){n.addCell({value:this.getRecordValue(m.record,b[c])})}}else{if(m.children){g=l.addGroup({text:m.name});f=this.onlyExpandedNodes?m.expanded:true;if(f){this.extractGroups(g,m.children,b)}n=g.addSummary();n.addCell({value:(f?m.getTextTotal():m.value)});e=(m.expanded?m.records.expanded:m.records.collapsed);k=b.length;for(c=1;c<k;c++){n.addCell({value:this.getRecordValue(e,b[c])})}l.addGroup(g)}}}return l}});Ext.define("Ext.pivot.plugin.configurator.FieldSettings",{$configStrict:false,config:{cls:"",style:null,fixed:[],allowed:["leftAxis","topAxis","aggregate"],aggregators:["sum","avg","min","max","count","groupSumPercentage","groupCountPercentage","variance","varianceP","stdDev","stdDevP"],renderers:{},formatters:{}},isFieldSettings:true,constructor:function(a){this.initConfig(a||{});return this.callParent(arguments)},getDefaultEmptyArray:function(b){var a=this["_"+b];if(!a){a=[];this["set"+Ext.String.capitalize(b)](a)}return a},applyArrayValues:function(c,b,a){if(b==null||(b&&Ext.isArray(b))){return b}if(b){if(!a){a=this["get"+Ext.String.capitalize(c)]()}Ext.Array.splice(a,0,a.length,b)}return a},getFixed:function(){return this.getDefaultEmptyArray("fixed")},applyFixed:function(b,a){return this.applyArrayValues("fixed",b,a)},getAllowed:function(){return this.getDefaultEmptyArray("allowed")},applyAllowed:function(b,a){return this.applyArrayValues("allowed",b,a)},getAggregators:function(){return this.getDefaultEmptyArray("aggregators")},applyAggregators:function(b,a){return this.applyArrayValues("aggregators",b,a)},isFixed:function(b){var a;if(!b){return false}a=b.getFieldType();return Ext.Array.indexOf(this.getFixed(),a)>=0},isAllowed:function(b){var c=this.getFixed(),a;if(!b){return false}a=b.getFieldType();if(c.length){return Ext.Array.indexOf(c,a)>=0}return(a==="all")||(Ext.Array.indexOf(this.getAllowed(),a)>=0)}});Ext.define("Ext.pivot.plugin.configurator.Field",{extend:"Ext.pivot.dimension.Item",requires:["Ext.pivot.plugin.configurator.FieldSettings"],config:{settings:{}},isField:true,clone:function(){return new Ext.pivot.plugin.configurator.Field(Ext.applyIf({id:Ext.id()},this.getInitialConfig()))},serialize:function(){var a=this.callParent(arguments);return Ext.apply(a,{settings:a.settings.getConfig()})},applyAggregator:function(a,c){var d=this.getSettings(),b=d.getAggregators();if(b.length==0){Ext.Array.remove(d.getDrop(),"aggregate")}else{if(Ext.Array.indexOf(b,a)<0){a=b[0]}}return this.callParent(arguments)},getSettings:function(){var a=this.settings;if(!a){a=new Ext.pivot.plugin.configurator.FieldSettings({});this.setSettings(a)}return a},applySettings:function(a,b){if(a==null||(a&&a.isFieldSettings)){return a}if(a){if(!b){b=this.getSettings()}b.setConfig(a)}if(b){this.setAggregator(this.getAggregator())}return b},getFieldText:function(){var a=this.getHeader();if(this.isAggregate){a+=" ("+this.getAggText()+")"}return a},getAggText:function(a){var c=Ext.pivot.Aggregators,b=a||this.getAggregator();if(Ext.isFunction(b)){return c.customText}return c[b+"Text"]||c.customText}});Ext.define("Ext.pivot.update.Base",{extend:"Ext.mixin.Observable",alias:"pivotupdate.base",mixins:["Ext.mixin.Factoryable"],config:{leftKey:null,topKey:null,matrix:null,dataIndex:null,value:null},destroy:function(){this.setMatrix(null);this.callParent()},getResult:function(){var a=this.getMatrix();return a?a.results.get(this.getLeftKey(),this.getTopKey()):null},update:function(){var a=this;return new Ext.Promise(function(d,c){var b=a.getResult();if(b){if(a.fireEvent("beforeupdate",a)!==false){Ext.asap(a.onUpdate,a,[b,d,c])}else{c("Operation canceled!")}}else{c("No Result found!")}})},onUpdate:function(a,c,b){this.fireEvent("update",this);c(this)}});Ext.define("Ext.pivot.update.Increment",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.increment",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=parseFloat(this.getValue()),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,c[d].get(e)+f)}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Overwrite",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.overwrite",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=this.getValue(),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,f)}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Percentage",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.percentage",onUpdate:function(b,h,g){var e=this.getDataIndex(),f=parseFloat(this.getValue()),c=b.records,a,d;if(c){a=c.length;for(d=0;d<a;d++){c[d].set(e,Math.floor(c[d].get(e)*f/100))}}this.callParent([b,h,g])}});Ext.define("Ext.pivot.update.Uniform",{extend:"Ext.pivot.update.Base",alias:"pivotupdate.uniform",onUpdate:function(b,g,f){var e=this.getDataIndex(),c=b.records,a,d,h;if(c){a=c.length;if(a>0){h=(parseFloat(this.getValue())/a);for(d=0;d<a;d++){c[d].set(e,h)}}}this.callParent([b,g,f])}});Ext.define("Ext.pivot.feature.PivotEvents",{alternateClassName:["Mz.pivot.feature.PivotEvents"],extend:"Ext.grid.feature.Feature",alias:"feature.pivotevents",requires:["Ext.pivot.feature.PivotStore"],eventPrefix:"pivotcell",eventSelector:"."+Ext.baseCSSPrefix+"grid-cell",summaryDataCls:Ext.baseCSSPrefix+"pivot-summary-data",summaryDataSelector:"."+Ext.baseCSSPrefix+"pivot-summary-data",cellSelector:"."+Ext.baseCSSPrefix+"grid-cell",groupHeaderCls:Ext.baseCSSPrefix+"pivot-grid-group-header",groupHeaderCollapsibleCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsible",summaryRowCls:Ext.baseCSSPrefix+"pivot-grid-group-total",summaryRowSelector:"."+Ext.baseCSSPrefix+"pivot-grid-group-total",grandSummaryRowCls:Ext.baseCSSPrefix+"pivot-grid-grand-total",grandSummaryRowSelector:"."+Ext.baseCSSPrefix+"pivot-grid-grand-total",init:function(a){var b=this;b.initEventsListeners();b.summaryRowSelector="."+b.summaryRowCls;b.grandSummaryRowSelector="."+b.grandSummaryRowCls;b.callParent(arguments)},destroy:function(){var a=this;a.destroyEventsListeners();Ext.destroy(a.dataSource);a.view=a.grid=a.gridMaster=a.matrix=a.dataSource=null;a.callParent(arguments)},initEventsListeners:function(){var a=this;a.eventsViewListeners=a.view.on(Ext.apply({scope:a,destroyable:true},a.getViewListeners()||{}));a.gridListeners=a.grid.on(Ext.apply({scope:a,destroyable:true},a.getGridListeners()||{}))},getViewListeners:function(){var b=this,a={afterrender:b.onViewAfterRender};a[b.eventPrefix+"click"]=b.onCellEvent;a[b.eventPrefix+"dblclick"]=b.onCellEvent;a[b.eventPrefix+"contextmenu"]=b.onCellEvent;return a},getGridListeners:Ext.emptyFn,destroyEventsListeners:function(){Ext.destroyMembers(this,"eventsViewListeners","gridListeners");this.eventsViewListeners=this.gridListeners=null},onViewAfterRender:function(){var b=this,a;b.gridMaster=b.view.up("pivotgrid");b.matrix=b.gridMaster.getMatrix();a=b.lockingPartner;if(a&&a.dataSource){b.dataSource=a.dataSource}else{b.dataSource=new Ext.pivot.feature.PivotStore({store:b.grid.store,matrix:b.matrix,grid:b.gridMaster,clsGrandTotal:b.gridMaster.clsGrandTotal,clsGroupTotal:b.gridMaster.clsGroupTotal,summaryDataCls:b.summaryDataCls,rowCls:b.rowCls})}},getRowId:function(a){return this.view.id+"-record-"+a.internalId},getRecord:function(a){return this.view.getRecord(a)},onCellEvent:function(m,a,k){var l=this,r=Ext.fly(a).findParent(l.summaryDataSelector)||Ext.fly(a).findParent(l.summaryRowSelector),f=l.getRecord(r),c={grid:l.gridMaster,view:l.view,cellEl:a},q,j,g,b,o,d,i,n,p,h;if(!r||!f){return false}n=l.gridMaster.getMatrix();d=l.dataSource.storeInfo[f.internalId].leftKey;p=n.leftAxis.findTreeElement("key",d);p=p?p.node:null;r=Ext.fly(r);if(r.hasCls(l.grandSummaryRowCls)){g="pivottotal"}else{if(r.hasCls(l.summaryRowCls)){g="pivotgroup"}else{if(r.hasCls(l.summaryDataCls)){g="pivotitem"}}}q=Ext.getDom(a).getAttribute("data-columnid");b=l.getColumnHeaderById(q);Ext.apply(c,{columnId:q,column:b,leftKey:d,leftItem:p});if(Ext.fly(a).hasCls(l.groupHeaderCls)){}else{if(b){g+="cell";o=l.getTopAxisGroupByDataIndex(b.dataIndex);if(o){i=o.col;h=n.topAxis.findTreeElement("key",i);Ext.apply(c,{topKey:i,topItem:h?h.node:null,dimensionId:o.agg})}}}j=l.gridMaster.fireEvent(g+k.type,c,k);if(j!==false&&k.type=="click"&&Ext.fly(a).hasCls(l.groupHeaderCollapsibleCls)){if(p.expanded){p.collapse();l.view.focusNode(p.records.collapsed)}else{p.expand();l.view.focusNode(p.records.expanded)}}return false},getColumnHeaderById:function(c){var b=this.view.getGridColumns(),a;for(a=0;a<b.length;a++){if(b[a].id===c){return b[a]}}},getTopAxisGroupByDataIndex:function(c){var b=this.gridMaster.matrix.getColumns(),a;for(a=0;a<b.length;a++){if(b[a].name===c){return b[a]}}}});Ext.define("Ext.pivot.feature.PivotView",{extend:"Ext.pivot.feature.PivotEvents",alias:"feature.pivotview",groupCls:Ext.baseCSSPrefix+"pivot-grid-group",groupTitleCls:Ext.baseCSSPrefix+"pivot-grid-group-title",groupHeaderCollapsedCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsed",tableCls:Ext.baseCSSPrefix+"grid-table",rowCls:Ext.baseCSSPrefix+"grid-row",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",outlineCellHiddenCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-hidden",outlineCellGroupExpandedCls:Ext.baseCSSPrefix+"pivot-grid-outline-cell-previous-expanded",compactGroupHeaderCls:Ext.baseCSSPrefix+"pivot-grid-group-header-compact",compactLayoutPadding:25,outerTpl:["{%","var me = this.pivotViewFeature;","if (!(me.disabled)) {","me.setup();","}","this.nextTpl.applyOut(values, out, parent);","%}",{priority:200}],rowTpl:["{%","var me = this.pivotViewFeature;","me.setupRowData(values.record, values.rowIndex, values);","values.view.renderColumnSizer(values, out);","this.nextTpl.applyOut(values, out, parent);","me.resetRenderers();","%}",{priority:200,syncRowHeights:function(d,a){var b,c;d=Ext.fly(d,"syncDest");if(d){b=d.offsetHeight}a=Ext.fly(a,"sycSrc");if(a){c=a.offsetHeight}if(d&&a){if(b>c){Ext.fly(a).setHeight(b)}else{if(c>b){Ext.fly(d).setHeight(c)}}}}}],cellTpl:["{%",'values.hideCell = values.tdAttr == "hidden";\n',"%}",'<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" ',"{cellInnerAttr:attributes}>{value}</div>","</td>","</tpl>",{priority:0}],rtlCellTpl:["{%",'values.hideCell = values.tdAttr == "hidden";\n',"%}",'<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{[this.getAlign(values.align)]};<tpl if="style">{style}</tpl>" ',"{cellInnerAttr:attributes}>{value}</div>","</td>","</tpl>",{priority:200,rtlAlign:{right:"left",left:"right",center:"center"},getAlign:function(a){return this.rtlAlign[a]}}],init:function(b){var c=this,a=c.view;c.callParent(arguments);a.addTpl(Ext.XTemplate.getTpl(c,"outerTpl")).pivotViewFeature=c;a.addRowTpl(Ext.XTemplate.getTpl(c,"rowTpl")).pivotViewFeature=c;a.preserveScrollOnRefresh=true;if(a.bufferedRenderer){a.bufferedRenderer.variableRowHeight=true}else{b.variableRowHeight=a.variableRowHeight=true}},destroy:function(){this.columns=null;this.callParent(arguments)},setup:function(){this.columns=this.view.getGridColumns()},isRTL:function(){var b=this,a=b.gridMaster||b.grid;if(Ext.isFunction(a.isLocalRtl)){return a.isLocalRtl()}return false},getGridListeners:function(){var a=this;return Ext.apply(a.callParent(arguments)||{},{beforerender:a.onBeforeGridRendered})},onBeforeGridRendered:function(a){var b=this;if(b.isRTL()){b.view.addCellTpl(Ext.XTemplate.getTpl(b,"rtlCellTpl"))}else{b.view.addCellTpl(Ext.XTemplate.getTpl(b,"cellTpl"))}},vetoEvent:function(a,c,d,b){if(b.type!=="mouseover"&&b.type!=="mouseout"&&b.type!=="mouseenter"&&b.type!=="mouseleave"&&b.getTarget(this.eventSelector)){return false}},setupRowData:function(b,a,e){var d=this.dataSource.storeInfo[b.internalId],c=d?d.rendererParams:{};e.rowClasses.length=0;Ext.Array.insert(e.rowClasses,0,d?d.rowClasses:[]);this.setRenderers(c)},setRenderers:function(a){Ext.Array.each(this.columns,function(b){if(Ext.isDefined(a[b.dataIndex])){b.savedRenderer=b.renderer;b.renderer=this[a[b.dataIndex].fn](Ext.apply({renderer:b.savedRenderer},a[b.dataIndex]))}else{if(Ext.isDefined(a.topaxis)){b.savedRenderer=b.renderer;b.renderer=this[a.topaxis.fn](Ext.apply({renderer:b.savedRenderer},a[b.dataIndex]))}}},this)},resetRenderers:function(){Ext.Array.each(this.columns,function(a){if(Ext.isDefined(a.savedRenderer)){a.renderer=a.savedRenderer;delete a.savedRenderer}})},groupOutlineRenderer:function(b){var e=this,c=b.renderer,g=b.group,h=b.colspan,f=b.hidden,a=b.previousExpanded,d=b.subtotalRow;return function(n,k,j,o,m,l,i){if(Ext.isFunction(c)){n=c.apply(this,arguments)}n=e.encodeValue(n,g);if(h>0){k.tdAttr='colspan = "'+h+'"';k.tdCls=e.groupHeaderCls;if(!d){k.tdCls+=" "+e.groupHeaderCollapsibleCls;if(!g.expanded){k.tdCls+=" "+e.groupHeaderCollapsedCls}if(a){k.tdCls+=" "+e.outlineCellGroupExpandedCls}}return'<div class="'+e.groupTitleCls+" "+e.groupCls+'">'+n+"</div>"}if(f){k.tdAttr="hidden"}k.tdCls=e.outlineCellHiddenCls;return""}},recordOutlineRenderer:function(a){var c=this,b=a.renderer,e=a.group,d=a.hidden;return function(k,h,g,l,j,i,f){if(Ext.isFunction(b)){k=b.apply(this,arguments)}k=c.encodeValue(k,e);if(d){h.tdCls=c.outlineCellHiddenCls;return""}h.tdCls=c.groupHeaderCls+" "+c.groupTitleCls;return k}},groupCompactRenderer:function(b){var e=this,c=b.renderer,f=b.group,g=b.colspan,a=b.previousExpanded,d=b.subtotalRow;return function(m,j,i,n,l,k,h){if(Ext.isFunction(c)){m=c.apply(this,arguments)}m=e.encodeValue(m,f);if(f.level>0){j.style=(e.isRTL()?"margin-right: ":"margin-left: ")+(e.compactLayoutPadding*f.level)+"px;"}j.tdCls=e.groupHeaderCls+" "+e.compactGroupHeaderCls;if(!d){j.tdCls+=" "+e.groupHeaderCollapsibleCls;if(!f.expanded){j.tdCls+=" "+e.groupHeaderCollapsedCls}if(a){j.tdCls+=" "+e.outlineCellGroupExpandedCls}}return'<div class="'+e.groupTitleCls+" "+e.groupCls+'">'+m+"</div>"}},recordCompactRenderer:function(a){var c=this,b=a.renderer,d=a.group;return function(j,g,f,k,i,h,e){if(Ext.isFunction(b)){j=b.apply(this,arguments)}j=c.encodeValue(j,d);if(d.level>0){g.style=(c.isRTL()?"margin-right: ":"margin-left: ")+(c.compactLayoutPadding*d.level)+"px;"}g.tdCls=c.groupHeaderCls+" "+c.groupTitleCls+" "+c.compactGroupHeaderCls;return j}},topAxisNoRenderer:function(a){return function(g,d,c,h,f,e,b){return""}},topAxisRenderer:function(a){var c=this,b=a.renderer;return function(i,f,e,k,h,g,d){var j=(i===0&&c.gridMaster.showZeroAsBlank);if(Ext.isFunction(b)){i=b.apply(this,arguments)}return j?"":i}},encodeValue:function(a,b){return a}});Ext.define("Ext.pivot.Grid",{extend:"Ext.grid.Panel",alternateClassName:["Mz.pivot.Grid","Mz.pivot.Table"],xtype:["pivotgrid","mzpivotgrid"],requires:["Ext.pivot.matrix.Local","Ext.pivot.matrix.Remote","Ext.pivot.feature.PivotView","Ext.data.ArrayStore"],subGridXType:"gridpanel",isPivotGrid:true,matrixConfig:null,enableLoadMask:true,enableLocking:false,enableColumnSort:true,columnLines:true,viewLayoutType:"outline",rowSubTotalsPosition:"first",rowGrandTotalsPosition:"last",colSubTotalsPosition:"last",colGrandTotalsPosition:"last",textTotalTpl:"Total ({name})",textGrandTotalTpl:"Grand total",leftAxis:null,topAxis:null,aggregate:null,clsGroupTotal:Ext.baseCSSPrefix+"pivot-grid-group-total",clsGrandTotal:Ext.baseCSSPrefix+"pivot-grid-grand-total",startRowGroupsCollapsed:true,startColGroupsCollapsed:true,showZeroAsBlank:false,stateEvents:["pivotgroupexpand","pivotgroupcollapse","pivotdone"],groupHeaderCollapsedCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsed",groupHeaderCollapsibleCls:Ext.baseCSSPrefix+"pivot-grid-group-header-collapsible",groupCls:Ext.baseCSSPrefix+"pivot-grid-group",relayedMatrixEvents:["beforereconfigure","reconfigure","start","progress","done","modelbuilt","columnsbuilt","recordbuilt","buildtotals","storebuilt","groupexpand","groupcollapse","beforerequest","requestexception"],config:{matrix:null},initComponent:function(){var a=this;a.columns=[];a.preInitialize();a.callParent(arguments);a.postInitialize()},preInitialize:function(){var a=this;a.features=[{id:"group",ftype:"pivotview",summaryRowCls:a.clsGroupTotal,grandSummaryRowCls:a.clsGrandTotal}];a.addCls(Ext.baseCSSPrefix+"pivot-grid");if(a.store){a.originalStore=a.store}a.store=Ext.create("Ext.data.ArrayStore",{fields:[]});a.enableColumnMove=false},postInitialize:function(){var c=this,a={},b={headerclick:c.onHeaderClick,scope:c,destroyable:true};if(c.enableLocking){c.lockedHeaderCtListeners=c.getView().lockedView.getHeaderCt().on(b);c.headerCtListeners=c.getView().normalView.getHeaderCt().on(b)}else{c.headerCtListeners=c.getView().getHeaderCt().on(b)}Ext.apply(a,{leftAxis:c.leftAxis,topAxis:c.topAxis,aggregate:c.aggregate,showZeroAsBlank:c.showZeroAsBlank,textTotalTpl:c.textTotalTpl,textGrandTotalTpl:c.textGrandTotalTpl,viewLayoutType:c.viewLayoutType,rowSubTotalsPosition:c.rowSubTotalsPosition,rowGrandTotalsPosition:c.rowGrandTotalsPosition,colSubTotalsPosition:c.colSubTotalsPosition,colGrandTotalsPosition:c.colGrandTotalsPosition});Ext.applyIf(a,c.matrixConfig||{});Ext.applyIf(a,{type:"local"});c.setMatrix(a)},destroy:function(){var a=this;a.setMatrix(null);Ext.destroy(a.headerCtListeners,a.lockedHeaderCtListeners);Ext.destroy(a.originalStore);a.headerCtListeners=a.lockedHeaderCtListeners=null;a.originalStore=a.pivotColumns=null;a.callParent(arguments);Ext.destroy(a.store);a.store=null},applyMatrix:function(b,a){Ext.destroy(a);if(b==null){return b}if(b&&b.isPivotMatrix){b.cmp=this;return b}Ext.applyIf(b,{type:"local"});b.cmp=this;if(b.type=="local"&&this.originalStore){Ext.applyIf(b,{store:this.originalStore})}return Ext.Factory.pivotmatrix(b)},updateMatrix:function(b,a){var c=this;Ext.destroy(a,c.matrixListeners,c.matrixRelayedListeners);c.matrixRelayedListeners=c.matrixListeners=null;if(b){c.matrixListeners=c.matrix.on({cleardata:c.onMatrixClearData,start:c.onMatrixProcessStart,progress:c.onMatrixProcessProgress,done:c.onMatrixDataReady,groupexpand:c.onMatrixGroupExpandCollapse,groupcollapse:c.onMatrixGroupExpandCollapse,scope:c,destroyable:true});c.matrixRelayedListeners=c.relayEvents(c.matrix,c.relayedMatrixEvents,"pivot")}},afterRender:function(){this.reconfigurePivot();this.callParent(arguments)},refreshView:function(){var a=this;if(a.destroyed||a.destroying){return}a.store.fireEvent("pivotstoreremodel",a)},updateHeaderContainerColumns:function(j){var f=this,h=this.getView(),a=h.normalView?h.normalView.getHeaderCt():h.getHeaderCt(),d=0,g,e,b,k,c;if(j){c=f.getColumnForGroup(a.items,j);if(c.found){b=c.item.ownerCt;e=c.index;while(d<b.items.length){k=b.items.getAt(d);if(k.group==j){Ext.destroy(k)}else{d++}}g=Ext.clone(f.pivotColumns);f.preparePivotColumns(g);g=f.getVisiblePivotColumns(f.prepareVisiblePivotColumns(g),j);g=b.insert(e,g);if(g&&g.length){g[0].focus()}}}else{g=Ext.clone(f.pivotColumns);f.preparePivotColumns(g);f.reconfigure(undefined,g)}},getColumnForGroup:function(a,f){var e=a.length,b={found:false,index:-1,item:null},c,d;for(c=0;c<e;c++){d=a.getAt(c);if(d.group==f){b.found=true;b.index=c;b.item=d}else{if(d.items){b=this.getColumnForGroup(d.items,f)}}if(b.found){break}}return b},onMatrixClearData:function(){var a=this;a.store.removeAll(true);if(!a.expandedItemsState){a.lastColumnsState=null}a.sortedColumn=null},onMatrixProcessStart:function(){if(this.enableLoadMask){this.setLoading(true)}},onMatrixProcessProgress:function(a,b,e){var d=this,c=((b||0.1)*100)/(e||0.1),f;if(d.loadMask){if(d.loadMask.msgTextEl){f=d.loadMask.msgTextEl}else{if(d.loadMask.msgEl){f=d.loadMask.msgEl}}if(f){f.update(Ext.util.Format.number(c,"0")+"%")}}},onMatrixDataReady:function(){var b=this,c=b.matrix.getColumnHeaders(),a=false;if(b.enableLoadMask){b.setLoading(false)}if(b.expandedItemsState){b.matrix.leftAxis.items.each(function(d){if(Ext.Array.indexOf(b.expandedItemsState.rows,d.key)>=0){d.expanded=true;a=true}});b.matrix.topAxis.items.each(function(d){if(Ext.Array.indexOf(b.expandedItemsState.cols,d.key)>=0){d.expanded=true;a=true}});if(a){delete b.expandedItemsState}}else{b.doExpandCollapseTree(b.matrix.leftAxis.getTree(),!b.startRowGroupsCollapsed);b.doExpandCollapseTree(b.matrix.topAxis.getTree(),!b.startColGroupsCollapsed)}b.pivotColumns=Ext.clone(c);c=Ext.clone(b.pivotColumns);b.preparePivotColumns(c);b.restorePivotColumnsState(c);c=b.prepareVisiblePivotColumns(c);b.reconfigure(undefined,c);if(!Ext.isEmpty(b.sortedColumn)){b.matrix.leftAxis.sortTreeByField(b.sortedColumn.dataIndex,b.sortedColumn.direction)}b.store.fireEvent("pivotstoreremodel",b);if(!Ext.isEmpty(b.sortedColumn)){b.updateColumnSortState(b.sortedColumn.dataIndex,b.sortedColumn.direction)}},onMatrixGroupExpandCollapse:function(a,b,c){if(b=="col"){this.updateHeaderContainerColumns(c)}},getVisiblePivotColumns:function(d,f){var b=[],a=d.length,c,e;for(c=0;c<a;c++){e=d[c];if(e.group==f){b.push(e)}if(e.columns){b=Ext.Array.merge(b,this.getVisiblePivotColumns(e.columns,f))}}return b},prepareVisiblePivotColumns:function(d){var a=d.length,b=[],c,e,f;for(c=0;c<a;c++){e=d[c];if(!e.hidden){b.push(e)}if(e.columns){e.columns=this.prepareVisiblePivotColumns(e.columns)}}return b},preparePivotColumns:function(b){var f=this,e={menuDisabled:true,sortable:false,lockable:false},d=b.length,a,c;for(a=0;a<d;a++){c=b[a];c.cls=c.cls||"";Ext.apply(c,e);if(c.leftAxis){c.locked=f.enableLocking}if(c.subTotal){c.cls=c.tdCls=f.clsGroupTotal}if(c.grandTotal){c.cls=c.tdCls=f.clsGrandTotal}if(c.group&&c.xgrouped){if(c.group.expanded){if(!c.subTotal){c.cls+=(Ext.isEmpty(c.cls)?"":" ")+f.groupHeaderCollapsibleCls}}else{if(c.subTotal){c.cls+=(Ext.isEmpty(c.cls)?"":" ")+f.groupHeaderCollapsibleCls+" "+f.groupHeaderCollapsedCls}}if(c.subTotal){c.text=c.group.expanded?c.group.getTextTotal():Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',c.group.name)}else{if(c.group){c.text=Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',c.group.name)}}c.xexpandable=c.subTotal?!c.group.expanded:c.group.expanded;if((!c.group.expanded&&!c.subTotal)||(c.group.expanded&&c.subTotal&&this.getMatrix().colSubTotalsPosition=="none")){c.hidden=true}}if(Ext.isEmpty(c.columns)){if(c.dimension){c.renderer=c.dimension?c.dimension.getRenderer():false;c.formatter=c.dimension?c.dimension.getFormatter():false;c.scope=c.dimension?c.dimension.scope:null;c.align=c.dimension.align;if(c.dimension.flex>0){c.flex=c.flex||c.dimension.flex}else{c.width=c.width||c.dimension.width}}}else{c.focusable=true;c.enableFocusableContainer=true;f.preparePivotColumns(c.columns)}}},reconfigurePivot:function(a){var d=this,c=Ext.clone(d.getStateProperties()),b;c.push("startRowGroupsCollapsed","startColGroupsCollapsed","showZeroAsBlank");a=a||{};for(b=0;b<c.length;b++){if(!a.hasOwnProperty(c[b])){if(d[c[b]]){a[c[b]]=d[c[b]]}}else{d[c[b]]=a[c[b]]}}d.getMatrix().reconfigure(a)},getMatrix:function(){return this.matrix},doExpandCollapseTree:function(a,b){var c;for(c=0;c<a.length;c++){a[c].expanded=b;if(a[c].children){this.doExpandCollapseTree(a[c].children,b)}}},doExpandCollapse:function(d,c,f,a){var b=this.getMatrix(),e;if(!b){return}e=(d=="row"?b.leftAxis:b.topAxis)["findTreeElement"]("key",c);if(!e){return}e=e.node;f=Ext.isDefined(f)?f:!e.expanded;if(f){e.expand(a)}else{e.collapse(a)}},setHeaderGroupVisibility:function(e){var d,a,b,c;if(e.xgrouped){if(e.subTotal){e.setText(e.group.expanded?e.group.getTextTotal():Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',e.group.name));if(!e.group.expanded){e.addCls(this.groupHeaderCollapsibleCls);e.addCls(this.groupHeaderCollapsedCls)}else{e.removeCls(this.groupHeaderCollapsibleCls);e.removeCls(this.groupHeaderCollapsedCls)}}else{e.setText(Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',e.group.name));e.addCls(this.groupHeaderCollapsibleCls)}e.xexpandable=e.subTotal?!e.group.expanded:e.group.expanded;if((!e.group.expanded&&!e.subTotal)||(e.group.expanded&&e.subTotal&&this.getMatrix().colSubTotalsPosition=="none")){e.hide();return}}e.show();e.items.each(this.setHeaderGroupVisibility,this)},expandRow:function(b,a){this.doExpandCollapse("row",b,true,a)},collapseRow:function(b,a){this.doExpandCollapse("row",b,false,a)},expandCol:function(b,a){this.doExpandCollapse("col",b,true,a)},collapseCol:function(b,a){this.doExpandCollapse("col",b,false,a)},expandAll:function(){this.expandAllColumns();this.expandAllRows()},expandAllRows:function(){this.getMatrix().leftAxis.expandAll()},expandAllColumns:function(){this.getMatrix().topAxis.expandAll()},collapseAll:function(){this.collapseAllRows();this.collapseAllColumns()},collapseAllRows:function(){this.getMatrix().leftAxis.collapseAll()},collapseAllColumns:function(){this.getMatrix().topAxis.collapseAll()},setStore:function(a){this.reconfigurePivot({store:a})},getStore:function(){var b=this,a=b.getMatrix();return((a instanceof Ext.pivot.matrix.Local)?a.store:b.originalStore)||b.store},getPivotStore:function(){return this.store},getTopAxisItem:function(e){var f=this,a=f.getMatrix(),d=a.getColumns(),c,b;if(!e){return null}for(b=0;b<d.length;b++){if(d[b].name===e.dataIndex){c=d[b].col;break}}return Ext.isEmpty(c)?null:a.topAxis.items.getByKey(c)},getLeftAxisItem:function(b){var d=this,a=d.getView(),e,c;if(!b){return null}a=a.normalView||a;c=a.getFeature("group");if(!c){return null}e=c.dataSource.storeInfo[b.internalId];return e?d.getMatrix().leftAxis.items.getByKey(e.leftKey):null},onHeaderClick:function(b,c,f){var d=this,a=(c.sortState?(c.sortState=="ASC"?"DESC":"ASC"):"ASC");if(f){f.stopEvent()}if(!c.xexpandable){if(!d.enableColumnSort){return}if((c.leftAxis||c.topAxis)&&!Ext.isEmpty(c.dataIndex)){if(d.getMatrix().leftAxis.sortTreeByField(c.dataIndex,a)){d.refreshView();d.updateColumnSortState(c,a)}}return false}d.doExpandCollapse("col",c.key);return false},updateColumnSortState:function(b,a){if(Ext.isString(b)){b=this.down('[dataIndex="'+b+'"]')}if(!b){return}b.setSortState(new Ext.util.Sorter({direction:a,property:"dummy"}));b.sortState=a;this.sortedColumn={dataIndex:b.dataIndex,direction:a}},getStateProperties:function(){return["viewLayoutType","rowSubTotalsPosition","rowGrandTotalsPosition","colSubTotalsPosition","colGrandTotalsPosition","aggregate","leftAxis","topAxis","enableColumnSort","sortedColumn"]},applyState:function(d){var c=this,b=c.getStateProperties(),a;for(a=0;a<b.length;a++){if(d[b[a]]){c[b[a]]=d[b[a]]}}if(d.expandedItems){c.expandedItemsState=d.expandedItems}c.lastColumnsState=d.pivotcolumns||{};if(c.rendered){c.reconfigurePivot()}},getState:function(){var c=this,d={},b=c.getStateProperties(),a;for(a=0;a<b.length;a++){d[b[a]]=c[b[a]]}d.expandedItems={cols:[],rows:[]};c.matrix.leftAxis.items.each(function(e){if(e.expanded){d.expandedItems["rows"].push(e.key)}});c.matrix.topAxis.items.each(function(e){if(e.expanded){d.expandedItems["cols"].push(e.key)}});c.matrix.leftAxis.dimensions.each(function(f,e){d.leftAxis[e]["id"]=f.getId()});d.pivotcolumns=c.getPivotColumnsState();return d},getPivotColumnsState:function(){var b=this,a,c;if(!b.lastColumnsState){c=b.getDataIndexColumns(b.getMatrix().getColumnHeaders());b.lastColumnsState={};for(a=0;a<c.length;a++){if(c[a].dataIndex){b.lastColumnsState[c[a].dataIndex]={width:c[a].width,flex:c[a].flex||0}}}}c=b.getView().getGridColumns();for(a=0;a<c.length;a++){if(c[a].dataIndex){b.lastColumnsState[c[a].dataIndex]={width:c[a].rendered?c[a].getWidth():c[a].width,flex:c[a].flex||0}}}return b.lastColumnsState},getDataIndexColumns:function(b){var c=[],a;for(a=0;a<b.length;a++){if(b[a].dataIndex){c.push(b[a].dataIndex)}else{if(Ext.isArray(b[a].columns)){c=Ext.Array.merge(c,this.getDataIndexColumns(b[a].columns))}}}return c},restorePivotColumnsState:function(a){this.parsePivotColumnsState(this.getPivotColumnsState(),a)},parsePivotColumnsState:function(d,b){var c,a;if(!b){return}for(a=0;a<b.length;a++){c=d[b[a].dataIndex];if(c){if(c.flex){b[a].flex=c.flex}else{if(c.width){b[a].width=c.width}}}this.parsePivotColumnsState(d,b[a].columns)}}});Ext.define("Ext.pivot.plugin.CellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.pivotcellediting",requires:["Ext.pivot.update.Increment","Ext.pivot.update.Overwrite","Ext.pivot.update.Percentage","Ext.pivot.update.Uniform"],defaultUpdater:"uniform",defaultValue:null,updater:null,init:function(a){var b=this;b.callParent([a]);b.pivot=a.isPivotGrid?a:a.up("pivotgrid");b.mon(b,{beforeedit:b.onBeforeEdit,priority:1000,scope:b});if(!b.pivot.isCellEditingAttached){b.mon(b.pivot,{pivotcolumnsbuilt:b.addColumnEditors,scope:b});b.pivot.isCellEditingAttached=true}b.updater=Ext.Factory.pivotupdate({type:b.defaultUpdater});b.pivot.relayEvents(b.updater,["beforeupdate","update"],"pivot")},destroy:function(){var a=this;a.pivot.isCellEditingAttached=false;a.pivot=a.updater=Ext.destroy(a.updater);a.callParent()},addColumnEditors:function(b,e){var a=e.length,c,d;for(d=0;d<a;d++){c=e[d];if(c.dimension&&c.dimension.editor){c.editor=Ext.clone(c.dimension.editor)}if(c.columns){this.addColumnEditors(b,c.columns)}}},isCellEditable:function(a,b){return this.callParent([a,b])&&Boolean(this.getPivotResult(this.getEditingContext(a,b)))},onBeforeEdit:function(b,a){if(!Ext.isEmpty(this.defaultValue)){a.value=this.defaultValue}},getPivotResult:function(c){var a=this.pivot.getMatrix(),d=this.pivot.getLeftAxisItem(c.record),b=this.pivot.getTopAxisItem(c.column);return a.results.get(d?d.key:a.grandTotalKey,b?b.key:a.grandTotalKey)},updateRecords:function(d,f){var a=this.pivot,b=a.getMatrix(),e=a.getLeftAxisItem(d.record),c=a.getTopAxisItem(d.column);this.updater.setConfig({leftKey:e?e.key:b.grandTotalKey,topKey:c?c.key:b.grandTotalKey,matrix:b,dataIndex:d.column.dimension.dataIndex,value:f});this.updater.update()},onEditComplete:function(e,h,d){var g=this,f=e.context,c,b,a;c=f.view;b=f.record;f.value=h;if(!g.validateEdit(f)){g.editing=false;return}g.updateRecords(f,h);f.rowIdx=c.indexOf(b);g.fireEvent("edit",g,f);if(g.context===f){g.setActiveEditor(null);g.setActiveColumn(null);g.setActiveRecord(null);g.editing=false}}});Ext.define("Ext.pivot.plugin.configurator.window.Window",{extend:"Ext.window.Window",requires:["Ext.form.Panel","Ext.form.FieldContainer","Ext.form.field.Text","Ext.form.field.Hidden","Ext.form.field.ComboBox","Ext.layout.container.HBox"],modal:true,closeAction:"destroy",initComponent:function(){var a=this;Ext.apply(a,{layout:"fit",items:[a.getSettingsForm()],buttons:[{text:Ext.Msg.buttonText.ok,handler:a.applySettings,scope:a},{text:Ext.Msg.buttonText.cancel,handler:a.cancelSettings,scope:a}]});return a.callParent(arguments)},beforeApplySettings:Ext.emptyFn,getSettingsForm:function(){return{xtype:"form",bodyPadding:5,items:[]}},loadSettings:function(a){var b=this.down("form");if(b){b.getForm().setValues(a||{})}},applySettings:function(){var b=this.down("form"),a;if(b&&b.getForm().isValid()){a=b.getForm().getValues();if(this.beforeApplySettings(a)!==false){if(this.fireEvent("applysettings",this,a)!==false){this.cancelSettings()}}}},cancelSettings:function(){this.close()}});Ext.define("Ext.pivot.plugin.configurator.window.FilterLabel",{extend:"Ext.pivot.plugin.configurator.window.Window",titleText:"Label filter ({0})",fieldText:"Show items for which the label",caseSensitiveText:"Case sensitive",initComponent:function(){var a=this;a.callParent(arguments);a.setTitle(Ext.String.format(a.titleText,a.title))},getSettingsForm:function(){var b=this,a=b.filterFields||[];a.push({xtype:"combo",editable:false,queryMode:"local",valueField:"value",store:b.store,name:"operator",listeners:{change:function(f,e){var c=this,d=c.isOperatorBetween(e);c.down("#fValue").setVisible(!d);c.down("#fValue").allowBlank=d;c.down("#fFrom").setVisible(d);c.down("#fFrom").allowBlank=!d;c.down("#fTo").setVisible(d);c.down("#fTo").allowBlank=!d},scope:b}},{itemId:"fValue",xtype:"textfield",margin:"0 0 0 5",name:"value"},{itemId:"fFrom",xtype:"textfield",margin:"0 0 0 5",name:"from"},{itemId:"fTo",xtype:"textfield",margin:"0 0 0 5",name:"to"});return Ext.apply(b.callParent(arguments),{items:[{xtype:"hidden",name:"type"},{xtype:"fieldcontainer",labelSeparator:"",fieldLabel:b.fieldText,labelAlign:"top",layout:{type:"hbox",align:"stretch"},defaults:{allowBlank:false,flex:1},items:a},{xtype:"checkbox",boxLabel:b.caseSensitiveText,name:"caseSensitive"}]})},beforeApplySettings:function(a){if(this.isOperatorBetween(a.operator)){a.value=[a.from,a.to]}delete (a.from);delete (a.to);a.caseSensitive=(a.caseSensitive==="on");a.topSort=(a.topSort==="on")},isOperatorBetween:function(a){return Ext.Array.indexOf(["between","not between"],a)>=0}});Ext.define("Ext.pivot.plugin.configurator.window.FilterValue",{extend:"Ext.pivot.plugin.configurator.window.FilterLabel",titleText:"Value filter ({0})",fieldText:"Show items for which",initComponent:function(){var a=this;a.filterFields=[{xtype:"combo",editable:false,queryMode:"local",valueField:"value",store:a.storeAgg,name:"dimensionId"}];a.callParent(arguments)}});Ext.define("Ext.pivot.plugin.configurator.window.FilterTop",{extend:"Ext.pivot.plugin.configurator.window.Window",titleText:"Top 10 filter ({0})",fieldText:"Show",sortResultsText:"Sort results",initComponent:function(){var a=this;a.callParent(arguments);a.setTitle(Ext.String.format(a.titleText,a.title))},getSettingsForm:function(){var b=this,a=[];a.push({xtype:"combo",editable:false,queryMode:"local",valueField:"value",store:b.storeTopOrder,name:"topOrder"},{xtype:"textfield",margin:"0 0 0 5",name:"value"},{xtype:"combo",margin:"0 0 0 5",editable:false,queryMode:"local",valueField:"value",store:b.storeTopType,name:"topType"},{xtype:"combo",margin:"0 0 0 5",editable:false,queryMode:"local",valueField:"value",store:b.storeAgg,name:"dimensionId"});return Ext.apply(b.callParent(arguments),{defaults:{allowBlank:false},items:[{xtype:"hidden",name:"type"},{xtype:"hidden",name:"operator"},{xtype:"fieldcontainer",labelSeparator:"",fieldLabel:b.fieldText,labelAlign:"top",layout:{type:"hbox",align:"stretch"},defaults:{flex:1,allowBlank:false},items:a},{xtype:"checkbox",boxLabel:b.sortResultsText,name:"topSort"}]})}});Ext.define("Ext.pivot.plugin.configurator.window.FieldSettings",{extend:"Ext.pivot.plugin.configurator.window.Window",requires:["Ext.form.field.Display"],title:"Field settings",formatText:"Format as",summarizeByText:"Summarize by",customNameText:"Custom name",sourceNameText:"Source name",alignText:"Align",alignLeftText:"Left",alignCenterText:"Center",alignRightText:"Right",field:null,getSettingsForm:function(){var j=this,h=[],f=[],c=j.field.getSettings(),d=c.getFormatters(),b=c.getRenderers(),k=c.getAggregators(),a,e,g;a=k.length;for(e=0;e<a;e++){f.push([j.field.getAggText(k[e]),k[e]])}g=Ext.Object.getAllKeys(d||{});a=g.length;for(e=0;e<a;e++){h.push([g[e],d[g[e]],1])}g=Ext.Object.getAllKeys(b||{});a=g.length;for(e=0;e<a;e++){h.push([g[e],b[g[e]],2])}return Ext.apply(j.callParent(arguments),{items:[{xtype:"displayfield",fieldLabel:j.sourceNameText,name:"dataIndex"},{xtype:"textfield",fieldLabel:j.customNameText,name:"header"},{xtype:"combo",fieldLabel:j.alignText,editable:false,queryMode:"local",valueField:"value",name:"align",store:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:[[j.alignLeftText,"left"],[j.alignCenterText,"center"],[j.alignRightText,"right"]]})},{xtype:"combo",fieldLabel:j.formatText,editable:false,queryMode:"local",valueField:"value",name:"formatter",store:Ext.create("Ext.data.ArrayStore",{fields:["text","value","type"],data:h})},{xtype:"combo",fieldLabel:j.summarizeByText,editable:false,queryMode:"local",valueField:"value",name:"aggregator",store:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:f})}]})},beforeApplySettings:function(c){var a=this.down("[name=formatter]"),b,d;if(a){b=a.getStore();d=b.findRecord("value",c.formatter,0,false,true,true);if(d){if(d.get("type")==1){c.formatter=d.get("value");c.renderer=null}else{c.renderer=d.get("value");c.formatter=null}}}},loadSettings:function(a){if(!a.formatter){a.formatter=a.renderer}this.callParent(arguments)}});Ext.define("Ext.pivot.plugin.configurator.Column",{extend:"Ext.Component",requires:["Ext.menu.Menu","Ext.menu.CheckItem","Ext.menu.Item","Ext.menu.Separator","Ext.pivot.plugin.configurator.Field","Ext.pivot.plugin.configurator.window.FilterLabel","Ext.pivot.plugin.configurator.window.FilterValue","Ext.pivot.plugin.configurator.window.FilterTop","Ext.pivot.plugin.configurator.window.FieldSettings"],alias:"widget.pivotconfigfield",childEls:["textCol","filterCol","sortCol"],tabIndex:0,focusable:true,isConfiguratorField:true,renderTpl:'<div id="{id}-configCol" role="button" class="'+Ext.baseCSSPrefix+'pivot-grid-config-column-inner" ><span id="{id}-customCol" role="presentation" class="'+Ext.baseCSSPrefix+"pivot-grid-config-column-btn-customize "+Ext.baseCSSPrefix+"border-box "+Ext.baseCSSPrefix+"pivot-grid-config-column-btn "+Ext.baseCSSPrefix+'pivot-grid-config-column-btn-image"></span><span id="{id}-sortCol" role="presentation" data-ref="sortCol" class="'+Ext.baseCSSPrefix+"border-box "+Ext.baseCSSPrefix+'pivot-grid-config-column-btn"></span><span id="{id}-filterCol" role="presentation" data-ref="filterCol" class="'+Ext.baseCSSPrefix+"border-box "+Ext.baseCSSPrefix+'pivot-grid-config-column-btn"></span><span id="{id}-textCol" role="presentation" data-ref="textCol" data-qtip="{header}" class="'+Ext.baseCSSPrefix+"pivot-grid-config-column-text "+Ext.baseCSSPrefix+"column-header-text "+Ext.baseCSSPrefix+'border-box">{header}</span></div>',header:"&#160;",minWidth:80,sortAscText:"Sort A to Z",sortDescText:"Sort Z to A",sortClearText:"Disable sorting",clearFilterText:'Clear filter from "{0}"',labelFiltersText:"Label filters",valueFiltersText:"Value filters",equalsText:"Equals...",doesNotEqualText:"Does not equal...",beginsWithText:"Begins with...",doesNotBeginWithText:"Does not begin with...",endsWithText:"Ends with...",doesNotEndWithText:"Does not end with...",containsText:"Contains...",doesNotContainText:"Does not contain...",greaterThanText:"Greater than...",greaterThanOrEqualToText:"Greater than or equal to...",lessThanText:"Less than...",lessThanOrEqualToText:"Less than or equal to...",betweenText:"Between...",notBetweenText:"Not between...",top10Text:"Top 10...",equalsLText:"equals",doesNotEqualLText:"does not equal",beginsWithLText:"begins with",doesNotBeginWithLText:"does not begin with",endsWithLText:"ends with",doesNotEndWithLText:"does not end with",containsLText:"contains",doesNotContainLText:"does not contain",greaterThanLText:"is greater than",greaterThanOrEqualToLText:"is greater than or equal to",lessThanLText:"is less than",lessThanOrEqualToLText:"is less than or equal to",betweenLText:"is between",notBetweenLText:"is not between",top10LText:"Top 10...",topOrderTopText:"Top",topOrderBottomText:"Bottom",topTypeItemsText:"Items",topTypePercentText:"Percent",topTypeSumText:"Sum",baseCls:Ext.baseCSSPrefix+"pivot-grid-config-column",btnIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-image",setFilterIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-filter-set",clearFilterIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-filter-clear",ascSortIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-sort-asc",descSortIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-sort-desc",clearSortIconCls:Ext.baseCSSPrefix+"pivot-grid-config-column-btn-sort-clear",overCls:Ext.baseCSSPrefix+"pivot-grid-config-column-over",cls:Ext.baseCSSPrefix+"unselectable",config:{fieldType:"all",field:null},destroy:function(){Ext.destroy(this.getField());this.setField(null);this.callParent(arguments)},initRenderData:function(){var a=this.getField();return Ext.apply(this.callParent(arguments),{header:this.getFieldType()=="aggregate"?a.getFieldText():a.getHeader(),dimension:a})},afterRender:function(){var b=this,c=b.getField(),a=c.getSettings();b.callParent();if(Ext.Array.indexOf(["leftAxis","topAxis"],b.getFieldType())>=0){if(!Ext.isDefined(c.sortable)||c.sortable){b.addSortCls(c.direction)}if(c.filter){b.addFilterCls()}}b.textCol.setStyle(a.getStyle());b.addCls(a.getCls())},getMenuConfig:function(){var a=this.getFieldType();if(a=="leftAxis"||a=="topAxis"){return this.getColMenuConfig()}},addSortCls:function(b){var a=this;if(!a.sortCol){return}if(b==="ASC"||!b){a.sortCol.addCls(a.ascSortIconCls);a.sortCol.removeCls(a.descSortIconCls)}else{a.sortCol.addCls(a.descSortIconCls);a.sortCol.removeCls(a.ascSortIconCls)}a.sortCol.addCls(a.btnIconCls)},removeSortCls:function(b){var a=this;if(!a.sortCol){return}if(b==="ASC"){a.sortCol.removeCls(a.ascSortIconCls)}else{a.sortCol.removeCls(a.descSortIconCls)}a.sortCol.removeCls(a.btnIconCls)},addFilterCls:function(){var a=this;if(a.filterCol&&!a.filterCol.hasCls(a.setFilterIconCls)){a.filterCol.addCls(a.setFilterIconCls);a.filterCol.addCls(a.btnIconCls)}},removeFilterCls:function(){var a=this;if(a.filterCol){a.filterCol.removeCls(a.setFilterIconCls);a.filterCol.removeCls(a.btnIconCls)}},getColMenuConfig:function(){var e=this,b=[],g,f,a,c,d=e.getField().filter;b.push({text:e.sortAscText,direction:"ASC",iconCls:e.ascSortIconCls,handler:e.sortMe},{text:e.sortDescText,direction:"DESC",iconCls:e.descSortIconCls,handler:e.sortMe},{text:e.sortClearText,direction:"",disabled:e.getField().sortable===false,iconCls:e.clearSortIconCls,handler:e.sortMe},{xtype:"menuseparator"});a=[{text:e.equalsText,operator:"="},{text:e.doesNotEqualText,operator:"!="},{xtype:"menuseparator"},{text:e.greaterThanText,operator:">"},{text:e.greaterThanOrEqualToText,operator:">="},{text:e.lessThanText,operator:"<"},{text:e.lessThanOrEqualToText,operator:"<="},{xtype:"menuseparator"},{text:e.betweenText,operator:"between"},{text:e.notBetweenText,operator:"not between"}];g=Ext.clone(a);Ext.Array.insert(g,3,[{text:e.beginsWithText,operator:"begins"},{text:e.doesNotBeginWithText,operator:"not begins"},{text:e.endsWithText,operator:"ends"},{text:e.doesNotEndWithText,operator:"not ends"},{xtype:"menuseparator"},{text:e.containsText,operator:"contains"},{text:e.doesNotContainText,operator:"not contains"},{xtype:"menuseparator"}]);for(c=0;c<g.length;c++){g[c]["checked"]=(d&&d.type=="label"&&d.operator==g[c].operator)}f=Ext.clone(a);f.push({xtype:"menuseparator"},{text:e.top10Text,operator:"top10"});for(c=0;c<f.length;c++){f[c]["checked"]=(d&&d.type=="value"&&d.operator==f[c].operator)}b.push({text:Ext.String.format(e.clearFilterText,e.header),iconCls:e.clearFilterIconCls,disabled:!d,handler:e.onRemoveFilter},{text:e.labelFiltersText,menu:{defaults:{handler:e.onShowFilter,scope:e,xtype:"menucheckitem",group:"filterlabel",type:"label"},items:g}},{text:e.valueFiltersText,menu:{defaults:{handler:e.onShowFilter,scope:e,xtype:"menucheckitem",group:"filtervalue",type:"value"},items:f}});return{defaults:{scope:e},items:b}},sortMe:function(a){var b=this,c=b.getField();if(Ext.isEmpty(a.direction)){c.setSortable(false);b.removeSortCls(c.getDirection())}else{c.setSortable(true);b.addSortCls(a.direction);c.setDirection(a.direction)}b.applyChanges()},onShowFilter:function(c){var i=this,a=i.up("pivotconfigpanel"),e=[],d={},b=i.getField().getFilter(),j={type:c.type,operator:c.operator,value:(b?b.value:""),from:(b?(Ext.isArray(b.value)?b.value[0]:""):""),to:(b?(Ext.isArray(b.value)?b.value[1]:""):""),caseSensitive:(b?b.caseSensitive:false),topSort:(b?b.topSort:false)},h,g,f;a.getAggregateContainer().items.each(function(k){var l=k.getField();e.push([l.getHeader(),l.getId()])});if(c.type=="label"||(c.type=="value"&&c.operator!="top10")){f=[[i.equalsLText,"="],[i.doesNotEqualLText,"!="],[i.greaterThanLText,">"],[i.greaterThanOrEqualToLText,">="],[i.lessThanLText,"<"],[i.lessThanOrEqualToLText,"<="],[i.betweenLText,"between"],[i.notBetweenLText,"not between"]];if(c.type=="label"){Ext.Array.insert(f,3,[[i.beginsWithLText,"begins"],[i.doesNotBeginWithLText,"not begins"],[i.endsWithLText,"ends"],[i.doesNotEndWithLText,"not ends"],[i.containsLText,"contains"],[i.doesNotContainLText,"not contains"]]);g="Ext.pivot.plugin.configurator.window.FilterLabel"}else{g="Ext.pivot.plugin.configurator.window.FilterValue";Ext.apply(j,{dimensionId:(b?b.dimensionId:"")});d.storeAgg=Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:e})}d.store=Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:f})}else{g="Ext.pivot.plugin.configurator.window.FilterTop";f=[];Ext.apply(d,{storeTopOrder:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:[[i.topOrderTopText,"top"],[i.topOrderBottomText,"bottom"]]}),storeTopType:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:[[i.topTypeItemsText,"items"],[i.topTypePercentText,"percent"],[i.topTypeSumText,"sum"]]}),storeAgg:Ext.create("Ext.data.ArrayStore",{fields:["text","value"],data:e})});Ext.apply(j,{operator:"top10",dimensionId:(b?b.dimensionId:""),topType:(b?b.topType:"items"),topOrder:(b?b.topOrder:"top")})}h=Ext.create(g,Ext.apply(d||{},{title:i.header,listeners:{applysettings:Ext.bind(i.onApplyFilterSettings,i)}}));h.loadSettings(j);h.show()},onApplyFilterSettings:function(c,a){var b=this;c.close();b.addFilterCls();b.getField().setFilter(a);b.applyChanges()},onRemoveFilter:function(){var a=this;a.removeFilterCls();a.getField().setFilter(null);a.applyChanges()},applyChanges:function(){if(this.ownerCt){this.ownerCt.applyChanges(this)}}});Ext.define("Ext.pivot.plugin.configurator.Container",{extend:"Ext.panel.Panel",requires:["Ext.pivot.plugin.configurator.Column"],mixins:["Ext.util.FocusableContainer"],alias:"widget.pivotconfigcontainer",childEls:["innerCt","targetEl"],handleSorting:false,handleFiltering:false,position:"top",border:false,enableFocusableContainer:true,isConfiguratorContainer:true,cls:Ext.baseCSSPrefix+"pivot-grid-config-container-body",dockedTopRightCls:Ext.baseCSSPrefix+"pivot-grid-config-container-body-tr",dockedBottomLeftCls:Ext.baseCSSPrefix+"pivot-grid-config-container-body-bl",hintTextCls:Ext.baseCSSPrefix+"pivot-grid-config-container-hint",config:{fieldType:"all",dragDropText:"&nbsp;"},initComponent:function(){var a=this;if(a.position=="top"||a.position=="bottom"){Ext.apply(a,{style:"overflow:hidden",layout:"column",height:"auto"})}else{Ext.apply(a,{layout:{type:"vbox",align:"stretch"}})}if(a.position=="top"||a.position=="right"){a.cls+=" "+a.dockedTopRightCls}else{a.cls+=" "+a.dockedBottomLeftCls}a.callParent(arguments)},destroy:function(){var a=this;Ext.destroyMembers(a,"relayers","targetEl");a.relayers=a.targetEl=null;a.callParent()},applyChanges:function(b,a){if(this.getFieldType()!="all"||a===true){this.fireEvent("configchange",b||this)}},addField:function(b,f,c){var d=this,a={xtype:"pivotconfigfield"},e;Ext.apply(a,{field:b,header:b.getHeader()});if(f!=-1){e=d.insert(f,a)}else{e=d.add(a)}if(c===true){d.applyChanges(e)}},onAdd:function(a){this.hideGroupByText();a.setFieldType(this.getFieldType());this.callParent(arguments)},onRemove:function(){if(this.items.getCount()==0){this.showGroupByText()}},moveField:function(d,c,a){var b=this;if(Ext.isString(d)){d=b.items.getByKey(d)}if(Ext.isString(c)){c=b.items.getByKey(c)}if(d!=c){b["move"+Ext.String.capitalize(a)](d,c);b.applyChanges(d)}},removeField:function(a){this.remove(a);this.applyChanges()},showGroupByText:function(){var a=this;if(a.targetEl){a.targetEl.setHtml('<div class="'+a.hintTextCls+'">'+a.getDragDropText()+"</div>")}else{a.targetEl=a.innerCt.createChild()}},hideGroupByText:function(){if(this.targetEl){this.targetEl.setHtml("")}}});Ext.define("Ext.pivot.plugin.configurator.DragZone",{extend:"Ext.dd.DragZone",configColumnSelector:"."+Ext.baseCSSPrefix+"pivot-grid-config-column",configColumnInnerSelector:"."+Ext.baseCSSPrefix+"pivot-grid-config-column-inner",maxProxyWidth:120,dragging:false,constructor:function(a){this.panel=a;this.ddGroup=this.getDDGroup();this.callParent([a.el])},getDDGroup:function(){return"configurator-"+this.panel.id},getDragData:function(c){var f,a,d,b;if(c.getTarget(this.configColumnInnerSelector)){f=c.getTarget(this.configColumnSelector);if(f){a=Ext.getCmp(f.id);a.focus();b=a.getField();if(!this.panel.dragging&&b&&!b.getSettings().isFixed(a.ownerCt)){d=document.createElement("div");d.innerHTML=a.header;return{ddel:d,header:a}}}}return false},onBeforeDrag:function(){return !(this.panel.dragging||this.disabled)},onInitDrag:function(){this.panel.dragging=true;this.callParent(arguments)},onDragDrop:function(){this.panel.dragging=false;this.callParent(arguments)},afterRepair:function(){this.callParent();this.panel.dragging=false},getRepairXY:function(){return this.dragData.header.el.getXY()},disable:function(){this.disabled=true},enable:function(){this.disabled=false}});Ext.define("Ext.pivot.plugin.configurator.DropZone",{extend:"Ext.dd.DropZone",proxyOffsets:[-4,-9],configPanelCls:Ext.baseCSSPrefix+"pivot-grid-config-container-body",configColumnCls:Ext.baseCSSPrefix+"pivot-grid-config-column",constructor:function(a){this.panel=a;this.ddGroup=this.getDDGroup();this.callParent([a.id])},disable:function(){this.disabled=true},enable:function(){this.disabled=false},getDDGroup:function(){return"configurator-"+this.panel.id},getTargetFromEvent:function(a){return a.getTarget("."+this.configColumnCls)||a.getTarget("."+this.configPanelCls)},getTopIndicator:function(){if(!this.topIndicator){this.self.prototype.topIndicator=Ext.DomHelper.append(Ext.getBody(),{cls:"col-move-top "+Ext.baseCSSPrefix+"col-move-top",html:"&#160;"},true);this.self.prototype.indicatorXOffset=Math.floor((this.topIndicator.dom.offsetWidth+1)/2)}return this.topIndicator},getBottomIndicator:function(){if(!this.bottomIndicator){this.self.prototype.bottomIndicator=Ext.DomHelper.append(Ext.getBody(),{cls:"col-move-bottom "+Ext.baseCSSPrefix+"col-move-bottom",html:"&#160;"},true)}return this.bottomIndicator},getLocation:function(c,b,g){var a=g.getXY()[0],f=Ext.getCmp(b.id),d,h;if(f instanceof Ext.pivot.plugin.configurator.Container){if(f.items.getCount()>0){d=Ext.fly(f.items.last().el).getRegion()}else{d=new Ext.util.Region(0,1000000,0,0)}}else{d=Ext.fly(b).getRegion()}if((d.right-a)<=(d.right-d.left)/2){h="after"}else{h="before"}return c.dropLocation={pos:h,header:Ext.getCmp(b.id),node:b}},positionIndicator:function(z,o,u){var y=this,p=z.header,f=y.getLocation(z,o,u),j=f.header,d=f.pos,c,t,l,r,s,a,b,k,m,x,w,n,h,q,g;if(j===y.lastTargetHeader&&d===y.lastDropPos){return}c=p.nextSibling("pivotconfigfield:not([hidden])");t=p.previousSibling("pivotconfigfield:not([hidden])");y.lastTargetHeader=j;y.lastDropPos=d;if((p!==j)&&((d==="before"&&c!==j)||(d==="after"&&t!==j))&&!j.isDescendantOf(p)){n=Ext.dd.DragDropManager.getRelated(y);h=n.length;q=0;for(;q<h;q++){g=n[q];if(g!==y&&g.invalidateDrop){g.invalidateDrop()}}y.valid=true;l=y.getTopIndicator();r=y.getBottomIndicator();if(d==="before"){s="bc-tl";a="tc-bl"}else{s="bc-tr";a="tc-br"}if(j.isConfiguratorContainer&&j.items.getCount()>0){b=l.getAlignToXY(j.items.last().el,s);k=r.getAlignToXY(j.items.last().el,a)}else{b=l.getAlignToXY(j.el,s);k=r.getAlignToXY(j.el,a)}m=y.panel.el;x=m.getX()-y.indicatorXOffset;w=m.getX()+m.getWidth();b[0]=Ext.Number.constrain(b[0],x,w);k[0]=Ext.Number.constrain(k[0],x,w);l.setXY(b);r.setXY(k);l.show();r.show()}else{y.invalidateDrop()}},invalidateDrop:function(){this.valid=false;this.hideIndicators()},onNodeOver:function(d,a,h,f){var c=this,b=true,i=f.header,g=c.getLocation(f,d,h);if(f.header.el.dom===d){b=false}if(g&&g.header&&i){b=b&&i.getField().getSettings().isAllowed(g.header)}if(b){c.positionIndicator(f,d,h)}else{c.valid=false}return c.valid?c.dropAllowed:c.dropNotAllowed},hideIndicators:function(){var a=this;a.getTopIndicator().hide();a.getBottomIndicator().hide();a.lastTargetHeader=a.lastDropPos=null},onNodeOut:function(){this.hideIndicators()},onNodeDrop:function(d,a,g,f){var c=this,h=f.header,b=f.dropLocation;if(c.valid&&b){c.panel.dragDropField(b.header,h,b.pos)}}});Ext.define("Ext.pivot.plugin.configurator.Panel",{extend:"Ext.panel.Panel",requires:["Ext.pivot.plugin.configurator.Container","Ext.pivot.plugin.configurator.DragZone","Ext.pivot.plugin.configurator.DropZone","Ext.layout.container.HBox","Ext.layout.container.VBox"],mixins:["Ext.util.FocusableContainer"],alias:"widget.pivotconfigpanel",weight:50,defaultMinHeight:70,defaultMinWidth:250,dock:"right",header:false,title:"Configurator",collapsible:true,collapseMode:"placeholder",panelAllFieldsText:"Drop Unused Fields Here",panelAllFieldsTitle:"All fields",panelTopFieldsText:"Drop Column Fields Here",panelTopFieldsTitle:"Column labels",panelLeftFieldsText:"Drop Row Fields Here",panelLeftFieldsTitle:"Row labels",panelAggFieldsText:"Drop Agg Fields Here",panelAggFieldsTitle:"Values",addToText:"Add to {0}",moveToText:"Move to {0}",removeFieldText:"Remove field",moveUpText:"Move up",moveDownText:"Move down",moveBeginText:"Move to beginning",moveEndText:"Move to end",fieldSettingsText:"Field settings",headerContainerCls:Ext.baseCSSPrefix+"pivot-grid-config-container-header",keyEventRe:/^key/,config:{fields:[],refreshDelay:300,pivot:null},initComponent:function(){var b=this,a={configchange:b.applyChanges,scope:b};Ext.apply(b,Ext.Array.indexOf(["top","bottom"],b.dock)>=0?b.getHorizontalConfig():b.getVerticalConfig());b.callParent(arguments);b.getAllFieldsContainer().on(a);b.getLeftAxisContainer().on(a);b.getTopAxisContainer().on(a);b.getAggregateContainer().on(a);b.pivotListeners=b.getPivot().on({pivotdone:b.onPivotDone,scope:b,destroyable:true});b.task=new Ext.util.DelayedTask(b.reconfigurePivot,b)},destroy:function(){var d=this,a=["relayers","pivotListeners","menu","dragZone","dropZone"],c=a.length,b;for(b=0;b<c;b++){Ext.destroy(d[a[b]]);d[a[b]]=null}d.task.cancel();d.task=d.lastFocusedField=null;d.callParent()},enable:function(){var a=this;if(a.rendered){a.dragZone.enable();a.dropZone.enable();a.initPivotFields()}a.show()},disable:function(){var a=this;if(a.rendered){a.dragZone.disable();a.dropZone.disable()}a.hide()},afterRender:function(){var a=this;a.callParent(arguments);a.mon(a.el,{scope:a,delegate:"."+Ext.baseCSSPrefix+"pivot-grid-config-column",click:a.handleEvent,keypress:a.handleEvent});a.dragZone=new Ext.pivot.plugin.configurator.DragZone(a);a.dropZone=new Ext.pivot.plugin.configurator.DropZone(a)},handleEvent:function(h){var g=this,c=g.keyEventRe.test(h.type),a=g.getPivot(),d,f,i,b;if((c&&h.getKey()===h.SPACE)||(h.button===0)){d=Ext.fly(h.target);if(d&&(f=d.component)){h.stopEvent();f.focus();Ext.destroy(g.menu);i=g.getMenuConfig(f);if(i){g.menu=Ext.create("Ext.menu.Menu",i);b={menu:g.menu,field:f.getField(),container:f.getFieldType()};if(a.fireEvent("beforeshowconfigfieldmenu",g,b)!==false){g.menu.showBy(f);g.menu.focus();a.fireEvent("showconfigfieldmenu",g,b)}else{Ext.destroy(g.menu)}}}}},getPanelConfigHeader:function(a){return Ext.apply({xtype:"header",baseCls:Ext.baseCSSPrefix+"panel-header",cls:this.headerContainerCls,border:1,width:100},a||{})},getHorizontalConfig:function(){var a=this;return{minHeight:a.defaultMinHeight,headerPosition:a.dock=="top"?"bottom":"top",collapseDirection:a.dock,defaults:{xtype:"container",layout:{type:"hbox",align:"stretchmax"},minHeight:a.defaultMinHeight/3},items:[{items:[a.getPanelConfigHeader({title:a.panelAllFieldsTitle,tools:a.collapsible?[{type:a.dock=="top"?"up":"down",handler:a.collapseMe,scope:a}]:[]}),{itemId:"fieldsCt",xtype:"pivotconfigcontainer",fieldType:"all",dragDropText:a.panelAllFieldsText,position:a.dock,flex:1}]},{items:[a.getPanelConfigHeader({title:a.panelAggFieldsTitle}),{itemId:"fieldsAggCt",xtype:"pivotconfigcontainer",fieldType:"aggregate",dragDropText:a.panelAggFieldsText,position:a.dock,flex:1}]},{defaults:{xtype:"pivotconfigcontainer",minHeight:a.defaultMinHeight/3,position:a.dock},items:[a.getPanelConfigHeader({title:a.panelLeftFieldsTitle}),{itemId:"fieldsLeftCt",fieldType:"leftAxis",dragDropText:a.panelLeftFieldsText,flex:1},a.getPanelConfigHeader({title:a.panelTopFieldsTitle}),{itemId:"fieldsTopCt",fieldType:"topAxis",dragDropText:a.panelTopFieldsText,flex:1}]}]}},getVerticalConfig:function(){var a=this;return{layout:{type:"hbox",align:"stretch"},width:a.defaultMinWidth,minWidth:a.defaultMinWidth,headerPosition:a.dock=="right"?"left":"right",collapseDirection:a.dock,defaults:{flex:1},items:[{itemId:"fieldsCt",xtype:"pivotconfigcontainer",position:a.dock,title:a.panelAllFieldsTitle,fieldType:"all",dragDropText:a.panelAllFieldsText,autoScroll:true,header:{cls:a.headerContainerCls},tools:a.collapsible?[{type:a.dock,handler:a.collapseMe,scope:a}]:[]},{xtype:"container",defaults:{xtype:"pivotconfigcontainer",flex:1,autoScroll:true,position:a.dock,header:{cls:a.headerContainerCls}},layout:{type:"vbox",align:"stretch"},items:[{itemId:"fieldsAggCt",title:a.panelAggFieldsTitle,fieldType:"aggregate",dragDropText:a.panelAggFieldsText},{itemId:"fieldsLeftCt",title:a.panelLeftFieldsTitle,fieldType:"leftAxis",dragDropText:a.panelLeftFieldsText},{itemId:"fieldsTopCt",title:a.panelTopFieldsTitle,fieldType:"topAxis",dragDropText:a.panelTopFieldsText}]}]}},getAllFieldsContainer:function(){return this.down("#fieldsCt")},getLeftAxisContainer:function(){return this.down("#fieldsLeftCt")},getTopAxisContainer:function(){return this.down("#fieldsTopCt")},getAggregateContainer:function(){return this.down("#fieldsAggCt")},applyChanges:function(b){var a=this;if(a.disabled){return}if(b){a.lastFocusedField=b}a.task.delay(a.getRefreshDelay())},collapseMe:function(){this.collapse(this.dock)},getFieldsFromContainer:function(c,b){var a=[];c.items.each(function(d){a.push(b===true?d.getField().serialize():d.getField())});return a},initPivotFields:function(){var g=this,i=g.getPivot().getMatrix(),f=g.getAllFieldsContainer(),a=g.getLeftAxisContainer(),j=g.getTopAxisContainer(),h=g.getAggregateContainer(),c,b,d,e;e=g.getFields().clone();Ext.suspendLayouts();f.removeAll();j.removeAll();a.removeAll();h.removeAll();c=g.getConfigFields(i.topAxis.dimensions.getRange());b=g.getConfigFields(i.leftAxis.dimensions.getRange());d=g.getConfigFields(i.aggregate.getRange());g.addFieldsToConfigurator(e.getRange(),f);g.addFieldsToConfigurator(c,j);g.addFieldsToConfigurator(b,a);g.addFieldsToConfigurator(d,h);Ext.resumeLayouts(true)},addFieldsToConfigurator:function(a,b){Ext.each(a,function(e,d,c){b.addField(e,-1)})},getConfigFields:function(c){var a=this.getFields(),b=[];Ext.each(c,function(e){var d=a.byDataIndex.get(e.dataIndex);if(d){b.push(d)}});return b},getMenuConfig:function(k){var h=this,f=k.getFieldType(),g=[],c=k.getMenuConfig()||{},a=k.up("pivotconfigcontainer"),j=a.items.getCount(),m=a.items.indexOf(k),e=k.getField(),d=e.getSettings(),b=h.getLeftAxisContainer(),l=h.getTopAxisContainer(),i=h.getAggregateContainer();c.items=c.items||[];if(f=="all"){g.push({text:Ext.String.format(h.addToText,h.panelLeftFieldsTitle),disabled:!d.isAllowed(b),handler:Ext.bind(h.dragDropField,h,[b,k,"after"])},{text:Ext.String.format(h.addToText,h.panelTopFieldsTitle),disabled:!d.isAllowed(l),handler:Ext.bind(h.dragDropField,h,[l,k,"after"])},{text:Ext.String.format(h.addToText,h.panelAggFieldsTitle),disabled:!d.isAllowed(i),handler:Ext.bind(h.dragDropField,h,[i,k,"after"])})}else{g.push({text:h.moveUpText,disabled:(j==1||m==0),handler:Ext.bind(h.dragDropField,h,[k.previousSibling(),k,"before"])},{text:h.moveDownText,disabled:(j==1||m==j-1),handler:Ext.bind(h.dragDropField,h,[k.nextSibling(),k,"after"])},{text:h.moveBeginText,disabled:(j==1||m==0),handler:Ext.bind(h.dragDropField,h,[a.items.first(),k,"before"])},{text:h.moveEndText,disabled:(j==1||m==j-1),handler:Ext.bind(h.dragDropField,h,[a.items.last(),k,"after"])},{xtype:"menuseparator"},{text:Ext.String.format(h.moveToText,h.panelLeftFieldsTitle),disabled:(f=="leftAxis"||!d.isAllowed(b)||d.isFixed(a)),handler:Ext.bind(h.dragDropField,h,[b,k,"after"])},{text:Ext.String.format(h.moveToText,h.panelTopFieldsTitle),disabled:(f=="topAxis"||!d.isAllowed(l)||d.isFixed(a)),handler:Ext.bind(h.dragDropField,h,[l,k,"after"])},{text:Ext.String.format(h.moveToText,h.panelAggFieldsTitle),disabled:(f=="aggregate"||!d.isAllowed(i)||d.isFixed(a)),handler:Ext.bind(h.dragDropField,h,[i,k,"after"])},{xtype:"menuseparator"},{text:h.removeFieldText,disabled:d.isFixed(a),handler:Ext.bind(h.dragDropField,h,[h.getAllFieldsContainer(),k,"after"])})}if(f=="aggregate"){g.push({xtype:"menuseparator"},{text:h.fieldSettingsText,handler:Ext.bind(h.openFieldSettings,h,[k])})}if(c.items.length){g.push({xtype:"menuseparator"})}Ext.Array.insert(c.items,0,g);return Ext.apply({floating:true},c)},openFieldSettings:function(d){var a=this.getPivot(),c=new Ext.pivot.plugin.configurator.window.FieldSettings({field:d.getField(),listeners:{applysettings:Ext.bind(this.applyFieldSettings,this,[d],0)}}),b=d.getField().getConfig();if(a.fireEvent("beforeshowconfigfieldsettings",this,{container:c,settings:b})!==false){c.loadSettings(b);c.show();a.fireEvent("showconfigfieldsettings",this,{container:c,settings:b})}else{Ext.destroy(c)}},applyFieldSettings:function(d,c,b){var a=this.getPivot(),e=d.getField();if(a.fireEvent("beforeapplyconfigfieldsettings",this,{container:c,settings:b})!==false){e.setConfig(b||{});if(d.rendered){d.textCol.setHtml(e.getFieldText());d.textCol.dom.setAttribute("data-qtip",e.getFieldText())}a.fireEvent("applyconfigfieldsettings",this,{container:c,settings:b});this.applyChanges(d)}else{return false}},dragDropField:function(b,c,k){var j=this,m=j.getPivot(),l=c.getField(),a=c.ownerCt,g=b.isConfiguratorContainer?b:b.ownerCt,f=b.isConfiguratorField?b:b.items.last(),e=a.getFieldType(),o=g.getFieldType(),i=j.getTopAxisContainer(),d=j.getLeftAxisContainer(),h,n;if(m.fireEvent("beforemoveconfigfield",this,{fromContainer:a,toContainer:g,field:l})!==false){if(a!=g){if(f){h=g.items.findIndex("id",f.id);h=(k=="before")?h:h+1}else{h=-1}if(e=="all"&&(o=="leftAxis"||o=="topAxis")){n=j.findFieldInContainer(l,g);if(n){return}if(o=="leftAxis"){n=j.findFieldInContainer(l,i);if(n){i.remove(n,false);g.add(n);j.applyChanges(c);return}}else{n=j.findFieldInContainer(l,d);if(n){d.remove(n,false);g.add(n);j.applyChanges(c);return}}g.addField(l.clone(),h,true)}else{if(e=="all"&&o=="aggregate"){g.addField(l.clone(),h,true)}else{if(e!="all"&&o!="all"){a.remove(c,false);g.add(c);j.applyChanges(c)}else{a.removeField(c)}}}}else{g.moveField(c.id,f.id,k)}}},findFieldInContainer:function(e,a){var d=a.items.getCount(),b,c;for(b=0;b<d;b++){c=a.items.getAt(b);if(c.getField().getDataIndex()==e.getDataIndex()){return c}}},onPivotDone:function(){var a=this,b=a.lastFocusedField;if(a.internalReconfiguration){a.internalReconfiguration=false;if(b&&b.isConfiguratorContainer){b=b.items.first()}if(!b){b=a.getAllFieldsContainer().items.first()}if(b){b.focus()}else{a.getPivot().focus()}}else{a.initPivotFields()}},reconfigurePivot:function(){var b=this,a=b.getPivot(),c={topAxis:b.getFieldsFromContainer(b.getTopAxisContainer(),true),leftAxis:b.getFieldsFromContainer(b.getLeftAxisContainer(),true),aggregate:b.getFieldsFromContainer(b.getAggregateContainer(),true)};b.internalReconfiguration=true;if(a.fireEvent("beforeconfigchange",b,c)!==false){a.getMatrix().reconfigure(c);a.fireEvent("configchange",b,c)}},placeholderCollapse:function(f,a){var d=this,c=d.ownerCt,h=f||d.collapseDirection,b=Ext.panel.Panel.floatCls,g=d.getPlaceholder(h),e;d.isCollapsingOrExpanding=1;d.setHiddenState(true);d.collapsed=h;if(g.rendered){if(g.el.dom.parentNode!==d.el.dom.parentNode){d.el.dom.parentNode.insertBefore(g.el.dom,d.el.dom)}g.hidden=false;g.setHiddenState(false);g.el.show();c.updateLayout()}else{if(d.dock){g.dock=d.dock;c.addDocked(g)}else{c.insert(c.items.indexOf(d),g)}}if(d.rendered){if(Ext.ComponentManager.getActiveComponent()===d.collapseTool){d.focusPlaceholderExpandTool=true}d.el.setVisibilityMode(d.placeholderCollapseHideMode);if(a){d.el.addCls(b);g.el.hide();e=d.convertCollapseDir(h);d.el.slideOut(e,{preserveScroll:true,duration:Ext.Number.from(a,Ext.fx.Anim.prototype.duration),listeners:{scope:d,afteranimate:function(){var i=this;i.el.removeCls(b);i.placeholder.el.show().setStyle("display","none").slideIn(e,{easing:"linear",duration:100,listeners:{afteranimate:i.doPlaceholderCollapse,scope:i}})}}})}else{d.el.hide();d.doPlaceholderCollapse()}}else{d.isCollapsingOrExpanding=0;if(!d.preventCollapseFire){d.fireEvent("collapse",d)}}return d},placeholderExpand:function(c){var e=this,g=e.collapsed,h=e.placeholder.expandTool,d=Ext.panel.Panel.floatCls,b=e.ownerLayout?e.ownerLayout.centerRegion:null,f,a;if(Ext.Component.layoutSuspendCount){c=false}if(e.floatedFromCollapse){a=e.getPosition(true);e.slideOutFloatedPanelBegin();e.slideOutFloatedPanelEnd();e.floated=false}if(Ext.ComponentManager.getActiveComponent()===h){e.focusHeaderCollapseTool=true;h._ariaRole=h.ariaEl.dom.getAttribute("role");h._ariaLabel=h.ariaEl.dom.getAttribute("aria-label");h.ariaEl.dom.setAttribute("role","presentation");h.ariaEl.dom.removeAttribute("aria-label")}if(c){Ext.suspendLayouts();e.placeholder.hide();e.el.show();e.collapsed=false;e.setHiddenState(false);if(b&&!a){b.hidden=true}Ext.resumeLayouts(true);if(b){b.hidden=false}e.el.addCls(d);e.isCollapsingOrExpanding=2;if(a){f=e.getXY();e.setLocalXY(a[0],a[1]);e.setXY([f[0],f[1]],{duration:Ext.Number.from(c,Ext.fx.Anim.prototype.duration),listeners:{scope:e,afteranimate:function(){var i=this;i.el.removeCls(d);i.isCollapsingOrExpanding=0;i.fireEvent("expand",i)}}})}else{e.el.hide();e.placeholder.el.show();e.placeholder.hidden=false;e.setHiddenState(false);e.el.slideIn(e.convertCollapseDir(g),{preserveScroll:true,duration:Ext.Number.from(c,Ext.fx.Anim.prototype.duration),listeners:{afteranimate:e.doPlaceholderExpand,scope:e}})}}else{e.floated=e.collapsed=false;e.doPlaceholderExpand(true)}return e}});Ext.define("Ext.pivot.plugin.Configurator",{alternateClassName:["Mz.pivot.plugin.Configurator"],extend:"Ext.AbstractPlugin",requires:["Ext.util.DelayedTask","Ext.menu.Menu","Ext.menu.CheckItem","Ext.util.Collection","Ext.pivot.plugin.configurator.Panel"],alias:["plugin.pivotconfigurator","plugin.mzconfigurator"],lockableScope:"top",config:{fields:[],refreshDelay:300,dock:"right",collapsible:true,configPanel:null},init:function(b){var a=this;b.showConfigurator=Ext.bind(a.showConfigurator,a);b.hideConfigurator=Ext.bind(a.hideConfigurator,a);b.on({beforerender:a.onBeforePivotRendered,afterrender:a.onAfterPivotRendered,single:true,scope:a});a.callParent([b])},destroy:function(){var b=this,a=b.getCmp();a.showConfigurator=a.hideConfigurator=null;b.setConfigPanel(Ext.destroy(b.getConfigPanel()));b.setFields(null);b.callParent()},enable:function(){this.disabled=false;this.showConfigurator()},disable:function(){this.disabled=true;this.hideConfigurator()},showConfigurator:function(){this.renderConfigPanel()},hideConfigurator:function(){var a=this.getConfigPanel();if(a){a.disable();this.getCmp().fireEvent("hideconfigpanel",a)}},onBeforePivotRendered:function(){var g=this,e=g.getFields(),j=g.getCmp().getMatrix(),k,f,h,a,b,c,d;f=Ext.Array.merge(j.leftAxis.dimensions.getRange(),j.topAxis.dimensions.getRange(),j.aggregate.getRange());b=f.length;for(c=0;c<b;c++){d=f[c].getInitialConfig();delete (d.matrix);h=e.byDataIndex.get(d.dataIndex);if(!h){e.add(d)}else{h.setConfig(d)}}if(e.length===0){k=g.getCmp().getStore();f=k?k.model.getFields():[];b=f.length;for(c=0;c<b;c++){a=f[c].getName();if(!e.byDataIndex.get(a)){e.add({header:Ext.String.capitalize(a),dataIndex:a})}}}g.isReady=true;g.renderConfigPanel()},onAfterPivotRendered:function(){if(this.disabled===true){this.disable()}else{this.enable()}},updateDock:function(a){this.renderConfigPanel(a)},updateCollapsible:function(a){this.renderConfigPanel(a)},getFields:function(){var a=this.fields;if(!a){a=new Ext.util.Collection({extraKeys:{byDataIndex:"dataIndex"},decoder:function(b){return(b&&b.isField)?b:new Ext.pivot.plugin.configurator.Field(b||{})}});this.setFields(a)}return a},applyFields:function(a,b){if(a==null||(a&&a.isCollection)){return a}if(a){if(!b){b=this.getFields()}b.splice(0,b.length,a)}return b},renderConfigPanel:function(a){var e=this,d=e.getCmp(),b=e.getConfigPanel(),c=!Ext.isEmpty(b);if(!d||!e.isReady||e.disabled){return}Ext.destroy(b);b=d.addDocked({xtype:"pivotconfigpanel",dock:a||e.getDock(),refreshDelay:e.getRefreshDelay(),pivot:e.getCmp(),fields:e.getFields()})[0];e.setConfigPanel(b);if(c){b.enable()}d.fireEvent("showconfigpanel",b)}});Ext.define("Ext.pivot.plugin.DrillDown",{alternateClassName:["Mz.pivot.plugin.DrillDown"],alias:["plugin.pivotdrilldown","plugin.mzdrilldown"],extend:"Ext.AbstractPlugin",requires:["Ext.pivot.Grid","Ext.window.Window","Ext.data.proxy.Memory","Ext.data.Store","Ext.toolbar.Paging"],mixins:{observable:"Ext.util.Observable"},columns:null,width:400,height:300,remoteStore:null,textWindow:"Drill down window",lockableScope:"top",init:function(a){var b=this;b.pivot=a;b.pivotListeners=b.pivot.on({pivotitemcelldblclick:b.runPlugin,pivotgroupcelldblclick:b.runPlugin,pivottotalcelldblclick:b.runPlugin,scope:b,destroyable:true});b.callParent([a])},destroy:function(){var a=this;Ext.destroyMembers(a,"view","pivotListeners","remoteStore","store");a.pivot=a.view=a.pivotListeners=a.remoteStore=a.store=null;a.callParent()},showView:function(b){var g=this,d=g.pivot.getMatrix(),e=g.columns||[],a,c,f;if(!b){return}if(!g.view){switch(d.type){case"local":a=d.store.model.getFields();c=Ext.create("Ext.data.Store",{pageSize:25,remoteSort:true,fields:Ext.clone(a),proxy:{type:"memory",reader:{type:"array"},enablePaging:true}});if(e.length===0){Ext.Array.each(a,function(j,h,i){e.push({header:Ext.String.capitalize(j.name),dataIndex:j.name})})}break;case"remote":c=Ext.getStore(g.remoteStore);if(c){c.setRemoteFilter(true)}break;default:return}g.view=Ext.create("Ext.window.Window",{title:g.textWindow,width:g.width,height:g.height,layout:"fit",modal:true,closeAction:"hide",items:[{xtype:"grid",border:false,viewConfig:{loadMask:false},columns:e,store:c,dockedItems:[{itemId:"idPager",xtype:"pagingtoolbar",store:c,dock:"bottom",displayInfo:true}]}]});g.store=c}switch(d.type){case"local":g.store.getProxy().data=b.records;g.store.load();g.view.down("#idPager").moveFirst();break;case"remote":f=Ext.Array.merge(g.getFiltersFromParams(b.getLeftAxisItem()?b.getLeftAxisItem().data:{}),g.getFiltersFromParams(b.getTopAxisItem()?b.getTopAxisItem().data:{}));g.store.clearFilter(f.length>0);g.store.addFilter(f);break;default:return}g.view.show()},runPlugin:function(c,b,a){if(this.disabled){return}this.showView(this.pivot.getMatrix().results.get(c.leftKey,c.topKey))},getFiltersFromParams:function(e){var d=[],b,a,c;if(Ext.isObject(e)){c=Ext.Object.getKeys(e);a=c.length;for(b=0;b<a;b++){d.push({property:c[b],exactMatch:true,value:e[c[b]]})}}return d}});Ext.define("Ext.pivot.plugin.RangeEditor",{alternateClassName:["Mz.pivot.plugin.RangeEditor"],alias:["plugin.pivotrangeeditor","plugin.mzrangeeditor"],extend:"Ext.AbstractPlugin",requires:["Ext.pivot.Grid","Ext.pivot.update.Increment","Ext.pivot.update.Overwrite","Ext.pivot.update.Percentage","Ext.pivot.update.Uniform","Ext.window.Window","Ext.form.field.Hidden","Ext.form.field.Text","Ext.form.field.Number","Ext.form.field.ComboBox","Ext.form.field.Display","Ext.form.Panel","Ext.button.Button","Ext.layout.container.Fit","Ext.data.ArrayStore"],width:null,height:null,textWindowTitle:"Range editor",textFieldValue:"Value",textFieldEdit:"Field",textFieldType:"Type",textButtonOk:"Ok",textButtonCancel:"Cancel",onBeforeRecordsUpdate:Ext.emptyFn,onAfterRecordsUpdate:Ext.emptyFn,scope:null,updaters:[["percentage","Percentage"],["increment","Increment"],["overwrite","Overwrite"],["uniform","Uniform"]],defaultUpdater:"uniform",lockableScope:"top",init:function(a){var b=this;b.pivot=a;b.pivotListeners=b.pivot.on({pivotitemcelldblclick:b.runPlugin,pivotgroupcelldblclick:b.runPlugin,pivottotalcelldblclick:b.runPlugin,scope:b,destroyable:true});b.callParent(arguments)},destroy:function(){var a=this;Ext.destroyMembers(a,"view","pivotListeners");a.pivot=a.view=a.pivotListeners=null;a.cleanUp();a.callParent(arguments)},runPlugin:function(i,h,f){var g=this,b=g.pivot.getMatrix(),d,a,c;if(g.disabled){return}if(i.topKey){g.initEditorWindow();a=b.results.get(i.leftKey,i.topKey);if(a){g.currentCol=c=i.column;g.currentRecords=a.records||[];d=c.dimension.getId();g.currentValue=a.getValue(d);g.view.down("form").getForm().setValues({leftKey:i.leftKey,topKey:i.topKey,dataIndex:c.dimension.dataIndex,field:c.dimension.header||c.text||c.dimension.dataIndex,value:a.getValue(d),type:g.defaultUpdater});g.view.show()}}},updateRecords:function(){var d=this,a=d.view,b=a.down("form").getValues(),c=Ext.bind(d.cleanUp,d),e;b.matrix=d.pivot.getMatrix();e=Ext.Factory.pivotupdate(b);e.on({beforeupdate:d.onBeforeUpdate,update:d.onUpdate,scope:d});e.update().then(c,c)},cleanUp:function(){this.currentCol=this.currentRecords=this.currentValue=null},onBeforeUpdate:function(c){var b=this,a=b.pivot;if(Ext.callback(b.onBeforeRecordsUpdate,b.scope||"self.controller",[a,b.currentCol,b.currentRecords,c.getValue(),b.currentValue],0,a)===false){return false}if(a.fireEvent("pivotbeforeupdate",c)===false){return false}b.view.getEl().mask()},onUpdate:function(d){var c=this,b=c.pivot,a=c.view;Ext.callback(c.onAfterRecordsUpdate,c.scope||"self.controller",[b,c.currentCol,c.currentRecords,d.getValue(),c.currentValue],0,b);b.fireEvent("pivotupdate",d);Ext.destroy(d);a.getEl().unmask();a.close()},initEditorWindow:function(){var a=this;if(!a.view){a.view=Ext.create("Ext.window.Window",{title:a.textWindowTitle,width:a.width,height:a.height,layout:"fit",modal:true,closeAction:"hide",items:[{xtype:"form",padding:5,border:false,defaults:{anchor:"100%"},items:[{fieldLabel:a.textFieldEdit,xtype:"displayfield",name:"field"},{fieldLabel:a.textFieldType,xtype:"combo",name:"type",queryMode:"local",valueField:"id",displayField:"text",editable:false,store:a.updaters},{fieldLabel:a.textFieldValue,xtype:"numberfield",name:"value"},{xtype:"hidden",name:"leftKey"},{xtype:"hidden",name:"topKey"},{xtype:"hidden",name:"dataIndex"}]}],buttons:[{text:a.textButtonOk,handler:a.updateRecords,scope:a},{text:a.textButtonCancel,handler:function(){this.view.close()},scope:a}]})}}});